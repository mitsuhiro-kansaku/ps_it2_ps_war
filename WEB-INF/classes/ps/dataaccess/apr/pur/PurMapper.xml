<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ps.dataaccess.apr.pur.PurMapper">

    <sql id="listKeyIdentityWhereCondition">
            AND (T_PUR_APL.PUR_APL_STATUS = '01' OR  T_PUR_APL.PUR_APL_STATUS = '02')
               AND T_PUR_APL.NEW_FLG = '1'
               AND T_PUR_APL.REQ_TYPE_IND IN ('3','9')
               AND T_PUR_APL.DELETE_FLG = '0'
            <if test="@org.apache.commons.lang.StringUtils@isNotEmpty(urgentInd.urgentInd)">
               AND T_PUR_APL.URGENT_IND = '1'
            </if>
                   ${@ps.common.util.ItemSettingUtil@getItemSettingWhereSQL("8")}
               AND EXISTS (
                            SELECT T_PUR_REQUEST.PUR_APL_SEQ
                              FROM T_PUR_REQUEST
                             WHERE T_PUR_APL.PUR_APL_SEQ = T_PUR_REQUEST.PUR_APL_SEQ
                               AND T_PUR_REQUEST.DELETE_FLG = '0'
                                   ${@ps.common.util.ItemSettingUtil@getItemSettingWhereSQL("9")}
                          )
    </sql>
    <select id="listKeyIdentity"
            parameterType="fw.domain.slip.purreq.everypurreq.EveryPurReqAppSearchCondition"
            resultType="fw.domain.slip.purreq.everypurreq.purreqmng.PurAplIdentify">
            SELECT T_PUR_APL.PUR_APL_SEQ AS purAplSeqNum,
                   T_PUR_APL.LAST_UPD_DATE AS lastUpdDate
              FROM T_PUR_APL
        INNER JOIN T_APPROVAL
                ON T_APPROVAL.APP_VOUCHER_KEY = T_PUR_APL.PUR_APL_SEQ
               AND T_APPROVAL.APP_VOUCHER_IND = '1'
               AND T_APPROVAL.DELETE_FLG = '0'
               AND (T_APPROVAL.APP_STATUS_IND = '0' OR T_APPROVAL.APP_STATUS_IND = '1')
               <if test="@org.apache.commons.lang.StringUtils@isNotEmpty(appUserId)">
                    AND T_APPROVAL.NOW_APP_USER_ID = #{appUserId}
               </if>
               <if test="@org.apache.commons.lang.StringUtils@isEmpty(appUserId)">
                    AND T_APPROVAL.NOW_APP_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
               </if>
               AND T_APPROVAL.NOW_APP_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
        <where>
               <include refid="listKeyIdentityWhereCondition"/>
        </where>
          ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>

    <resultMap type="fw.domain.slip.purreq.everypurreq.EveryPurReqAppListItem" id="ListPageItem_Map">
        <id column="EXCLUSIVE_SLIP_NO" property="purAplIdentify.exclusiveSlipId.slipNo"/>
        <id column="EXCLUSIVE_LAST_UPD_DATE" property="purAplIdentify.exclusiveSlipId.lastUpdDate"/>
        <id column="PUR_APL_NO" property="purAplIdentify.purAplNo.purAplNo"></id>
    </resultMap>
    <select id="listPageItem"
            resultMap="ListPageItem_Map">
            SELECT T_PUR_APL.PUR_APL_NO,
                   T_PUR_APL.URGENT_IND AS urgentInd,
                   T_APPROVAL.NOW_APP_USER_NAME AS appUser,
                   T_APPROVAL.NEXT_APP_USER_NAME AS nextAppUser,
                   T_PUR_APL.PUR_REQ_DATE AS "reqDate.dateOfymd",
                   T_PUR_APL.TITLE_NAME AS titleName,
                   T_PUR_APL.ITEM_CLASS_L_NAME AS itemClassLName,
                   T_PUR_APL.ITEM_CLASS_M_NAME AS itemClassMName,
                   T_PUR_APL.ITEM_CLASS_S_NAME AS itemClassSName,
                   T_PUR_APL.DELIV_PLACE_CD AS delivPlaceCd,
                   T_PUR_APL.DELIV_PLACE_NAME AS delivPlaceName,
                   T_PUR_APL.REQ_SECTION_CD AS reqSectionCd,
                   T_PUR_APL.REQ_SECTION_NAME AS reqSectionName,
                   T_PUR_APL.REQ_USER_ID AS reqUserCd,
                   T_PUR_APL.REQ_USER_NAME AS reqUserName,
                   T_PUR_APL.PUR_APL_SEQ AS "purAplIdentify.purAplSeqNum",
                   T_PUR_APL.LAST_UPD_DATE AS "purAplIdentify.lastUpdDate",
                   T_SLIP_MNG.SLIP_NO AS EXCLUSIVE_SLIP_NO,
                   T_SLIP_MNG.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE,
                   T_PUR_REQUEST.APP_UNIT_NO AS "purAplIdentify.purReqNo",
                   ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLDomainAliasNonBinary("T_PUR_APL","searchResExtItem")}
              FROM T_PUR_APL
        INNER JOIN T_APPROVAL
                ON T_APPROVAL.APP_VOUCHER_KEY = T_PUR_APL.PUR_APL_SEQ
               AND T_APPROVAL.APP_VOUCHER_IND = '1'
               AND T_APPROVAL.DELETE_FLG = '0'
               AND (T_APPROVAL.APP_STATUS_IND = '0' OR T_APPROVAL.APP_STATUS_IND = '1')
               <if test="@org.apache.commons.lang.StringUtils@isNotEmpty(appUserId)">
               AND T_APPROVAL.NOW_APP_USER_ID = #{appUserId}
               </if>
               <if test="@org.apache.commons.lang.StringUtils@isEmpty(appUserId)">
               AND T_APPROVAL.NOW_APP_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
               </if>
               AND T_APPROVAL.NOW_APP_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
        INNER JOIN (SELECT
                         T_PUR_REQUEST.PUR_APL_SEQ,
                         MIN(T_PUR_REQUEST.PUR_REQ_NO) as PUR_REQ_NO,
                         MIN(T_PUR_REQUEST.APP_UNIT_NO) as APP_UNIT_NO
                     FROM T_PUR_REQUEST, T_PUR_APL
                         WHERE T_PUR_REQUEST.PUR_APL_SEQ = T_PUR_APL.PUR_APL_SEQ
                           AND T_PUR_REQUEST.DELETE_FLG = '0'
                         GROUP BY T_PUR_REQUEST.PUR_APL_SEQ
                     )T_PUR_REQUEST
                    ON T_PUR_REQUEST.PUR_APL_SEQ = T_PUR_APL.PUR_APL_SEQ
        INNER JOIN T_SLIP_MNG
                    ON T_PUR_REQUEST.PUR_REQ_NO = T_SLIP_MNG.SLIP_NO
        <where>
               T_PUR_APL.PUR_APL_SEQ IN
               <foreach collection="searchCondition.page.keyDomainEntityList" item="keyList" open="(" separator="," close=")">
                   #{keyList.purAplSeqNum}
               </foreach>
               <include refid="listKeyIdentityWhereCondition"/>
        </where>
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>

    <select id="searchAmountAndDelivDate"
            parameterType="fw.domain.slip.purreq.everypurreq.EveryPurReqAppSearchCondition"
            resultType="fw.domain.slip.purreq.everypurreq.EveryPurReqAppListItem">
            SELECT T_PUR_REQUEST.PUR_APL_SEQ AS "purAplIdentify.purAplSeqNum",
                   SUM(T_PUR_REQUEST.REQ_AMOUNT) AS "hopeQuotPrice.amount",
                   MIN(T_PUR_REQUEST.REQ_DELIV_DATE) AS "hopeDelivDate.dateOfymd"
              FROM T_PUR_REQUEST
             WHERE T_PUR_REQUEST.PUR_APL_SEQ IN
                <foreach collection="page.keyDomainEntityList" item="keyList" open="(" separator="," close=")">
                    #{keyList.purAplSeqNum}
                </foreach>
             GROUP BY T_PUR_REQUEST.PUR_APL_SEQ
    </select>

    <select id="searchCurrencyInfo"
            parameterType="fw.domain.slip.purreq.everypurreq.EveryPurReqAppListItem"
            resultType="fw.domain.slip.purreq.everypurreq.EveryPurReqAppListItem">
            SELECT DISTINCT T_PUR_REQUEST.PUR_APL_SEQ,
                   T_PUR_REQUEST.CURRENCY_CD AS currencyCd
              FROM T_PUR_REQUEST
        INNER JOIN M_CURRENCY
                ON M_CURRENCY.CURRENCY_CD = T_PUR_REQUEST.CURRENCY_CD
             WHERE T_PUR_REQUEST.PUR_APL_SEQ = #{purAplIdentify.purAplSeqNum}
               AND T_PUR_REQUEST.REQ_DELIV_DATE = #{hopeDelivDate.dateOfymd}
    </select>

    <resultMap type="fw.domain.slip.purreq.everypurreq.EveryPurReq" id="OrderLt_Map">
        <id column="PUR_REQ_SEQ" property="purReqSeq" />
        <id column="PUR_REQ_NO" property="purReqNo.purReqNo" />
        <id column="AUTO_ORDER_FLG" property="autoOrderFlg" />
        <id column="REQ_DELIV_DATE" property="hopeDlvEst.hopeDlvEst.dateOfymd" />
        <id column="ORDER_LT" property="standardDelivDayCount.standardDelivDayCount.dayCount" />
        <id column="BUYER_COMPANY_CD" property="buyUser.buyUser.section.company.companyCd"/>
        <id column="BUYER_SECTION_CD" property="buyUser.buyUser.section.sectionCd"/>
        <id column="BUYER_USER_ID"   property="buyUser.buyUser.userID"/>    
        <id column="BUYER_USER_NAME" property="buyUser.buyUser.userName"/>  
    </resultMap>
    <select id="searchOrderLt"
            resultMap="OrderLt_Map">
            SELECT T_PUR_REQUEST.PUR_REQ_SEQ,
                   T_PUR_REQUEST.PUR_REQ_NO,
                   T_PUR_REQUEST.AUTO_ORDER_FLG,
                   T_PUR_REQUEST.REQ_DELIV_DATE,
                   M_PUR_PRICE.ORDER_LT
                 , T_PUR_REQUEST.BUYER_COMPANY_CD
                 , T_PUR_REQUEST.BUYER_SECTION_CD
                 , T_PUR_REQUEST.BUYER_USER_ID
                 , T_PUR_REQUEST.BUYER_USER_NAME
          FROM T_PUR_REQUEST
          LEFT JOIN M_PUR_PRICE ON T_PUR_REQUEST.BUYER_COMPANY_CD =
                                   M_PUR_PRICE.BUYER_USER_COMPANY_CD
                               AND T_PUR_REQUEST.BUYER_SECTION_CD =
                                   M_PUR_PRICE.BUYER_USER_SECTION_CD
                               AND T_PUR_REQUEST.ITEM_CD = M_PUR_PRICE.ITEM_CD
                               AND T_PUR_REQUEST.SUP_CD = M_PUR_PRICE.SUP_CD
                               AND M_PUR_PRICE.VALID_START_DATE &lt;= '${@fw.common.util.AppUtil@getSysDate()}'
                               AND M_PUR_PRICE.VALID_END_DATE >= '${@fw.common.util.AppUtil@getSysDate()}'
         WHERE T_PUR_REQUEST.PUR_APL_SEQ = #{purAplSeqNum}
           AND T_PUR_REQUEST.DELETE_FLG = '0'
    </select>

    <resultMap type="fw.domain.slip.purreq.everypurreq.EveryPurReqApp" id="EveryPurReqApp_Map">
        <id column="PUR_APL_SEQ" property="purAplManagement.purAplIdentify.purAplSeqNum"/>
        <id column="PUR_APL_NO" property="purAplManagement.purAplIdentify.purAplNo.purAplNo"/>
        <id column="LAST_UPD_DATE" property="purAplManagement.purAplIdentify.lastUpdDate"/>
        <id column="URGENT_IND" property="purAplManagement.urgentInd.urgentInd"/>
        <id column="PUR_REQ_DATE" property="purAplManagement.purReqDate.purReqDate.reqDate.dateOfymd"/>
        <id column="TITLE_NAME" property="purAplManagement.titleName.titleName"/>
        <id column="REQ_SECTION_CD" property="purAplManagement.reqUser.reqUser.section.sectionCd"/>
        <id column="REQ_SECTION_NAME" property="purAplManagement.reqUser.reqUser.section.sectionName"/>
        <id column="REQ_USER_EXTENSION_NO" property="purAplManagement.reqUser.reqUser.extNo.extensionNo"/>
        <id column="REQ_USER_TEL_NO" property="purAplManagement.reqUser.reqUser.externalNo.externalNo"/>
        <id column="REQ_USER_ID" property="purAplManagement.reqUser.reqUser.userID"/>
        <id column="REQ_USER_NAME" property="purAplManagement.reqUser.reqUser.userName"/>
        <id column="INPUT_COMPANY_CD" property="purAplManagement.inputUser.inputUser.section.company.companyCd"/>
        <id column="INPUT_SECTION_CD" property="purAplManagement.inputUser.inputUser.section.sectionCd"/>
        <id column="INPUT_USER_ID" property="purAplManagement.inputUser.inputUser.userID"/>
        <id column="INPUT_USER_NAME" property="purAplManagement.inputUser.inputUser.userName"/>
        <id column="MAIL_ADDR" property="purAplManagement.reqUser.reqUser.mailAddr.mail"/>
        <id column="LOAD_SECTION_CD" property="purAplManagement.loadSection.loadSection.sectionCd"/>
        <id column="LOAD_SECTION_NAME" property="purAplManagement.loadSection.loadSection.sectionName"/>
        <id column="DELIV_PLACE_CD" property="purAplManagement.delivPlace.delivPlaceCd"/>
        <id column="DELIV_PLACE_NAME" property="purAplManagement.delivPlace.delivPlaceName"/>
        <id column="HOPE_SUPPLIER_CD" property="purAplManagement.hopeSupplier.hopeSupplier.supCd"/>
        <id column="HOPE_SUPPLIER_NAME" property="purAplManagement.hopeSupplier.hopeSupplier.supplierName.supplierName"/>
        <id column="HOPE_SUPPLIER_COMPANY_CD" property="purAplManagement.hopeSupplier.hopeSupplier.supCompanyCd"/>
        <id column="HOPE_SUPPLIER_ABBR_NAME" property="purAplManagement.hopeSupplier.hopeSupplier.supplierName.supplierAbbrName"/>
        <id column="HOPE_SUPPLIER_SUBCON_IND" property="purAplManagement.hopeSupplier.hopeSupplier.subcon.subconInd"/>
        <id column="HOPE_SUPPLIER_EDI_IND" property="purAplManagement.hopeSupplier.hopeSupplier.ediInd.ediInd"/>
        <id column="ITEM_CLASS_L_NAME" property="purAplManagement.itemKind.itemClassLName"/>
        <id column="ITEM_CLASS_M_NAME" property="purAplManagement.itemKind.itemClassMName"/>
        <id column="ITEM_CLASS_S_NAME" property="purAplManagement.itemKind.itemClassSName"/>
        <id column="ATTACH_FILE_SEQ1" property="purAplManagement.rangeByAttachFile1.attachFile.seqNo"/>
        <id column="ATTACH_FILE_NAME_1" property="purAplManagement.rangeByAttachFile1.attachFile.fileName"/>
        <id column="ATTACH_SCOPE_1" property="purAplManagement.rangeByAttachFile1.attachRange.attachRange"/>
        <id column="ATTACH_FILE_SEQ2" property="purAplManagement.rangeByAttachFile2.attachFile.seqNo"/>
        <id column="ATTACH_FILE_NAME_2" property="purAplManagement.rangeByAttachFile2.attachFile.fileName"/>
        <id column="ATTACH_SCOPE_2" property="purAplManagement.rangeByAttachFile2.attachRange.attachRange"/>
        <id column="BUDGET_NO" property="purAplManagement.budgetNumber.budgetNumber"/>
        <id column="BUDGET_NAME" property="purAplManagement.budgetNumber.titleName.titleName"/>
        <id column="FOR_BOSS_COMMENT" property="purAplManagement.forAppComment.forAppComment.comment"/>
        <id column="FOR_BUYER_COMMENT" property="purAplManagement.forBuyerComment.forBuyerComment.comment"/>
        <id column="FOR_SUPPRIER_COMMENT" property="purAplManagement.forSupplierComment.forSupplierComment.comment"/>
        <id column="APP_ROUTE_NAME" property="purAplManagement.approute.appRouteName"/>
        <id column="APP_UNIT_NO" property="purAplManagement.purAplIdentify.purReqNo"/>
        <id column="EXT_TXT_1" property="purAplManagement.detailExtItem.extendTxt.extendTxt1" />
        <id column="EXT_TXT_2" property="purAplManagement.detailExtItem.extendTxt.extendTxt2" />
        <id column="EXT_TXT_3" property="purAplManagement.detailExtItem.extendTxt.extendTxt3" />
        <id column="EXT_TXT_4" property="purAplManagement.detailExtItem.extendTxt.extendTxt4" />
        <id column="EXT_TXT_5" property="purAplManagement.detailExtItem.extendTxt.extendTxt5" />
        <id column="EXT_TXT_6" property="purAplManagement.detailExtItem.extendTxt.extendTxt6" />
        <id column="EXT_TXT_7" property="purAplManagement.detailExtItem.extendTxt.extendTxt7" />
        <id column="EXT_TXT_8" property="purAplManagement.detailExtItem.extendTxt.extendTxt8" />
        <id column="EXT_TXT_9" property="purAplManagement.detailExtItem.extendTxt.extendTxt9" />
        <id column="EXT_TXT_10" property="purAplManagement.detailExtItem.extendTxt.extendTxt10" />
        <id column="EXT_AREA_1" property="purAplManagement.detailExtItem.extendArea.extendArea1" />
        <id column="EXT_AREA_2" property="purAplManagement.detailExtItem.extendArea.extendArea2" />
        <id column="EXT_AREA_3" property="purAplManagement.detailExtItem.extendArea.extendArea3" />
        <id column="EXT_AREA_4" property="purAplManagement.detailExtItem.extendArea.extendArea4" />
        <id column="EXT_AREA_5" property="purAplManagement.detailExtItem.extendArea.extendArea5" />
        <id column="EXT_DATE_1" property="purAplManagement.detailExtItem.extendDate.extendDate1.dateOfymd" />
        <id column="EXT_DATE_2" property="purAplManagement.detailExtItem.extendDate.extendDate2.dateOfymd" />
        <id column="EXT_DATE_3" property="purAplManagement.detailExtItem.extendDate.extendDate3.dateOfymd" />
        <id column="EXT_DATE_4" property="purAplManagement.detailExtItem.extendDate.extendDate4.dateOfymd" />
        <id column="EXT_DATE_5" property="purAplManagement.detailExtItem.extendDate.extendDate5.dateOfymd" />
        <id column="EXT_INT_1" property="purAplManagement.detailExtItem.extendInt.extendInt1.value" />
        <id column="EXT_INT_2" property="purAplManagement.detailExtItem.extendInt.extendInt2.value" />
        <id column="EXT_INT_3" property="purAplManagement.detailExtItem.extendInt.extendInt3.value" />
        <id column="EXT_INT_4" property="purAplManagement.detailExtItem.extendInt.extendInt4.value" />
        <id column="EXT_INT_5" property="purAplManagement.detailExtItem.extendInt.extendInt5.value" />
        <id column="EXT_INT_6" property="purAplManagement.detailExtItem.extendInt.extendInt6.value" />
        <id column="EXT_INT_7" property="purAplManagement.detailExtItem.extendInt.extendInt7.value" />
        <id column="EXT_INT_8" property="purAplManagement.detailExtItem.extendInt.extendInt8.value" />
        <id column="EXT_INT_9" property="purAplManagement.detailExtItem.extendInt.extendInt9.value" />
        <id column="EXT_INT_10" property="purAplManagement.detailExtItem.extendInt.extendInt10.value" />
        <id column="EXT_DEC_1" property="purAplManagement.detailExtItem.extendDec.extendDec1.value" />
        <id column="EXT_DEC_2" property="purAplManagement.detailExtItem.extendDec.extendDec2.value" />
        <id column="EXT_DEC_3" property="purAplManagement.detailExtItem.extendDec.extendDec3.value" />
        <id column="EXT_DEC_4" property="purAplManagement.detailExtItem.extendDec.extendDec4.value" />
        <id column="EXT_DEC_5" property="purAplManagement.detailExtItem.extendDec.extendDec5.value" />
        <id column="EXT_SEL_1" property="purAplManagement.detailExtItem.extendSel.extendSel1" />
        <id column="EXT_SEL_2" property="purAplManagement.detailExtItem.extendSel.extendSel2" />
        <id column="EXT_SEL_3" property="purAplManagement.detailExtItem.extendSel.extendSel3" />
        <id column="EXT_SEL_4" property="purAplManagement.detailExtItem.extendSel.extendSel4" />
        <id column="EXT_SEL_5" property="purAplManagement.detailExtItem.extendSel.extendSel5" />
        <id column="EXT_SEL_6" property="purAplManagement.detailExtItem.extendSel.extendSel6" />
        <id column="EXT_SEL_7" property="purAplManagement.detailExtItem.extendSel.extendSel7" />
        <id column="EXT_SEL_8" property="purAplManagement.detailExtItem.extendSel.extendSel8" />
        <id column="EXT_SEL_9" property="purAplManagement.detailExtItem.extendSel.extendSel9" />
        <id column="EXT_SEL_10" property="purAplManagement.detailExtItem.extendSel.extendSel10" />
        <id column="EXT_CHK_1" property="purAplManagement.detailExtItem.extendChk.extendChk1" />
        <id column="EXT_CHK_2" property="purAplManagement.detailExtItem.extendChk.extendChk2" />
        <id column="EXT_CHK_3" property="purAplManagement.detailExtItem.extendChk.extendChk3" />
        <id column="EXT_CHK_4" property="purAplManagement.detailExtItem.extendChk.extendChk4" />
        <id column="EXT_CHK_5" property="purAplManagement.detailExtItem.extendChk.extendChk5" />
        <id column="EXT_FILE_1" property="purAplManagement.detailExtItem.extendFile.extendFile1.fileName" />
        <id column="EXT_FILE_2" property="purAplManagement.detailExtItem.extendFile.extendFile2.fileName" />
        <id column="EXT_FILE_3" property="purAplManagement.detailExtItem.extendFile.extendFile3.fileName" />
        <id column="EXT_FILE_BINARY_1" property="purAplManagement.detailExtItem.extendFile.extendFile1.binary" />
        <id column="EXT_FILE_BINARY_2" property="purAplManagement.detailExtItem.extendFile.extendFile2.binary" />
        <id column="EXT_FILE_BINARY_3" property="purAplManagement.detailExtItem.extendFile.extendFile3.binary" />
        <id column="EXT_MST_1" property="purAplManagement.detailExtItem.extendMst.extendMst1.mstKey" />
        <id column="EXT_MST_2" property="purAplManagement.detailExtItem.extendMst.extendMst2.mstKey" />
        <id column="EXT_MST_3" property="purAplManagement.detailExtItem.extendMst.extendMst3.mstKey" />
        <id column="EXT_MST_4" property="purAplManagement.detailExtItem.extendMst.extendMst4.mstKey" />
        <id column="EXT_MST_5" property="purAplManagement.detailExtItem.extendMst.extendMst5.mstKey" />
        <id column="EXT_MST_6" property="purAplManagement.detailExtItem.extendMst.extendMst6.mstKey" />
        <id column="EXT_MST_7" property="purAplManagement.detailExtItem.extendMst.extendMst7.mstKey" />
        <id column="EXT_MST_8" property="purAplManagement.detailExtItem.extendMst.extendMst8.mstKey" />
        <id column="EXT_MST_NAME_1" property="purAplManagement.detailExtItem.extendMst.extendMst1.mstName" />
        <id column="EXT_MST_NAME_2" property="purAplManagement.detailExtItem.extendMst.extendMst2.mstName" />
        <id column="EXT_MST_NAME_3" property="purAplManagement.detailExtItem.extendMst.extendMst3.mstName" />
        <id column="EXT_MST_NAME_4" property="purAplManagement.detailExtItem.extendMst.extendMst4.mstName" />
        <id column="EXT_MST_NAME_5" property="purAplManagement.detailExtItem.extendMst.extendMst5.mstName" />
        <id column="EXT_MST_NAME_6" property="purAplManagement.detailExtItem.extendMst.extendMst6.mstName" />
        <id column="EXT_MST_NAME_7" property="purAplManagement.detailExtItem.extendMst.extendMst7.mstName" />
        <id column="EXT_MST_NAME_8" property="purAplManagement.detailExtItem.extendMst.extendMst8.mstName" />
    </resultMap>
    <select id="searchEveryPurReqApp"
            parameterType="String"
            resultType="fw.domain.slip.purreq.everypurreq.EveryPurReqApp"
            resultMap="EveryPurReqApp_Map">
      SELECT T_PUR_APL.PUR_APL_SEQ
           , T_PUR_APL.LAST_UPD_DATE
           , T_PUR_APL.PUR_APL_NO
           , T_PUR_APL.URGENT_IND
           , T_PUR_APL.PUR_REQ_DATE
           , T_PUR_APL.TITLE_NAME
           , T_PUR_APL.REQ_SECTION_CD
           , T_PUR_APL.REQ_SECTION_NAME
           , T_PUR_APL.REQ_USER_EXTENSION_NO
           , T_PUR_APL.REQ_USER_TEL_NO
           , T_PUR_APL.REQ_USER_ID
           , T_PUR_APL.REQ_USER_NAME
           , T_PUR_APL.INPUT_COMPANY_CD
           , T_PUR_APL.INPUT_SECTION_CD
           , T_PUR_APL.INPUT_USER_ID
           , T_PUR_APL.INPUT_USER_NAME
           , M_B_USER.MAIL_ADDR
           , T_PUR_APL.LOAD_SECTION_CD
           , T_PUR_APL.LOAD_SECTION_NAME
           , T_PUR_APL.DELIV_PLACE_CD
           , T_PUR_APL.DELIV_PLACE_NAME
           , T_PUR_APL.HOPE_SUPPLIER_CD
           , T_PUR_APL.HOPE_SUPPLIER_NAME
           , T_PUR_APL.HOPE_SUPPLIER_COMPANY_CD
           , T_PUR_APL.HOPE_SUPPLIER_ABBR_NAME
           , M_SUPPLIER.SUBCON_IND AS HOPE_SUPPLIER_SUBCON_IND
           , M_SUPPLIER.EDI_IND AS HOPE_SUPPLIER_EDI_IND
           , T_PUR_APL.ITEM_CLASS_L_NAME
           , T_PUR_APL.ITEM_CLASS_M_NAME
           , T_PUR_APL.ITEM_CLASS_S_NAME
           , T_PUR_APL.ATTACH_FILE_SEQ1
           , T_ATTACH_MNG_A.ATTACH_FILE_NAME AS "ATTACH_FILE_NAME_1"
           , T_ATTACH_MNG_A.ATTACH_SCOPE AS "ATTACH_SCOPE_1"
           , T_PUR_APL.ATTACH_FILE_SEQ2
           , T_ATTACH_MNG_B.ATTACH_FILE_NAME AS "ATTACH_FILE_NAME_2"
           , T_ATTACH_MNG_B.ATTACH_SCOPE AS "ATTACH_SCOPE_2"
           , T_PUR_APL.BUDGET_NO
           , T_RINGI_BUDGET_DTL.BUDGET_NAME
           , T_PUR_APL.FOR_BOSS_COMMENT
           , T_PUR_APL.FOR_BUYER_COMMENT
           , T_PUR_APL.FOR_SUPPRIER_COMMENT
           , T_PUR_APL.APP_ROUTE_NAME
           , T_PUR_REQUEST.APP_UNIT_NO
           , ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQL("T_PUR_APL")}
        FROM T_PUR_APL
        INNER JOIN 
        (       SELECT      T_PUR_REQUEST.PUR_APL_SEQ
                ,           MIN(T_PUR_REQUEST.PUR_REQ_NO) as PUR_REQ_NO
                ,           MIN(T_PUR_REQUEST.APP_UNIT_NO) as APP_UNIT_NO
                FROM        T_PUR_REQUEST
                ,           T_PUR_APL
                WHERE       T_PUR_REQUEST.PUR_APL_SEQ = T_PUR_APL.PUR_APL_SEQ
                AND         T_PUR_REQUEST.DELETE_FLG = '0'
                GROUP BY    T_PUR_REQUEST.PUR_APL_SEQ
        ) T_PUR_REQUEST
        ON T_PUR_REQUEST.PUR_APL_SEQ = T_PUR_APL.PUR_APL_SEQ
        LEFT JOIN M_B_USER
          ON T_PUR_APL.REQ_COMPANY_CD = M_B_USER.COMPANY_CD
         AND T_PUR_APL.REQ_USER_ID = M_B_USER.USER_ID
         AND M_B_USER.TERM_FLG = '0'
        LEFT JOIN M_SUPPLIER
          ON T_PUR_APL.HOPE_SUPPLIER_COMPANY_CD = M_SUPPLIER.COMPANY_CD
         AND T_PUR_APL.HOPE_SUPPLIER_CD = M_SUPPLIER.SUP_CD
         AND M_SUPPLIER.TERM_FLG = '0'
        LEFT JOIN T_ATTACH_MNG T_ATTACH_MNG_A
          ON T_PUR_APL.ATTACH_FILE_SEQ1 = T_ATTACH_MNG_A.ATTACH_FILE_SEQ
         AND T_ATTACH_MNG_A.DELETE_FLG = '0'
        LEFT JOIN T_ATTACH_MNG T_ATTACH_MNG_B
          ON T_PUR_APL.ATTACH_FILE_SEQ2 = T_ATTACH_MNG_B.ATTACH_FILE_SEQ 
         AND T_ATTACH_MNG_B.DELETE_FLG = '0'
        LEFT JOIN T_RINGI_BUDGET_DTL 
          ON T_RINGI_BUDGET_DTL.COMPANY_CD = T_PUR_APL.LOAD_COMPANY_CD 
         AND T_RINGI_BUDGET_DTL.SECTION_PLACE_CD = T_PUR_APL.LOAD_SECTION_PLACE_CD 
         AND T_RINGI_BUDGET_DTL.BUDGET_DTL_NO = T_PUR_APL.BUDGET_NO 
       WHERE T_PUR_APL.PUR_APL_SEQ = #{purAplSeqNum}
         AND T_PUR_APL.REQ_TYPE_IND IN ('3', '9')
         AND T_PUR_APL.PUR_APL_STATUS IN ('01','02')
         AND T_PUR_APL.NEW_FLG = '1'
         AND T_PUR_APL.DELETE_FLG = '0'
    </select>

    <resultMap type="fw.domain.slip.purreq.everypurreq.EveryPurReq" id="EveryPurReqAppDetail_Map">
        <id column="PUR_REQ_SEQ" property="purReqSeq"/>
        <id column="PUR_REQ_NO" property="purReqNo.purReqNo"/>
        <id column="SUBJECT_CD" property="subject.subjectCd"/>
        <id column="SUBJECT_NAME" property="subject.subjectName"/>
        <id column="ITEM_CD" property="itemName.itemCd"/>
        <id column="ITEM_NAME" property="itemName.itemName"/>
        <id column="KATASHIKI" property="itemName.katashiki"/>
        <id column="MANUFACT_CD" property="itemName.manufact.manufactCd"/>
        <id column="MANUFACT_NAME" property="itemName.manufact.manufactName"/>
        <id column="INSPECT_IND" property="inspectInd.inspectInd"/>
        <id column="REQ_DELIV_DATE" property="hopeDlvEst.hopeDlvEst.dateOfymd"/>
        <id column="UNIT_PRICE" property="hopePrice.hopePrice.amount"/>
        <id column="CURRENCY_CD" property="amountMng.currency.currencyCd"/>
        <id column="CURRENCY_MARK" property="amountMng.currency.currencyMark"/>
        <id column="REQ_VOL" property="vol.vol"/>
        <id column="UNIT_CD" property="itemName.unit.unitCd"/>
        <id column="UNIT_NAME" property="itemName.unit.unitName"/>
        <id column="REQ_AMOUNT" property="amountMng.noTaxAmount.noTaxAmount.amount"/>
        <id column="TAX_IND" property="amountMng.taxCalculationInd.taxInd.taxInd"/>
        <id column="ATTACH_FILE_SEQ" property="rangeByAttachFile.attachFile.seqNo"/>
        <id column="ATTACH_FILE_NAME" property="rangeByAttachFile.attachFile.fileName"/>
        <id column="ATTACH_SCOPE" property="rangeByAttachFile.attachRange.attachRange"/>
        <id column="AUTO_ORDER_FLG" property="autoOrderFlg"/>
        <id column="PRICE_REG_FLG" property="priceCreateFlg.priceCreateFlg"/>
        <id column="BUYER_COMPANY_CD" property="buyUser.buyUser.section.company.companyCd"/>
        <id column="BUYER_SECTION_CD" property="buyUser.buyUser.section.sectionCd"/>
        <id column="ORDER_LT" property="standardDelivDayCount.standardDelivDayCount.dayCount" />
        <id column="BUYER_USER_ID"   property="buyUser.buyUser.userID"/>    
        <id column="BUYER_USER_NAME" property="buyUser.buyUser.userName"/>  
        <id column="SLIP_NO" property="exclusiveSlipId.slipNo"/>
        <id column="SLIP_LAST_UPD_DATE" property="exclusiveSlipId.lastUpdDate"/>
        <id column="EXT_TXT_1" property="detailExtItem.extendTxt.extendTxt1" />
        <id column="EXT_TXT_2" property="detailExtItem.extendTxt.extendTxt2" />
        <id column="EXT_TXT_3" property="detailExtItem.extendTxt.extendTxt3" />
        <id column="EXT_TXT_4" property="detailExtItem.extendTxt.extendTxt4" />
        <id column="EXT_TXT_5" property="detailExtItem.extendTxt.extendTxt5" />
        <id column="EXT_TXT_6" property="detailExtItem.extendTxt.extendTxt6" />
        <id column="EXT_TXT_7" property="detailExtItem.extendTxt.extendTxt7" />
        <id column="EXT_TXT_8" property="detailExtItem.extendTxt.extendTxt8" />
        <id column="EXT_TXT_9" property="detailExtItem.extendTxt.extendTxt9" />
        <id column="EXT_TXT_10" property="detailExtItem.extendTxt.extendTxt10" />
        <id column="EXT_AREA_1" property="detailExtItem.extendArea.extendArea1" />
        <id column="EXT_AREA_2" property="detailExtItem.extendArea.extendArea2" />
        <id column="EXT_AREA_3" property="detailExtItem.extendArea.extendArea3" />
        <id column="EXT_AREA_4" property="detailExtItem.extendArea.extendArea4" />
        <id column="EXT_AREA_5" property="detailExtItem.extendArea.extendArea5" />
        <id column="EXT_DATE_1" property="detailExtItem.extendDate.extendDate1.dateOfymd" />
        <id column="EXT_DATE_2" property="detailExtItem.extendDate.extendDate2.dateOfymd" />
        <id column="EXT_DATE_3" property="detailExtItem.extendDate.extendDate3.dateOfymd" />
        <id column="EXT_DATE_4" property="detailExtItem.extendDate.extendDate4.dateOfymd" />
        <id column="EXT_DATE_5" property="detailExtItem.extendDate.extendDate5.dateOfymd" />
        <id column="EXT_INT_1" property="detailExtItem.extendInt.extendInt1.value" />
        <id column="EXT_INT_2" property="detailExtItem.extendInt.extendInt2.value" />
        <id column="EXT_INT_3" property="detailExtItem.extendInt.extendInt3.value" />
        <id column="EXT_INT_4" property="detailExtItem.extendInt.extendInt4.value" />
        <id column="EXT_INT_5" property="detailExtItem.extendInt.extendInt5.value" />
        <id column="EXT_INT_6" property="detailExtItem.extendInt.extendInt6.value" />
        <id column="EXT_INT_7" property="detailExtItem.extendInt.extendInt7.value" />
        <id column="EXT_INT_8" property="detailExtItem.extendInt.extendInt8.value" />
        <id column="EXT_INT_9" property="detailExtItem.extendInt.extendInt9.value" />
        <id column="EXT_INT_10" property="detailExtItem.extendInt.extendInt10.value" />
        <id column="EXT_DEC_1" property="detailExtItem.extendDec.extendDec1.value" />
        <id column="EXT_DEC_2" property="detailExtItem.extendDec.extendDec2.value" />
        <id column="EXT_DEC_3" property="detailExtItem.extendDec.extendDec3.value" />
        <id column="EXT_DEC_4" property="detailExtItem.extendDec.extendDec4.value" />
        <id column="EXT_DEC_5" property="detailExtItem.extendDec.extendDec5.value" />
        <id column="EXT_SEL_1" property="detailExtItem.extendSel.extendSel1" />
        <id column="EXT_SEL_2" property="detailExtItem.extendSel.extendSel2" />
        <id column="EXT_SEL_3" property="detailExtItem.extendSel.extendSel3" />
        <id column="EXT_SEL_4" property="detailExtItem.extendSel.extendSel4" />
        <id column="EXT_SEL_5" property="detailExtItem.extendSel.extendSel5" />
        <id column="EXT_SEL_6" property="detailExtItem.extendSel.extendSel6" />
        <id column="EXT_SEL_7" property="detailExtItem.extendSel.extendSel7" />
        <id column="EXT_SEL_8" property="detailExtItem.extendSel.extendSel8" />
        <id column="EXT_SEL_9" property="detailExtItem.extendSel.extendSel9" />
        <id column="EXT_SEL_10" property="detailExtItem.extendSel.extendSel10" />
        <id column="EXT_CHK_1" property="detailExtItem.extendChk.extendChk1" />
        <id column="EXT_CHK_2" property="detailExtItem.extendChk.extendChk2" />
        <id column="EXT_CHK_3" property="detailExtItem.extendChk.extendChk3" />
        <id column="EXT_CHK_4" property="detailExtItem.extendChk.extendChk4" />
        <id column="EXT_CHK_5" property="detailExtItem.extendChk.extendChk5" />
        <id column="EXT_FILE_1" property="detailExtItem.extendFile.extendFile1.fileName" />
        <id column="EXT_FILE_2" property="detailExtItem.extendFile.extendFile2.fileName" />
        <id column="EXT_FILE_3" property="detailExtItem.extendFile.extendFile3.fileName" />
        <id column="EXT_FILE_BINARY_1" property="detailExtItem.extendFile.extendFile1.binary" />
        <id column="EXT_FILE_BINARY_1" property="detailExtItem.extendFile.extendFile2.binary" />
        <id column="EXT_FILE_BINARY_1" property="detailExtItem.extendFile.extendFile3.binary" />
        <id column="EXT_MST_1" property="detailExtItem.extendMst.extendMst1.mstKey" />
        <id column="EXT_MST_2" property="detailExtItem.extendMst.extendMst2.mstKey" />
        <id column="EXT_MST_3" property="detailExtItem.extendMst.extendMst3.mstKey" />
        <id column="EXT_MST_4" property="detailExtItem.extendMst.extendMst4.mstKey" />
        <id column="EXT_MST_5" property="detailExtItem.extendMst.extendMst5.mstKey" />
        <id column="EXT_MST_6" property="detailExtItem.extendMst.extendMst6.mstKey" />
        <id column="EXT_MST_7" property="detailExtItem.extendMst.extendMst7.mstKey" />
        <id column="EXT_MST_8" property="detailExtItem.extendMst.extendMst8.mstKey" />
        <id column="EXT_MST_NAME_1" property="detailExtItem.extendMst.extendMst1.mstName" />
        <id column="EXT_MST_NAME_2" property="detailExtItem.extendMst.extendMst2.mstName" />
        <id column="EXT_MST_NAME_3" property="detailExtItem.extendMst.extendMst3.mstName" />
        <id column="EXT_MST_NAME_4" property="detailExtItem.extendMst.extendMst4.mstName" />
        <id column="EXT_MST_NAME_5" property="detailExtItem.extendMst.extendMst5.mstName" />
        <id column="EXT_MST_NAME_6" property="detailExtItem.extendMst.extendMst6.mstName" />
        <id column="EXT_MST_NAME_7" property="detailExtItem.extendMst.extendMst7.mstName" />
        <id column="EXT_MST_NAME_8" property="detailExtItem.extendMst.extendMst8.mstName" />
    </resultMap>
    <select id="searchEveryPurReqAppDetail"
            parameterType="String"
            resultType="fw.domain.slip.purreq.everypurreq.EveryPurReqApp"
            resultMap="EveryPurReqAppDetail_Map">
      SELECT T_PUR_REQUEST.PUR_REQ_SEQ
           , T_PUR_REQUEST.PUR_REQ_NO
           , T_PUR_REQUEST.SUBJECT_CD
           , T_PUR_REQUEST.SUBJECT_NAME
           , T_PUR_REQUEST.ITEM_CD
           , T_PUR_REQUEST.ITEM_NAME
           , T_PUR_REQUEST.KATASHIKI
           , T_PUR_REQUEST.MANUFACT_CD
           , T_PUR_REQUEST.MANUFACT_NAME
           , T_PUR_REQUEST.INSPECT_IND
           , T_PUR_REQUEST.REQ_DELIV_DATE
           , T_PUR_REQUEST.UNIT_PRICE
           , T_PUR_REQUEST.CURRENCY_CD
           , M_CURRENCY.CURRENCY_MARK
           , T_PUR_REQUEST.REQ_VOL
           , T_PUR_REQUEST.UNIT_CD
           , T_PUR_REQUEST.UNIT_NAME
           , T_PUR_REQUEST.REQ_AMOUNT
           , T_PUR_REQUEST.TAX_IND
           , T_PUR_REQUEST.ATTACH_FILE_SEQ
           , T_ATTACH_MNG.ATTACH_FILE_NAME
           , T_ATTACH_MNG.ATTACH_SCOPE
           , M_PUR_PRICE.ORDER_LT
           , T_PUR_REQUEST.AUTO_ORDER_FLG
           , T_PUR_REQUEST.PRICE_REG_FLG
           , T_PUR_REQUEST.BUYER_COMPANY_CD
           , T_PUR_REQUEST.BUYER_SECTION_CD
           , T_PUR_REQUEST.BUYER_USER_ID
           , T_PUR_REQUEST.BUYER_USER_NAME
           , T_SLIP_MNG.SLIP_NO
           , T_SLIP_MNG.LAST_UPD_DATE as "SLIP_LAST_UPD_DATE"
           , ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQL("T_PUR_REQUEST")}
        FROM T_PUR_REQUEST
        LEFT JOIN T_SLIP_MNG
          ON T_PUR_REQUEST.PUR_REQ_NO = T_SLIP_MNG.SLIP_NO
        LEFT JOIN T_ATTACH_MNG 
          ON T_PUR_REQUEST.ATTACH_FILE_SEQ = T_ATTACH_MNG.ATTACH_FILE_SEQ
         AND T_ATTACH_MNG.DELETE_FLG = '0'
        LEFT JOIN M_CURRENCY
          ON T_PUR_REQUEST.CURRENCY_CD = M_CURRENCY.CURRENCY_CD
         AND M_CURRENCY.TERM_FLG = '0'
        LEFT JOIN M_PUR_PRICE
          ON T_PUR_REQUEST.BUYER_COMPANY_CD = M_PUR_PRICE.BUYER_USER_COMPANY_CD
         AND T_PUR_REQUEST.BUYER_SECTION_CD = M_PUR_PRICE.BUYER_USER_SECTION_CD
         AND T_PUR_REQUEST.ITEM_CD = M_PUR_PRICE.ITEM_CD
         AND T_PUR_REQUEST.SUP_CD = M_PUR_PRICE.SUP_CD
         AND M_PUR_PRICE.VALID_START_DATE &lt;= '${@fw.common.util.AppUtil@getSysDate()}'
         AND M_PUR_PRICE.VALID_END_DATE >= '${@fw.common.util.AppUtil@getSysDate()}'
       WHERE T_PUR_REQUEST.PUR_APL_SEQ = #{purAplSeqNum}
         AND T_PUR_REQUEST.DELETE_FLG = '0'
    ORDER BY T_PUR_REQUEST.PUR_REQ_NO ASC
    </select>

    <resultMap type="fw.domain.slip.purreq.everypurreq.EveryPurReqApp" id="EveryPurReqAppTotalAmount_Map">
        <id column="TOTAL_AMOUNT" property="purAplManagement.hopeAmountTotal.hopeAmountTotal.amount"/>
    </resultMap>
    <select id="searchTotalAmount"
            parameterType="String"
            resultType="fw.domain.slip.purreq.everypurreq.EveryPurReqApp"
            resultMap="EveryPurReqAppTotalAmount_Map">
            SELECT T_PUR_REQUEST.PUR_APL_SEQ,
                   SUM(T_PUR_REQUEST.REQ_AMOUNT) AS "TOTAL_AMOUNT"
              FROM T_PUR_REQUEST
             WHERE T_PUR_REQUEST.PUR_APL_SEQ = #{purAplSeqNum}
             GROUP BY T_PUR_REQUEST.PUR_APL_SEQ
    </select>

    <!-- 都度購入依頼個別承認 -->
    <!-- 購入申請 最終承認でない -->
    <update id="updatePuraplWithApprovalling">
            UPDATE T_PUR_APL
               SET T_PUR_APL.PUR_APL_STATUS = '02',
                   T_PUR_APL.LAST_UPD_DATE = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   T_PUR_APL.LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   T_PUR_APL.LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   T_PUR_APL.LAST_UPD_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
             WHERE T_PUR_APL.PUR_APL_SEQ = #{purAplSeqNum}
               AND T_PUR_APL.PUR_APL_NO = #{purAplNo}
               AND T_PUR_APL.NEW_FLG = '1'
               AND T_PUR_APL.DELETE_FLG = '0'
               AND T_PUR_APL.REQ_TYPE_IND IN ('3','9')
    </update>

    <!-- 購入申請 最終承認 -->
    <update id="updatePuraplWithApproval">
            UPDATE T_PUR_APL
               SET T_PUR_APL.PUR_APL_STATUS = '11',
                   T_PUR_APL.LAST_APP_DATE = '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}',
                   T_PUR_APL.NEW_APP_FLG = '1',
                   T_PUR_APL.LAST_UPD_DATE = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   T_PUR_APL.LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   T_PUR_APL.LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   T_PUR_APL.LAST_UPD_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
             WHERE T_PUR_APL.PUR_APL_SEQ = #{purAplSeqNum}
               AND T_PUR_APL.PUR_APL_NO = #{purAplNo}
               AND T_PUR_APL.NEW_FLG = '1'
               AND T_PUR_APL.DELETE_FLG = '0'
               AND T_PUR_APL.REQ_TYPE_IND IN ('3','9')
    </update>

    <!-- 購入申請 差戻し -->
    <update id="updatePuraplWithReturn">
            UPDATE T_PUR_APL
               SET T_PUR_APL.PUR_APL_STATUS = '03',
                   T_PUR_APL.LAST_APP_DATE = '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}',
                   T_PUR_APL.NEW_APP_FLG = '0',
                   T_PUR_APL.LAST_UPD_DATE = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   T_PUR_APL.LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   T_PUR_APL.LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   T_PUR_APL.LAST_UPD_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
             WHERE T_PUR_APL.PUR_APL_SEQ = #{purAplSeqNum}
               AND T_PUR_APL.PUR_APL_NO = #{purAplNo}
               AND T_PUR_APL.NEW_FLG = '1'
               AND T_PUR_APL.DELETE_FLG = '0'
               AND T_PUR_APL.REQ_TYPE_IND IN ('3','9')
    </update>

    <!-- 購入依頼 最終承認でない -->
    <update id="updatePurreqWithApprovalling">
            UPDATE T_PUR_REQUEST
               SET T_PUR_REQUEST.PUR_REQ_STATUS = '02',
                   T_PUR_REQUEST.LAST_UPD_DATE = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   T_PUR_REQUEST.LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   T_PUR_REQUEST.LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   T_PUR_REQUEST.LAST_UPD_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
             WHERE T_PUR_REQUEST.PUR_APL_SEQ = #{purAplSeqNum}
               AND T_PUR_REQUEST.PUR_APL_NO = #{purAplNo}
               AND T_PUR_REQUEST.PUR_REQ_NO = #{purReqNo}
               AND T_PUR_REQUEST.NEW_FLG = '1'
               AND T_PUR_REQUEST.DELETE_FLG = '0'
    </update>

    <!-- 購入依頼 最終承認時 -->
    <update id="updatePurreqWithApproval">
            UPDATE T_PUR_REQUEST
               SET T_PUR_REQUEST.PUR_REQ_STATUS = '11',
                   T_PUR_REQUEST.TAX_RATE = #{everyPurReq.amountMng.taxRate.taxRate},
                   T_PUR_REQUEST.CONSUMPT_AMOUNT = #{everyPurReq.amountMng.consumptAmount.consumptAmount.amount},
                   T_PUR_REQUEST.TOTAL_AMOUNT = #{everyPurReq.amountMng.totalAmount.totalAmount.amount},
                   T_PUR_REQUEST.NEW_APP_FLG = '1',
                   T_PUR_REQUEST.BUYER_USER_ID = #{purApl.itemKind.buyUser.buyUser.userID},
                   T_PUR_REQUEST.BUYER_USER_NAME = #{purApl.itemKind.buyUser.buyUser.userName},
                   T_PUR_REQUEST.BUYER_BACK_COMPANY_CD = '',
                   T_PUR_REQUEST.BUYER_BACK_COMPANY_NAME = '',
                   T_PUR_REQUEST.BUYER_BACK_SECTION_CD = '',
                   T_PUR_REQUEST.BUYER_BACK_SECTION_NAME = '',
                   T_PUR_REQUEST.BUYER_BACK_USER_ID = '',
                   T_PUR_REQUEST.BUYER_BACK_USER_NAME = '',
                   T_PUR_REQUEST.BUYER_BACK_USER_COMMENTS = '',
                   T_PUR_REQUEST.LAST_UPD_DATE = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   T_PUR_REQUEST.LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   T_PUR_REQUEST.LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   T_PUR_REQUEST.LAST_UPD_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
             WHERE T_PUR_REQUEST.PUR_APL_SEQ = #{purApl.purAplIdentify.purAplSeqNum}
               AND T_PUR_REQUEST.PUR_APL_NO = #{purApl.purAplIdentify.purAplNo.purAplNo}
               AND T_PUR_REQUEST.PUR_REQ_NO = #{everyPurReq.purReqNo.purReqNo}
               AND T_PUR_REQUEST.NEW_FLG = '1'
               AND T_PUR_REQUEST.DELETE_FLG = '0'
    </update>

    <!-- 購入依頼 差戻時 -->
    <update id="updatePurreqWithReturn">
            UPDATE T_PUR_REQUEST
               SET T_PUR_REQUEST.PUR_REQ_STATUS = '03',
                   T_PUR_REQUEST.NEW_APP_FLG = '0',
                   T_PUR_REQUEST.LAST_UPD_DATE = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   T_PUR_REQUEST.LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   T_PUR_REQUEST.LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   T_PUR_REQUEST.LAST_UPD_USER_ID = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
             WHERE T_PUR_REQUEST.PUR_APL_SEQ = #{purAplSeqNum}
               AND T_PUR_REQUEST.PUR_APL_NO = #{purAplNo}
               AND T_PUR_REQUEST.NEW_FLG = '1'
               AND T_PUR_REQUEST.DELETE_FLG = '0'
    </update>
</mapper>