<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ps.dataaccess.rcv.rcv.RcvMapper">

    <resultMap type="fw.domain.slip.receive.receive.receivedetail.ReceiveDetail" id="ReceiveDetail_Map">
        <id column="ARRIV_EXP_DATE" property="receiveDate.receiveDate.dateOfymd"/>
        <id column="ARRIVAL_SEQ" property="receiveApp.receive.arrivalSeqNo.seqNo"/>
        <id column="TOTAL_AMOUNT" property="rcvPriceAmount.rcvPriceAmount.amount"/>
        <id column="APP_ROUTE_NAME" property="receiveApp.receive.receiveAppRoute.approute.appRouteName"/>
        <id column="APP_ROUTE_NO" property="receiveApp.receive.receiveAppRoute.approute.appRouteNo"/>
        <id column="APP_VOUCHER_KEY" property="appManagement.appVoucherKey.appVoucherKey"/>
        <id column="BACK_APP_COMMENTS" property="appManagement.backApp.backAppReason.backReason.comment"/>
        <id column="RB_SEQ" property="receiveApp.receive.rbInd.rbSeq"/>
        <id column="ARRIV_SECTION_CD" property="receiveUser.section.sectionCd"/>
        <id column="ARRIV_SECTION_NAME" property="receiveUser.section.sectionName"/>
        <id column="ARRIV_USER_ID" property="receiveUser.userID"/>
        <id column="ARRIV_USER_NAME" property="receiveUser.userName"/>
        <id column="SHIPMENT_DATE" property="shipment.shipmentDate.shipmentDate.dateOfymd"/>
        <id column="SHIPMENT_VOL" property="shipment.shipmentVol.shipmentVol.vol"/>
        <id column="ARVEXP_DATE" property="shipment.arrivalDate.arrivalDate.dateOfymd"/>
        <id column="SHIPMENT_REMARK" property="shipment.shipmentRemark.remark.comment"/>
        <id column="HAVE_IN_STOCK_FLG" property="haveInStockFlg.haveInStockFlg"/>
        <id column="STOCK_COMPANY_CD" property="stockPlace.company.companyCd"/>
        <id column="STOCK_SECTION_PLACE_CD" property="stockPlace.sectionPlace.sectionPlaceCd"/>
        <id column="STOCK_PLACE_CD" property="stockPlace.stockPlaceCd"/>
        <id column="STOCK_PLACE_NAME" property="stockPlace.stockPlaceName"/>

        <id column="EXT_TXT_1" property="detailExtItem.extendTxt.extendTxt1"/>
        <id column="EXT_TXT_2" property="detailExtItem.extendTxt.extendTxt2"/>
        <id column="EXT_TXT_3" property="detailExtItem.extendTxt.extendTxt3"/>
        <id column="EXT_TXT_4" property="detailExtItem.extendTxt.extendTxt4"/>
        <id column="EXT_TXT_5" property="detailExtItem.extendTxt.extendTxt5"/>
        <id column="EXT_TXT_6" property="detailExtItem.extendTxt.extendTxt6"/>
        <id column="EXT_TXT_7" property="detailExtItem.extendTxt.extendTxt7"/>
        <id column="EXT_TXT_8" property="detailExtItem.extendTxt.extendTxt8"/>
        <id column="EXT_TXT_9" property="detailExtItem.extendTxt.extendTxt9"/>
        <id column="EXT_TXT_10" property="detailExtItem.extendTxt.extendTxt10"/>
        <id column="EXT_AREA_1" property="detailExtItem.extendArea.extendArea1"/>
        <id column="EXT_AREA_2" property="detailExtItem.extendArea.extendArea2"/>
        <id column="EXT_AREA_3" property="detailExtItem.extendArea.extendArea3"/>
        <id column="EXT_AREA_4" property="detailExtItem.extendArea.extendArea4"/>
        <id column="EXT_AREA_5" property="detailExtItem.extendArea.extendArea5"/>
        <id column="EXT_DATE_1" property="detailExtItem.extendDate.extendDate1.dateOfymd"/>
        <id column="EXT_DATE_2" property="detailExtItem.extendDate.extendDate2.dateOfymd"/>
        <id column="EXT_DATE_3" property="detailExtItem.extendDate.extendDate3.dateOfymd"/>
        <id column="EXT_DATE_4" property="detailExtItem.extendDate.extendDate4.dateOfymd"/>
        <id column="EXT_DATE_5" property="detailExtItem.extendDate.extendDate5.dateOfymd"/>
        <id column="EXT_INT_1" property="detailExtItem.extendInt.extendInt1.value"/>
        <id column="EXT_INT_2" property="detailExtItem.extendInt.extendInt2.value"/>
        <id column="EXT_INT_3" property="detailExtItem.extendInt.extendInt3.value"/>
        <id column="EXT_INT_4" property="detailExtItem.extendInt.extendInt4.value"/>
        <id column="EXT_INT_5" property="detailExtItem.extendInt.extendInt5.value"/>
        <id column="EXT_INT_6" property="detailExtItem.extendInt.extendInt6.value"/>
        <id column="EXT_INT_7" property="detailExtItem.extendInt.extendInt7.value"/>
        <id column="EXT_INT_8" property="detailExtItem.extendInt.extendInt8.value"/>
        <id column="EXT_INT_9" property="detailExtItem.extendInt.extendInt9.value"/>
        <id column="EXT_INT_10" property="detailExtItem.extendInt.extendInt10.value"/>
        <id column="EXT_DEC_1" property="detailExtItem.extendDec.extendDec1.value"/>
        <id column="EXT_DEC_2" property="detailExtItem.extendDec.extendDec2.value"/>
        <id column="EXT_DEC_3" property="detailExtItem.extendDec.extendDec3.value"/>
        <id column="EXT_DEC_4" property="detailExtItem.extendDec.extendDec4.value"/>
        <id column="EXT_DEC_5" property="detailExtItem.extendDec.extendDec5.value"/>
        <id column="EXT_SEL_1" property="detailExtItem.extendSel.extendSel1"/>
        <id column="EXT_SEL_2" property="detailExtItem.extendSel.extendSel2"/>
        <id column="EXT_SEL_3" property="detailExtItem.extendSel.extendSel3"/>
        <id column="EXT_SEL_4" property="detailExtItem.extendSel.extendSel4"/>
        <id column="EXT_SEL_5" property="detailExtItem.extendSel.extendSel5"/>
        <id column="EXT_SEL_6" property="detailExtItem.extendSel.extendSel6"/>
        <id column="EXT_SEL_7" property="detailExtItem.extendSel.extendSel7"/>
        <id column="EXT_SEL_8" property="detailExtItem.extendSel.extendSel8"/>
        <id column="EXT_SEL_9" property="detailExtItem.extendSel.extendSel9"/>
        <id column="EXT_SEL_10" property="detailExtItem.extendSel.extendSel10"/>
        <id column="EXT_CHK_1" property="detailExtItem.extendChk.extendChk1"/>
        <id column="EXT_CHK_2" property="detailExtItem.extendChk.extendChk2"/>
        <id column="EXT_CHK_3" property="detailExtItem.extendChk.extendChk3"/>
        <id column="EXT_CHK_4" property="detailExtItem.extendChk.extendChk4"/>
        <id column="EXT_CHK_5" property="detailExtItem.extendChk.extendChk5"/>
        <id column="EXT_FILE_1" property="detailExtItem.extendFile.extendFile1.fileName"/>
        <id column="EXT_FILE_2" property="detailExtItem.extendFile.extendFile2.fileName"/>
        <id column="EXT_FILE_3" property="detailExtItem.extendFile.extendFile3.fileName"/>
        <id column="EXT_FILE_BINARY_1" property="detailExtItem.extendFile.extendFile1.binary"/>
        <id column="EXT_FILE_BINARY_2" property="detailExtItem.extendFile.extendFile2.binary"/>
        <id column="EXT_FILE_BINARY_3" property="detailExtItem.extendFile.extendFile3.binary"/>
        <id column="EXT_MST_1" property="detailExtItem.extendMst.extendMst1.mstKey"/>
        <id column="EXT_MST_2" property="detailExtItem.extendMst.extendMst2.mstKey"/>
        <id column="EXT_MST_3" property="detailExtItem.extendMst.extendMst3.mstKey"/>
        <id column="EXT_MST_4" property="detailExtItem.extendMst.extendMst4.mstKey"/>
        <id column="EXT_MST_5" property="detailExtItem.extendMst.extendMst5.mstKey"/>
        <id column="EXT_MST_6" property="detailExtItem.extendMst.extendMst6.mstKey"/>
        <id column="EXT_MST_7" property="detailExtItem.extendMst.extendMst7.mstKey"/>
        <id column="EXT_MST_8" property="detailExtItem.extendMst.extendMst8.mstKey"/>
        <id column="EXT_MST_NAME_1" property="detailExtItem.extendMst.extendMst1.mstName"/>
        <id column="EXT_MST_NAME_2" property="detailExtItem.extendMst.extendMst2.mstName"/>
        <id column="EXT_MST_NAME_3" property="detailExtItem.extendMst.extendMst3.mstName"/>
        <id column="EXT_MST_NAME_4" property="detailExtItem.extendMst.extendMst4.mstName"/>
        <id column="EXT_MST_NAME_5" property="detailExtItem.extendMst.extendMst5.mstName"/>
        <id column="EXT_MST_NAME_6" property="detailExtItem.extendMst.extendMst6.mstName"/>
        <id column="EXT_MST_NAME_7" property="detailExtItem.extendMst.extendMst7.mstName"/>
        <id column="EXT_MST_NAME_8" property="detailExtItem.extendMst.extendMst8.mstName"/>
    </resultMap>
    
    <!-- 受入詳細を取得 -->
    <select id="receiveDetail" resultMap="ReceiveDetail_Map">
        SELECT
               DELIV_KEY_NO as "delivKeyNo.delivKeyNo",
               ARRIVAL_STATUS as "delivStatus",
               ARRIV_EXP_DATE as "ARRIV_EXP_DATE",
               CURRENCY_CD as "currency.currencyCd",
               DELIV_VOL as "receiveVol.receiveVol.vol",
               UNIT_NAME as "unit.unitName",
               ARRIVAL_SEQ as "ARRIVAL_SEQ",
               TOTAL_AMOUNT as "TOTAL_AMOUNT",
               HAVE_IN_STOCK_FLG,
               STOCK_COMPANY_CD,
               STOCK_SECTION_PLACE_CD,
               STOCK_PLACE_CD,
               STOCK_PLACE_NAME,
               INSPECT_IND as "inspectInd.inspectInd",
               ARRIV_REMARK as "receiveRemark.remark.comment",
               APP_ROUTE_NAME as "APP_ROUTE_NAME",
               APP_ROUTE_NO as "APP_ROUTE_NO",
               APP_VOUCHER_KEY as "APP_VOUCHER_KEY",
               BACK_APP_COMMENTS as "BACK_APP_COMMENTS",
               ARRIV_SECTION_CD as "ARRIV_SECTION_CD",
               ARRIV_SECTION_NAME as "ARRIV_SECTION_NAME",
               ARRIV_USER_ID as "ARRIV_USER_ID",
               ARRIV_USER_NAME as "ARRIV_USER_NAME",
               SHIPMENT_DATE,
               SHIPMENT_VOL,
               ARVEXP_DATE,
               SHIPMENT_REMARK,
               ARRIVAL_VERSION,
               CORRECT_CD,
               ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLNoTableName("")}
        FROM (
                SELECT 
                    T_ARRIVAL.DELIV_KEY_NO,
                    T_ARRIVAL.ARRIVAL_STATUS,
                    T_ARRIVAL.ARRIV_EXP_DATE,
                    T_ORDER.CURRENCY_CD,
                    T_ARRIVAL.DELIV_VOL,
                    T_ORDER.UNIT_NAME,
                    T_ARRIVAL.ARRIVAL_SEQ,
                    T_ARRIVAL.TOTAL_AMOUNT,
                    T_ARRIVAL.HAVE_IN_STOCK_FLG,
                    T_ARRIVAL.STOCK_COMPANY_CD,
                    T_ARRIVAL.STOCK_SECTION_PLACE_CD,
                    T_ARRIVAL.STOCK_PLACE_CD,
                    T_ARRIVAL.STOCK_PLACE_NAME,
                    T_ARRIVAL.INSPECT_IND,
                    T_ARRIVAL.ARRIV_REMARK,
                    T_ARRIVAL.APP_ROUTE_NAME,
                    T_ARRIVAL.APP_ROUTE_NO,
                    T_APPROVAL.APP_VOUCHER_KEY,
                    T_APPROVAL.BACK_APP_COMMENTS,
                    T_ARRIVAL.ARRIV_SECTION_CD,
                    T_ARRIVAL.ARRIV_SECTION_NAME,
                    T_ARRIVAL.ARRIV_USER_ID,
                    T_ARRIVAL.ARRIV_USER_NAME,
                    T_SHIPMENT.SHIPMENT_DATE,
                    T_SHIPMENT.SHIPMENT_VOL,
                    T_SHIPMENT.ARVEXP_DATE,
                    T_SHIPMENT.SHIPMENT_REMARK,
                    T_ARRIVAL.ARRIVAL_VERSION,
                    T_ARRIVAL.CORRECT_CD,
                    ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQL("T_ARRIVAL")}
                FROM 
                    T_ARRIVAL
                INNER JOIN 
                    T_ORDER
                ON 
                    T_ARRIVAL.ORDER_NO = T_ORDER.ORDER_NO
                AND T_ORDER.DELETE_FLG = '0'
                AND T_ORDER.NEW_APP_FLG = '1'
            LEFT JOIN 
                T_APPROVAL
            ON 
                T_APPROVAL.APP_VOUCHER_KEY = T_ARRIVAL.ARRIVAL_SEQ
            AND T_APPROVAL.APP_VOUCHER_IND = '3'
            AND T_APPROVAL.DELETE_FLG = '0'
            LEFT JOIN 
                T_SHIPMENT_MNG
            ON 
                T_ARRIVAL.DELIV_KEY_NO = T_SHIPMENT_MNG.DELIV_KEY_NO
            AND T_SHIPMENT_MNG.DELETE_FLG = 0
            LEFT JOIN 
                T_SHIPMENT
            ON 
                T_SHIPMENT.SHIPMENT_SEQ = T_SHIPMENT_MNG.NEW_SHIPMENT_SEQ
            AND T_SHIPMENT.CORRECT_CD != '3'
            AND T_SHIPMENT.DELETE_FLG = 0
            WHERE
                  T_ARRIVAL.DELETE_FLG = '0'
                  <if test="1== range">
                  AND T_ARRIVAL.ARRIVAL_STATUS = '04'
                  </if>
                  AND T_ORDER.ORDER_NO = #{orderNo.orderNo}
            <if test="1 != range">
            UNION ALL
            SELECT
                T_SHIPMENT.DELIV_KEY_NO,
                N'00' AS ARRIVAL_STATUS,
                null AS ARRIV_EXP_DATE,
                null AS CURRENCY_CD,
                0 AS DELIV_VOL,
                null AS UNIT_NAME,
                null AS ARRIVAL_SEQ,
                null AS TOTAL_AMOUNT,
                null AS HAVE_IN_STOCK_FLG,
                null AS STOCK_COMPANY_CD,
                null AS STOCK_SECTION_PLACE_CD,
                null AS STOCK_PLACE_CD,
                null AS STOCK_PLACE_NAME,
                null AS INSPECT_IND,
                null AS ARRIV_REMARK,
                null AS APP_ROUTE_NAME,
                null AS APP_ROUTE_NO,
                null AS APP_VOUCHER_KEY,
                null AS BACK_APP_COMMENTS,
                null AS ARRIV_SECTION_CD,
                null AS ARRIV_SECTION_NAME,
                null AS ARRIV_USER_ID,
                null AS ARRIV_USER_NAME,
                T_SHIPMENT.SHIPMENT_DATE,
                T_SHIPMENT.SHIPMENT_VOL,
                T_SHIPMENT.ARVEXP_DATE,
                T_SHIPMENT.SHIPMENT_REMARK,
                null AS ARRIVAL_VERSION,
                null AS CORRECT_CD,
                ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLNoTableName("null AS ")}
            FROM 
                T_SHIPMENT
            INNER JOIN 
                T_SHIPMENT_MNG
            ON 
                T_SHIPMENT.SHIPMENT_SEQ = T_SHIPMENT_MNG.NEW_SHIPMENT_SEQ
            AND T_SHIPMENT_MNG.DELETE_FLG = 0
            INNER JOIN 
                T_ORDER
            ON 
                T_SHIPMENT_MNG.ORDER_NO = T_ORDER.ORDER_NO
            AND T_ORDER.DELETE_FLG = '0'
            AND T_ORDER.NEW_APP_FLG = '1'
            WHERE
                T_SHIPMENT.DELETE_FLG = '0'
            AND T_SHIPMENT.CORRECT_CD != '3'
            AND T_ORDER.ORDER_NO = #{orderNo.orderNo}
            AND NOT EXISTS (
                SELECT 
                    T_SHIPMENT_MNG.ORDER_NO 
                FROM 
                    T_RECEIVE_MNG 
                WHERE 
                    T_SHIPMENT_MNG.ORDER_NO = T_RECEIVE_MNG.ORDER_NO
                AND T_SHIPMENT_MNG.DELIV_KEY_NO = T_RECEIVE_MNG.DELIV_KEY_NO
            )
            </if>
        )
        ORDER BY 
            DELIV_KEY_NO,
            ARRIVAL_VERSION,
            CORRECT_CD
    </select>
    
    <select id="receiveDetailForHistory" resultMap="ReceiveDetail_Map">
        SELECT T_RECEIVE_MNG.DELIV_KEY_NO as "delivKeyNo.delivKeyNo",
               T_RECEIVE_MNG.DELIV_STATUS as "delivStatus",
               T_ARRIVAL.ARRIV_EXP_DATE as "ARRIV_EXP_DATE",
               T_ORDER.CURRENCY_CD as "currency.currencyCd",
               T_ARRIVAL.DELIV_VOL as "receiveVol.receiveVol.vol",
               T_ORDER.UNIT_CD as "unit.unitCd",
               T_ORDER.UNIT_NAME as "unit.unitName",
               T_ARRIVAL.ARRIVAL_SEQ as "ARRIVAL_SEQ",
               T_ARRIVAL.TOTAL_AMOUNT as "TOTAL_AMOUNT",
               T_ARRIVAL.HAVE_IN_STOCK_FLG,
               T_ARRIVAL.STOCK_COMPANY_CD,
               T_ARRIVAL.STOCK_SECTION_PLACE_CD,
               T_ARRIVAL.STOCK_PLACE_CD,
               T_ARRIVAL.STOCK_PLACE_NAME,
               T_ARRIVAL.INSPECT_IND as "inspectInd.inspectInd",
               T_ARRIVAL.ARRIV_REMARK as "receiveRemark.remark.comment",
               T_ARRIVAL.APP_ROUTE_NAME as "APP_ROUTE_NAME",
               T_ARRIVAL.APP_ROUTE_NO as "APP_ROUTE_NO",
               T_APPROVAL.APP_VOUCHER_KEY as "APP_VOUCHER_KEY",
               T_APPROVAL.BACK_APP_COMMENTS as "BACK_APP_COMMENTS",
               T_ARRIVAL.RB_SEQ
               ,T_ARRIVAL.ARRIV_SECTION_CD as "ARRIV_SECTION_CD"
               ,T_ARRIVAL.ARRIV_SECTION_NAME as "ARRIV_SECTION_NAME"
               ,T_ARRIVAL.ARRIV_USER_ID as "ARRIV_USER_ID"
               ,T_ARRIVAL.ARRIV_USER_NAME as "ARRIV_USER_NAME"
               ,${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQL("T_ARRIVAL")}
        FROM T_RECEIVE_MNG
       INNER JOIN T_ARRIVAL ON 
               <if test="1==isBlackData">
                   <if test="0== range">
                       T_RECEIVE_MNG.NEW_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ AND 
                       T_ARRIVAL.RB_IND = '0' AND 
                   </if>
                   <if test="1== range">
                       T_RECEIVE_MNG.APP_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ AND
                       T_ARRIVAL.RB_IND = '0' AND 
                    </if>
                       T_ARRIVAL.DELETE_FLG = '0'
               </if>
               <if test="0==isBlackData">
                     T_RECEIVE_MNG.DELIV_KEY_NO = T_ARRIVAL.DELIV_KEY_NO
                 AND T_ARRIVAL.ARRIVAL_SEQ = #{arrivalSeq}
                 AND T_ARRIVAL.RB_IND = '1'
               </if>
       INNER JOIN T_ORDER
               ON T_RECEIVE_MNG.ORDER_NO = T_ORDER.ORDER_NO
              AND T_ORDER.NEW_FLG = '1'
              AND T_ORDER.DELETE_FLG = '0'
              AND T_ORDER.NEW_APP_FLG = '1'
        LEFT JOIN T_APPROVAL
               ON T_APPROVAL.APP_VOUCHER_KEY = T_ARRIVAL.ARRIVAL_SEQ
              AND T_APPROVAL.APP_VOUCHER_IND = '3'
              AND T_APPROVAL.DELETE_FLG = '0'
        <where>
              T_RECEIVE_MNG.DELETE_FLG = '0'
              AND T_ORDER.ORDER_NO = #{orderNo}
              AND T_RECEIVE_MNG.DELIV_KEY_NO = #{delivKeyNo}
        </where>
        ORDER BY T_RECEIVE_MNG.DELIV_KEY_NO
    </select>
    <select id="receiveDetailForHistoryObjectData" resultMap="ReceiveDetail_Map">
        SELECT DELIV_KEY_NO as "delivKeyNo.delivKeyNo",
               ARRIVAL_STATUS as "delivStatus",
               ARRIV_EXP_DATE as "ARRIV_EXP_DATE",
               CURRENCY_CD as "currency.currencyCd",
               DELIV_VOL as "receiveVol.receiveVol.vol",
               UNIT_NAME as "unit.unitName",
               ARRIVAL_SEQ as "ARRIVAL_SEQ",
               TOTAL_AMOUNT as "TOTAL_AMOUNT",
               HAVE_IN_STOCK_FLG,
               STOCK_COMPANY_CD,
               STOCK_SECTION_PLACE_CD,
               STOCK_PLACE_CD,
               STOCK_PLACE_NAME,
               INSPECT_IND as "inspectInd.inspectInd",
               ARRIV_REMARK as "receiveRemark.remark.comment",
               APP_ROUTE_NAME as "APP_ROUTE_NAME",
               APP_ROUTE_NO as "APP_ROUTE_NO",
               APP_VOUCHER_KEY as "APP_VOUCHER_KEY",
               BACK_APP_COMMENTS as "BACK_APP_COMMENTS"
               ,ARRIV_SECTION_CD as "ARRIV_SECTION_CD"
               ,ARRIV_SECTION_NAME as "ARRIV_SECTION_NAME"
               ,ARRIV_USER_ID as "ARRIV_USER_ID"
               ,ARRIV_USER_NAME as "ARRIV_USER_NAME"
               ,SHIPMENT_DATE
               ,SHIPMENT_VOL
               ,ARVEXP_DATE
               ,SHIPMENT_REMARK
               ,ARRIVAL_VERSION
               ,CORRECT_CD
               ,${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLNoTableName("")}
       FROM (
            SELECT 
               T_ARRIVAL.DELIV_KEY_NO,
               T_ARRIVAL.ARRIVAL_STATUS,
               T_ARRIVAL.ARRIV_EXP_DATE,
               T_ORDER.CURRENCY_CD,
               T_ARRIVAL.DELIV_VOL,
               T_ORDER.UNIT_NAME,
               T_ARRIVAL.ARRIVAL_SEQ,
               T_ARRIVAL.TOTAL_AMOUNT,
               T_ARRIVAL.HAVE_IN_STOCK_FLG,
               T_ARRIVAL.STOCK_COMPANY_CD,
               T_ARRIVAL.STOCK_SECTION_PLACE_CD,
               T_ARRIVAL.STOCK_PLACE_CD,
               T_ARRIVAL.STOCK_PLACE_NAME,
               T_ARRIVAL.INSPECT_IND,
               T_ARRIVAL.ARRIV_REMARK,
               T_ARRIVAL.APP_ROUTE_NAME,
               T_ARRIVAL.APP_ROUTE_NO as,
               T_APPROVAL.APP_VOUCHER_KEY,
               T_APPROVAL.BACK_APP_COMMENTS,
               T_ARRIVAL.ARRIV_SECTION_CD,
               T_ARRIVAL.ARRIV_SECTION_NAME,
               T_ARRIVAL.ARRIV_USER_ID,
               T_ARRIVAL.ARRIV_USER_NAME,
               T_SHIPMENT.SHIPMENT_DATE,
               T_SHIPMENT.SHIPMENT_VOL,
               T_SHIPMENT.ARVEXP_DATE,
               T_SHIPMENT.SHIPMENT_REMARK,
               T_ARRIVAL.ARRIVAL_VERSION,
               T_ARRIVAL.CORRECT_CD,
               ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQL("T_ARRIVAL")}
            FROM  T_ARRIVAL
            INNER JOIN T_ORDER
                    ON T_ARRIVAL.ORDER_NO = T_ORDER.ORDER_NO
                    AND T_ORDER.NEW_FLG = '1'
                    AND T_ORDER.DELETE_FLG = '0'
                    AND T_ORDER.NEW_APP_FLG = '1'
                LEFT JOIN T_APPROVAL
                    ON T_APPROVAL.APP_VOUCHER_KEY = T_ARRIVAL.ARRIVAL_SEQ
                    AND T_APPROVAL.APP_VOUCHER_IND = '3'
                    AND T_APPROVAL.DELETE_FLG = '0'
                LEFT JOIN T_SHIPMENT_MNG
                    ON T_ARRIVAL.DELIV_KEY_NO = T_SHIPMENT_MNG.DELIV_KEY_NO
                    AND T_SHIPMENT_MNG.DELETE_FLG = 0
                LEFT JOIN T_SHIPMENT
                    ON T_SHIPMENT.SHIPMENT_SEQ = T_SHIPMENT_MNG.NEW_SHIPMENT_SEQ
                    AND T_SHIPMENT.CORRECT_CD != '3'
                    AND T_SHIPMENT.DELETE_FLG = 0
		        WHERE T_ARRIVAL.DELETE_FLG = '0'
		        AND T_ORDER.ORDER_NO = #{orderNo}
		    UNION ALL
            SELECT
                T_SHIPMENT.DELIV_KEY_NO,
                N'00' AS ARRIVAL_STATUS,
                null AS ARRIV_EXP_DATE,
                null AS CURRENCY_CD,
                0 AS DELIV_VOL,
                null AS UNIT_NAME,
                null AS ARRIVAL_SEQ,
                null AS TOTAL_AMOUNT,
                null AS HAVE_IN_STOCK_FLG,
                null AS STOCK_COMPANY_CD,
                null AS STOCK_SECTION_PLACE_CD,
                null AS STOCK_PLACE_CD,
                null AS STOCK_PLACE_NAME,
                null AS INSPECT_IND,
                null AS ARRIV_REMARK,
                null AS APP_ROUTE_NAME,
                null AS APP_ROUTE_NO,
                null AS APP_VOUCHER_KEY,
                null AS BACK_APP_COMMENTS,
                null AS ARRIV_SECTION_CD,
                null AS ARRIV_SECTION_NAME,
                null AS ARRIV_USER_ID,
                null AS ARRIV_USER_NAME,
                T_SHIPMENT.SHIPMENT_DATE,
                T_SHIPMENT.SHIPMENT_VOL,
                T_SHIPMENT.ARVEXP_DATE,
                T_SHIPMENT.SHIPMENT_REMARK,
                null AS ARRIVAL_VERSION,
                null AS CORRECT_CD,
                ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLNoTableName("null AS ")}
            FROM 
                T_SHIPMENT
            INNER JOIN 
                T_SHIPMENT_MNG
            ON 
                T_SHIPMENT.SHIPMENT_SEQ = T_SHIPMENT_MNG.NEW_SHIPMENT_SEQ
            AND T_SHIPMENT_MNG.DELETE_FLG = 0
            INNER JOIN 
                T_ORDER
            ON 
                T_SHIPMENT_MNG.ORDER_NO = T_ORDER.ORDER_NO
            AND T_ORDER.DELETE_FLG = '0'
            AND T_ORDER.NEW_APP_FLG = '1'
            WHERE
                T_SHIPMENT.DELETE_FLG = '0'
            AND T_SHIPMENT.CORRECT_CD != '3'
            AND T_ORDER.ORDER_NO = #{orderNo}
            AND NOT EXISTS (
                SELECT 
                    T_SHIPMENT_MNG.ORDER_NO 
                FROM 
                    T_RECEIVE_MNG 
                WHERE 
                    T_SHIPMENT_MNG.ORDER_NO = T_RECEIVE_MNG.ORDER_NO
                AND T_SHIPMENT_MNG.DELIV_KEY_NO = T_RECEIVE_MNG.DELIV_KEY_NO
            )
        )
        ORDER BY DELIV_KEY_NO,ARRIVAL_VERSION,CORRECT_CD
    </select>
    <resultMap type="fw.domain.slip.receive.receive.unreceivelist.UnReceiveIdentify" id="UnReceiveIdentify_Map">
        <id column="DELIV_KEY_NO" property="unReceiveIdentify.delivKeyNo.delivKeyNo"/>
    </resultMap>
    
    
    <!-- ==================PSRCV010 未受入一覧 START ======================== -->
    <!-- 未受入一覧明細MAP -->
    <resultMap type="fw.domain.slip.receive.receive.unreceivelist.UnReceiveListItem" id="UnReceiveListItem_Map">
        <id column="ORDER_SEQ_IDENTIFY" property="unReceiveIdentify.unReceiveIdentify.orderSeq"/>
        <id column="DELIV_NO_KEY_IDENTIFY" property="unReceiveIdentify.unReceiveIdentify.delivKeyNo.delivKeyNo"/>
        <id column="EXCLUSIVE_SLIP_NO" property="exclusiveSlipId.slipNo"/>
        <id column="EXCLUSIVE_LAST_UPD_DATE" property="exclusiveSlipId.lastUpdDate"/>
    </resultMap>
    
    <!-- 未受入一覧取得SELECT句 -->
    <sql id="unReceveListSelect">
        SELECT 
            T_ORDER.ORDER_NO as orderNo,
            (CASE WHEN T_RECEIVE_MNG_A.DELIV_VOL IS NULL THEN 0 ELSE T_RECEIVE_MNG_A.DELIV_VOL END) as "rcvSettledAmount.vol",
            (CASE WHEN T_ORDER.ORDER_VOL IS NULL THEN 0  ELSE T_ORDER.ORDER_VOL END) - (CASE WHEN T_RECEIVE_MNG_A.DELIV_VOL IS NULL THEN 0  ELSE T_RECEIVE_MNG_A.DELIV_VOL END) as "receiveRemainingVol.vol",
            T_ORDER.LAST_UPD_DATE as "unReceiveIdentify.lastUpdDate",
            T_ORDER.REQ_TYPE_IND as reqInd,
            T_ORDER.ITEM_CD as itemCd,
            T_ORDER.ITEM_NAME as item,
            T_ORDER.DELIV_PLACE_CD as delivPlaceCd,
            T_ORDER.DELIV_PLACE_NAME as delivPlaceName,
            (CASE WHEN T_ORDER.ORDER_VOL IS NULL THEN 0 ELSE T_ORDER.ORDER_VOL END) as "orderVol.vol",
            T_ORDER.ORDER_CANCEL_VOL as "orderCancelVol.vol",
            T_ORDER.UNIT_NAME as unit,
            T_ORDER.ORDER_DELIV_DATE as "delivDate.dateOfymd",
            T_ORDER.SUP_CD as supplierFromCd,
            T_ORDER.SUP_ABBR_NAME as supplierFromName,
            T_ORDER.SUBCON_IND as subcontract,
            T_ORDER.EDI_IND as edi,
            T_ORDER.ORDER_FIRST_DATE as "orderDate.dateOfymd",
            T_ORDER.REQ_SECTION_CD as reqSectionCd,
            T_ORDER.REQ_SECTION_NAME as reqSectionName,
            T_ORDER.REQ_USER_ID as reqUserId,
            T_ORDER.REQ_USER_NAME as reqUser,
            T_ORDER.ORDER_SEQ as "ORDER_SEQ_IDENTIFY",
            SHIPMENT.DELIV_KEY_NO AS "delivKeyNo",
            SHIPMENT.SHIPMENT_VOL AS "shipmentVol.vol",
            SHIPMENT.ARVEXP_DATE AS "arrivalDate.dateOfymd",
            T_SLIP_MNG.SLIP_NO AS EXCLUSIVE_SLIP_NO,
            T_SLIP_MNG.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE,
            ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLDomainAliasNonBinary("T_ORDER", "searchResExtItem")}
    </sql>
    
    <!-- 未受入一覧取得FROM句 -->
    <sql id="unReceveListFrom">
        FROM 
            T_ORDER
        INNER JOIN 
            T_SLIP_MNG
        ON 
            T_ORDER.ORDER_NO = T_SLIP_MNG.SLIP_NO
        AND T_SLIP_MNG.RECEIVE_STATUS_IND != '2'
        AND T_SLIP_MNG.DELETE_FLG = '0'
        LEFT JOIN 
            (
                SELECT
                    ORDER_NO, 
                    SUM(DELIV_VOL) DELIV_VOL
                FROM
                    T_RECEIVE_MNG
                WHERE 
                    DELETE_FLG = '0'
                GROUP BY 
                    ORDER_NO
            ) T_RECEIVE_MNG_A
        ON
            T_ORDER.ORDER_NO = T_RECEIVE_MNG_A.ORDER_NO
        LEFT JOIN     <!-- 出荷管理データを取得 -->
            (
                SELECT 
                    T_SHIPMENT_MNG.ORDER_NO,
                    T_SHIPMENT_MNG.DELIV_KEY_NO,
                    T_SHIPMENT.SHIPMENT_VOL,
                    T_SHIPMENT.ARVEXP_DATE
                FROM 
                    T_SHIPMENT_MNG
                LEFT JOIN 
                    T_SHIPMENT 
                ON 
                    T_SHIPMENT_MNG.NEW_SHIPMENT_SEQ = T_SHIPMENT.SHIPMENT_SEQ
                AND T_SHIPMENT.DELETE_FLG = '0'
                WHERE 
                    T_SHIPMENT_MNG.DELETE_FLG = '0'
                AND T_SHIPMENT_MNG.DELIV_KEY_NO =
                    (
                        SELECT 
                            MIN(T_SHIPMENT_MNG_B.DELIV_KEY_NO)
                        FROM 
                            T_SHIPMENT_MNG T_SHIPMENT_MNG_B
                        WHERE 
                            T_SHIPMENT_MNG_B.ORDER_NO = T_SHIPMENT_MNG.ORDER_NO
                        AND T_SHIPMENT_MNG_B.DELETE_FLG = '0'
                        AND NOT EXISTS
                            (
                                SELECT 
                                    DELIV_KEY_NO
                                FROM 
                                    T_RECEIVE_MNG
                                WHERE
                                    T_RECEIVE_MNG.DELIV_STATUS != '1105'
                                AND T_RECEIVE_MNG.DELIV_KEY_NO = T_SHIPMENT_MNG_B.DELIV_KEY_NO
                            )
                     )
                AND T_SHIPMENT.CORRECT_CD != 3
            ) SHIPMENT
        ON
            T_ORDER.ORDER_NO = SHIPMENT.ORDER_NO
    </sql>
    
    <!-- 未受入一覧取得WHERE句 -->
    <sql id="listKeyIdentityWhereCondition">
        ${@ps.common.util.ItemSettingUtil@getItemSettingWhereSQL()}
        <if test="@fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition@isOptionChecked(reqTypeInd,8)">
            AND T_ORDER.REQ_TYPE_IND IN ('2', '3')
        </if>
        <if test="@fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition@isOptionChecked(reqTypeInd,2)">
            AND T_ORDER.REQ_TYPE_IND = '2'
        </if>
        <if test="@fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition@isOptionChecked(reqTypeInd,3)">
            AND T_ORDER.REQ_TYPE_IND = '3'
        </if>
        AND T_ORDER.ORDER_VOL > (CASE WHEN T_RECEIVE_MNG_A.DELIV_VOL IS NULL THEN 0 ELSE T_RECEIVE_MNG_A.DELIV_VOL END)
        AND ((
            T_ORDER.REQ_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==1">
                <if test="@org.apache.commons.lang.StringUtils@isNotBlank(@fw.common.util.AppUtil@getSectionViewRegion())">
                    AND T_ORDER.REQ_SECTION_CD IN (${@fw.common.util.AppUtil@getSectionViewRegion()})
                </if>
            </if>
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==3">
                AND T_ORDER.REQ_SECTION_PLACE_CD = '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}'
            </if>
        ) OR (
            T_ORDER.RECIVE_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==1">
                <if test="@org.apache.commons.lang.StringUtils@isNotBlank(@fw.common.util.AppUtil@getSectionViewRegion())" >
                    AND T_ORDER.RECIVE_SECTION_CD IN (${@fw.common.util.AppUtil@getSectionViewRegion()})
                </if>
            </if>
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==3">
                AND T_ORDER.RECIVE_SECTION_PLACE_CD = '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}'
            </if>
        ) )
        AND T_ORDER.INFO_CD != '0504'
        AND T_ORDER.REQ_TYPE_IND != '9'
        AND T_ORDER.NEW_APP_FLG = '1'
        AND T_ORDER.DELETE_FLG = '0'
    </sql>
    <sql id="quickLinkWhereCondition">
        ${@ps.common.util.ItemSettingUtil@getItemSettingWhereSQL()}
        <if test="@fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition@isOptionChecked(reqTypeInd,8)">
            AND T_ORDER.REQ_TYPE_IND IN ('2', '3')
        </if>
        <if test="@fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition@isOptionChecked(reqTypeInd,2)">
            AND T_ORDER.REQ_TYPE_IND = '2'
        </if>
        <if test="@fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition@isOptionChecked(reqTypeInd,3)">
            AND T_ORDER.REQ_TYPE_IND = '3'
        </if>
        AND ((
            T_ORDER.REQ_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==1">
                <if test="@org.apache.commons.lang.StringUtils@isNotBlank(@fw.common.util.AppUtil@getSectionViewRegion())">
                    AND T_ORDER.REQ_SECTION_CD IN (${@fw.common.util.AppUtil@getSectionViewRegion()})
                </if>
            </if>
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==3">
                AND T_ORDER.REQ_SECTION_PLACE_CD = '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}'
            </if>
        ) OR (
            T_ORDER.RECIVE_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==1">
                <if test="@org.apache.commons.lang.StringUtils@isNotBlank(@fw.common.util.AppUtil@getSectionViewRegion())" >
                    AND T_ORDER.RECIVE_SECTION_CD IN (${@fw.common.util.AppUtil@getSectionViewRegion()})
                </if>
            </if>
            <if test="@fw.common.cache.ConstDataCacheHolder@getConstDataCache().getSystemSetting('ARRIVAL_SECTION_SCOPE').getCondValue()==3">
                AND T_ORDER.RECIVE_SECTION_PLACE_CD = '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}'
            </if>
        ) )
        AND T_ORDER.INFO_CD != '0504'
        AND T_ORDER.REQ_TYPE_IND != '9'
        AND T_ORDER.NEW_APP_FLG = '1'
        AND T_ORDER.DELETE_FLG = '0'
    </sql>

    <!-- 未受入一覧のキーを取得する -->
    <select id="listKeyIdentity" parameterType="fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition" resultMap="UnReceiveIdentify_Map">
        SELECT 
            T_ORDER.ORDER_SEQ as "unReceiveIdentify.orderSeq"
        <include refid="unReceveListFrom" />
        <where>
            <include refid="listKeyIdentityWhereCondition"/>
        </where>  
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>
    
    <!-- 未受入件数を取得する -->
    <select id="quickLinkCount" parameterType="fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition" resultType="java.lang.Integer">
        SELECT 
            COUNT(*)
        FROM 
            T_ORDER
        INNER JOIN 
            T_SLIP_MNG
        ON 
            T_ORDER.ORDER_NO = T_SLIP_MNG.SLIP_NO
        AND T_SLIP_MNG.RECEIVE_STATUS_IND != '2'
        AND T_SLIP_MNG.DELETE_FLG = '0'
        <where>
            <include refid="quickLinkWhereCondition"/>
        </where>  
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>


    <!-- 未受入一覧を取得する -->
    <select id="listPageItem" parameterType="fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition" resultMap="UnReceiveListItem_Map">
        <include refid="unReceveListSelect"/>
        <include refid="unReceveListFrom" />
        <where>
            <include refid="listKeyIdentityWhereCondition"/>
            AND T_ORDER.ORDER_SEQ IN
            <foreach collection="searchCondition.page.keyDomainEntityList" item="keyList" open="(" separator="," close=")">
                (#{keyList.unReceiveIdentify.orderSeq})
            </foreach>
        </where>
         ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>
    
    <!-- 未受入一覧のダウンロード件数を取得する -->
    <select id="downloadCountUnReceiveList" parameterType="fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition" resultType="java.lang.Long">
        SELECT 
            COUNT(1)
        <include refid="unReceveListFrom" />
        <where>
            <include refid="listKeyIdentityWhereCondition"/>
        </where>  
    </select>
    
    <!-- 未受入一覧のダウンロード -->
    <select id="downloadUnReceiveList" parameterType="fw.domain.slip.receive.receive.unreceivelist.UnReceiveSearchCondition" resultMap="UnReceiveListItem_Map">
        <include refid="downloadHeader"/>
        <include refid="unReceveListSelect"/>
        <include refid="unReceveListFrom" />
        <where>
            <include refid="listKeyIdentityWhereCondition"/>
        </where>
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
        <include refid="downloadFooter"/>
    </select>
    
    <!-- ==================PSRCV010 未受入一覧 END ======================== -->
    
    
    <!-- 受入入力  start-->
    <resultMap type="fw.domain.slip.receive.receive.ReceiveApl" id="OrderNew_Map">
        <id column="DELIV_KEY_NO" property="receive.delivKeyNo.delivKeyNo" />
        <id column="DELIV_PLACE_CD" property="receive.order.complement.delivPlace.delivPlaceCd"/>
        <id column="ORDER_NO" property="receive.order.orderNo.orderNo"/>
        <id column="ORDER_DATE" property="receive.order.schedule.orderDate.orderDate.dateOfymd"/>
        <id column="ORDER_SEQ" property="receive.order.orderIdentify.orderSeq"/>
        <id column="ORDER_STATUS" property="receive.order.status.orderStatus.orderStatus"/>
        <id column="BUYER_COMPANY_CD" property="receive.order.buyerCompanyCd"/>
        <id column="DELIV_PLACE_NAME" property="receive.order.complement.delivPlace.delivPlaceName"/>
        <id column="ITEM_CD" property="receive.order.accounting.orderItem.item.itemCd"/>
        <id column="ITEM_NAME" property="receive.order.accounting.orderItem.item.itemName"/>
        <id column="ORDER_DELIV_DATE" property="receive.order.schedule.dlvEst.dlvEst.dateOfymd"/>
        <id column="CURRENCY_CD" property="receive.order.accounting.orderAmount.amountMng.currency.currencyCd"/>
        <id column="TAX_IND" property="receive.order.accounting.orderAmount.amountMng.taxCalculationInd.taxInd.taxInd"/>
        <id column="UNIT_PRICE" property="receive.order.accounting.orderAmount.unitPrice.amount.amount"/>
        <id column="UNIT_PRICE_IND" property="receive.order.status.priceManagement.unitPriceInd"/>
        <id column="ORDER_VOL" property="receive.order.accounting.orderAmount.orderVolume.orderVol.vol"/>
        <id column="ORDER_CANCEL_VOL" property="receive.order.orderCancel.orderCancelVol.vol"/>
        <id column="ORDER_CANCEL_AMOUNT" property="receive.order.orderCancel.orderCancelAmount.amount"/>
        <id column="UNIT_CD" property="receive.order.accounting.orderItem.item.unit.unitCd"/>
        <id column="UNIT_NAME" property="receive.order.accounting.orderItem.item.unit.unitName"/>
        <id column="ORDER_AMOUNT" property="receive.order.accounting.orderAmount.orderAmount.amount"/>
        <id column="SUP_COMPANY_CD" property="receive.order.supplierFrom.supCompanyCd"/>
        <id column="SUP_CD" property="receive.order.supplierFrom.supCd"/>
        <id column="SUP_ABBR_NAME" property="receive.order.supplierFrom.supplierName.supplierAbbrName"/>
        <id column="SUBCON_IND" property="receive.order.supplierFrom.subcon.subconInd"/>
        <id column="EDI_IND" property="receive.order.supplierFrom.ediInd.ediInd"/>
        <id column="INSPECT_IND" property="receive.receiveResult.inspectInd.inspectInd"/>
        <id column="SHIPMENT_VOL" property="receive.shipment.shipmentVol.shipmentVol.vol"/>
        <id column="LAST_UPD_DATE" property="receive.order.orderIdentify.lastUpdDate"/>
        <id column="AUTO_TERMINATE_FLG" property="receive.order.condition.autoTerminateFlg.autoTerminateFlg"/>
        <id column="TAX_RATE" property="receive.order.accounting.orderAmount.taxRate.taxRate"/>
        <id column="ORDER_CNV_RATE" property="receive.order.accounting.orderCnv.orderCnvRate.rate"/>
        <id column="EXCLUSIVE_SLIP_NO" property="receive.identify.rcvSettledListIdentify.exclusiveSlipId.slipNo"/>
        <id column="EXCLUSIVE_LAST_UPD_DATE" property="receive.identify.rcvSettledListIdentify.exclusiveSlipId.lastUpdDate"/>
        <id column="TITLE_NAME" property="receive.order.titleName.titleName"/>
        <id column="KATASHIKI" property="receive.order.accounting.orderItem.item.katashiki"/>
        <id column="MANUFACT_CD" property="receive.order.accounting.orderItem.item.manufact.manufactCd"/>
        <id column="MANUFACT_NAME" property="receive.order.accounting.orderItem.item.manufact.manufactName"/>
        <id column="FOR_SUPPRIER_COMMENT" property="receive.order.orderComment.forSupplierComment.forSupplierComment.comment"/>
    </resultMap>

    <select id="getOrderNew"  resultMap="OrderNew_Map">
        SELECT  T_SHIPMENT_MNG.DELIV_KEY_NO,
                T_ORDER.ORDER_NO,
                T_ORDER.ORDER_FIRST_DATE AS "ORDER_DATE",
                T_ORDER.ORDER_SEQ,
                T_ORDER.ORDER_STATUS,
                T_ORDER.BUYER_COMPANY_CD,
                T_ORDER.DELIV_PLACE_CD,
                T_ORDER.DELIV_PLACE_NAME,
                T_ORDER.ITEM_CD,
                T_ORDER.ITEM_NAME,
                T_ORDER.ORDER_DELIV_DATE,
                T_ORDER.CURRENCY_CD,
                T_ORDER.TAX_IND,
                T_ORDER.UNIT_PRICE,
                T_ORDER.UNIT_PRICE_IND,
                T_ORDER.ORDER_VOL,
                T_ORDER.ORDER_CANCEL_VOL,
                T_ORDER.ORDER_CANCEL_AMOUNT,
                T_ORDER.UNIT_CD,
                T_ORDER.UNIT_NAME,
                T_ORDER.ORDER_AMOUNT,
                T_ORDER.SUP_COMPANY_CD,
                T_ORDER.SUP_CD,
                T_ORDER.SUP_ABBR_NAME,
                T_ORDER.SUBCON_IND,
                T_ORDER.EDI_IND,
                T_ORDER.INSPECT_IND,
                T_ORDER.LAST_UPD_DATE,
                T_ORDER.AUTO_TERMINATE_FLG,
                T_SHIPMENT.SHIPMENT_VOL,
                T_ORDER.TAX_RATE,
                T_ORDER.ORDER_CNV_RATE,
                T_ORDER.TITLE_NAME,
                T_ORDER.KATASHIKI,
                T_ORDER.MANUFACT_CD,
                T_ORDER.MANUFACT_NAME,
                T_ORDER.FOR_SUPPRIER_COMMENT,
                T_SLIP_MNG.SLIP_NO AS EXCLUSIVE_SLIP_NO,
                T_SLIP_MNG.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE
           FROM T_ORDER
           LEFT JOIN T_SHIPMENT_MNG 
                  ON T_ORDER.ORDER_NO = T_SHIPMENT_MNG.ORDER_NO
                  AND T_SHIPMENT_MNG.DELIV_KEY_NO = #{delivKeyNo}
           LEFT JOIN T_SHIPMENT 
                  ON T_SHIPMENT.SHIPMENT_SEQ = T_SHIPMENT_MNG.NEW_SHIPMENT_SEQ
                 AND T_SHIPMENT_MNG.DELETE_FLG = '0'
                 AND T_SHIPMENT.CORRECT_CD != '3'
           LEFT JOIN T_SLIP_MNG
                  ON T_SLIP_MNG.SLIP_NO = T_ORDER.ORDER_NO
                 AND T_SLIP_MNG.DELETE_FLG = '0'
          WHERE T_ORDER.ORDER_SEQ = #{orderSeq}
            AND T_ORDER.INFO_CD != '0504'
            AND T_ORDER.NEW_APP_FLG = '1'
    </select>

    <resultMap type="fw.domain.slip.receive.receive.ReceiveApl" id="OrderCorrect_Map">
        <id column="ORDER_STATUS" property="receive.order.status.orderStatus.orderStatus"/>
        <id column="ORDER_DATE" property="receive.order.schedule.orderDate.orderDate.dateOfymd"/>
        <id column="DELIV_KEY_NO" property="receive.delivKeyNo.delivKeyNo"/>
        <id column="ORDER_SEQ" property="receive.order.orderIdentify.orderSeq"/>
        <id column="BUYER_COMPANY_CD" property="receive.order.buyerCompanyCd"/>
        <id column="DELIV_PLACE_CD" property="receive.order.complement.delivPlace.delivPlaceCd"/>
        <id column="DELIV_PLACE_NAME" property="receive.order.complement.delivPlace.delivPlaceName"/>
        <id column="ITEM_CD" property="receive.order.accounting.orderItem.item.itemCd"/>
        <id column="ITEM_NAME" property="receive.order.accounting.orderItem.item.itemName"/>
        <id column="ORDER_DELIV_DATE" property="receive.order.schedule.dlvEst.dlvEst.dateOfymd"/>
        <id column="CURRENCY_CD" property="receive.order.accounting.orderAmount.amountMng.currency.currencyCd"/>
        <id column="TAX_IND" property="receive.order.accounting.orderAmount.amountMng.taxCalculationInd.taxInd.taxInd"/>
        <id column="UNIT_PRICE" property="receive.order.accounting.orderAmount.unitPrice.amount.amount"/>
        <id column="UNIT_PRICE_IND" property="receive.order.status.priceManagement.unitPriceInd"/>
        <id column="ORDER_VOL" property="receive.order.accounting.orderAmount.orderVolume.orderVol.vol"/>
        <id column="UNIT_CD" property="receive.order.accounting.orderItem.item.unit.unitCd"/>
        <id column="UNIT_NAME" property="receive.order.accounting.orderItem.item.unit.unitName"/>
        <id column="ORDER_AMOUNT" property="receive.order.accounting.orderAmount.orderAmount.amount"/>
        <id column="ORDER_CANCEL_VOL" property="receive.order.orderCancel.orderCancelVol.vol"/>
        <id column="ORDER_CANCEL_AMOUNT" property="receive.order.orderCancel.orderCancelAmount.amount"/>
        <id column="SUP_COMPANY_CD" property="receive.order.supplierFrom.supCompanyCd"/>
        <id column="SUP_CD" property="receive.order.supplierFrom.supCd"/>
        <id column="SUP_ABBR_NAME" property="receive.order.supplierFrom.supplierName.supplierAbbrName"/>
        <id column="SUBCON_IND" property="receive.order.supplierFrom.subcon.subconInd"/>
        <id column="EDI_IND" property="receive.order.supplierFrom.ediInd.ediInd"/>
        <id column="RB_IND" property="receive.rbInd.rbInd"/>
        <id column="CORRECT_CD" property="receive.correctInd.correctInd"/>
        <id column="ARRIVAL_SEQ" property="receive.identify.rcvSettledListIdentify.arrivalSeqNo"/>
        <id column="SHIPMENT_VOL" property="receive.shipment.shipmentVol.shipmentVol.vol"/>
        <id column="ARRIV_SECTION_CD" property="receive.receiveResult.receiveUser.receiveUser.section.sectionCd"/>
        <id column="ARRIV_SECTION_NAME" property="receive.receiveResult.receiveUser.receiveUser.section.sectionName"/>
        <id column="ARRIV_USER_ID" property="receive.receiveResult.receiveUser.receiveUser.userID"/>
        <id column="ARRIV_USER_NAME" property="receive.receiveResult.receiveUser.receiveUser.userName"/>
        <id column="APP_ROUTE_NO" property="application.approute.appRouteNo"/>
        <id column="ARRIV_COMPANY_CD" property="receive.receiveResult.receiveUser.receiveUser.section.company.companyCd"/>
        <id column="ARRIVAL_STATUS" property="receive.arrivalStatus.arrivalStatus"/>
        <id column="ARRIV_EXP_DATE" property="receive.receiveResult.receiveDate.receiveDate.dateOfymd"/>
        <id column="DELIV_VOL" property="receive.receiveResult.receiveVol.receiveVol.vol"/>
        <id column="DELIV_VOL" property="receive.receiveManagement.delivVol.delivVol.vol"/>
        <id column="TOTAL_AMOUNT" property="receive.receiveResult.rcvPriceAmount.rcvPriceAmount.amount"/>
        <id column="HAVE_IN_STOCK_FLG" property="receive.receiveResult.haveInStockFlg.haveInStockFlg"/>
        <id column="STOCK_COMPANY_CD" property="receive.receiveResult.stockPlace.company.companyCd"/>
        <id column="STOCK_SECTION_PLACE_CD" property="receive.receiveResult.stockPlace.sectionPlace.sectionPlaceCd"/>
        <id column="STOCK_PLACE_CD" property="receive.receiveResult.stockPlace.stockPlaceCd"/>
        <id column="STOCK_PLACE_NAME" property="receive.receiveResult.stockPlace.stockPlaceName"/>
        <id column="ARRIV_REMARK" property="receive.receiveResult.receiveRemark.remark.comment"/>
        <id column="INSPECT_IND" property="receive.receiveResult.inspectInd.inspectInd"/>
        <id column="ORDER_NO" property="receive.order.orderNo.orderNo"/>
        <id column="LAST_UPD_DATE" property="receive.order.orderIdentify.lastUpdDate"/>
        <id column="LAST_UPD_DATE_RECEIVE" property="receive.identify.lastUpdDate"/>
        <id column="AUTO_TERMINATE_FLG" property="receive.order.condition.autoTerminateFlg.autoTerminateFlg"/>
        <id column="PART_DELIV_IND" property="receive.receiveResult.partDeliv.partDelivInd.partDelivInd"/>
        <id column="PART_DELIV_NO" property="receive.receiveResult.partDeliv.partDelivNo.partDelivNo"/>
        <id column="TAX_RATE" property="receive.order.accounting.orderAmount.taxRate.taxRate"/>
        <id column="ORDER_CNV_RATE" property="receive.order.accounting.orderCnv.orderCnvRate.rate"/>
        <id column="TITLE_NAME" property="receive.order.titleName.titleName"/>
        <id column="KATASHIKI" property="receive.order.accounting.orderItem.item.katashiki"/>
        <id column="MANUFACT_CD" property="receive.order.accounting.orderItem.item.manufact.manufactCd"/>
        <id column="MANUFACT_NAME" property="receive.order.accounting.orderItem.item.manufact.manufactName"/>
        <id column="FOR_SUPPRIER_COMMENT" property="receive.order.orderComment.forSupplierComment.forSupplierComment.comment"/>

        <id column="EXT_TXT_1" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem1.value" />
        <id column="EXT_TXT_2" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem2.value" />
        <id column="EXT_TXT_3" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem3.value" />
        <id column="EXT_TXT_4" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem4.value" />
        <id column="EXT_TXT_5" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem5.value" />
        <id column="EXT_TXT_6" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem6.value" />
        <id column="EXT_TXT_7" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem7.value" />
        <id column="EXT_TXT_8" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem8.value" />
        <id column="EXT_TXT_9" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem9.value" />
        <id column="EXT_TXT_10" property="receive.receiveResult.editExtItem.editTextExtItem.textExtItem10.value" />
        <id column="EXT_AREA_1" property="receive.receiveResult.editExtItem.editAreaExtItem.arrayExtItem1.value" />
        <id column="EXT_AREA_2" property="receive.receiveResult.editExtItem.editAreaExtItem.arrayExtItem2.value" />
        <id column="EXT_AREA_3" property="receive.receiveResult.editExtItem.editAreaExtItem.arrayExtItem3.value" />
        <id column="EXT_AREA_4" property="receive.receiveResult.editExtItem.editAreaExtItem.arrayExtItem4.value" />
        <id column="EXT_AREA_5" property="receive.receiveResult.editExtItem.editAreaExtItem.arrayExtItem5.value" />
        <id column="EXT_DATE_1" property="receive.receiveResult.editExtItem.editDateExtItem.dateExtItem1.dateType.dateOfymd" />
        <id column="EXT_DATE_2" property="receive.receiveResult.editExtItem.editDateExtItem.dateExtItem2.dateType.dateOfymd" />
        <id column="EXT_DATE_3" property="receive.receiveResult.editExtItem.editDateExtItem.dateExtItem3.dateType.dateOfymd" />
        <id column="EXT_DATE_4" property="receive.receiveResult.editExtItem.editDateExtItem.dateExtItem4.dateType.dateOfymd" />
        <id column="EXT_DATE_5" property="receive.receiveResult.editExtItem.editDateExtItem.dateExtItem5.dateType.dateOfymd" />
        <id column="EXT_INT_1" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem1.value" />
        <id column="EXT_INT_2" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem2.value" />
        <id column="EXT_INT_3" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem3.value" />
        <id column="EXT_INT_4" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem4.value" />
        <id column="EXT_INT_5" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem5.value" />
        <id column="EXT_INT_6" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem6.value" />
        <id column="EXT_INT_7" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem7.value" />
        <id column="EXT_INT_8" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem8.value" />
        <id column="EXT_INT_9" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem9.value" />
        <id column="EXT_INT_10" property="receive.receiveResult.editExtItem.editIntExtItem.intExtItem10.value" />
        <id column="EXT_DEC_1" property="receive.receiveResult.editExtItem.editDecExtItem.decExtItem1.value" />
        <id column="EXT_DEC_2" property="receive.receiveResult.editExtItem.editDecExtItem.decExtItem2.value" />
        <id column="EXT_DEC_3" property="receive.receiveResult.editExtItem.editDecExtItem.decExtItem3.value" />
        <id column="EXT_DEC_4" property="receive.receiveResult.editExtItem.editDecExtItem.decExtItem4.value" />
        <id column="EXT_DEC_5" property="receive.receiveResult.editExtItem.editDecExtItem.decExtItem5.value" />
        <id column="EXT_SEL_1" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem1.value" />
        <id column="EXT_SEL_2" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem2.value" />
        <id column="EXT_SEL_3" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem3.value" />
        <id column="EXT_SEL_4" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem4.value" />
        <id column="EXT_SEL_5" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem5.value" />
        <id column="EXT_SEL_6" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem6.value" />
        <id column="EXT_SEL_7" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem7.value" />
        <id column="EXT_SEL_8" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem8.value" />
        <id column="EXT_SEL_9" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem9.value" />
        <id column="EXT_SEL_10" property="receive.receiveResult.editExtItem.editSelExtItem.selExtItem10.value" />
        <id column="EXT_CHK_1" property="receive.receiveResult.editExtItem.editChkExtItem.chkExtItem1.value" />
        <id column="EXT_CHK_2" property="receive.receiveResult.editExtItem.editChkExtItem.chkExtItem2.value" />
        <id column="EXT_CHK_3" property="receive.receiveResult.editExtItem.editChkExtItem.chkExtItem3.value" />
        <id column="EXT_CHK_4" property="receive.receiveResult.editExtItem.editChkExtItem.chkExtItem4.value" />
        <id column="EXT_CHK_5" property="receive.receiveResult.editExtItem.editChkExtItem.chkExtItem5.value" />
        <id column="EXT_FILE_1" property="receive.receiveResult.editExtItem.editFileExtItem.fileExtItem1.fileName" />
        <id column="EXT_FILE_2" property="receive.receiveResult.editExtItem.editFileExtItem.fileExtItem2.fileName" />
        <id column="EXT_FILE_3" property="receive.receiveResult.editExtItem.editFileExtItem.fileExtItem3.fileName" />
        <id column="EXT_FILE_BINARY_1" property="receive.receiveResult.editExtItem.editFileExtItem.fileExtItem1.binary" />
        <id column="EXT_FILE_BINARY_2" property="receive.receiveResult.editExtItem.editFileExtItem.fileExtItem2.binary" />
        <id column="EXT_FILE_BINARY_3" property="receive.receiveResult.editExtItem.editFileExtItem.fileExtItem3.binary" />
        <id column="EXT_MST_1" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem1.mstKey" />
        <id column="EXT_MST_2" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem2.mstKey" />
        <id column="EXT_MST_3" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem3.mstKey" />
        <id column="EXT_MST_4" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem4.mstKey" />
        <id column="EXT_MST_5" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem5.mstKey" />
        <id column="EXT_MST_6" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem6.mstKey" />
        <id column="EXT_MST_7" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem7.mstKey" />
        <id column="EXT_MST_8" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem8.mstKey" />
        <id column="EXT_MST_NAME_1" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem1.mstName" />
        <id column="EXT_MST_NAME_2" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem2.mstName" />
        <id column="EXT_MST_NAME_3" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem3.mstName" />
        <id column="EXT_MST_NAME_4" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem4.mstName" />
        <id column="EXT_MST_NAME_5" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem5.mstName" />
        <id column="EXT_MST_NAME_6" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem6.mstName" />
        <id column="EXT_MST_NAME_7" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem7.mstName" />
        <id column="EXT_MST_NAME_8" property="receive.receiveResult.editExtItem.editMstExtItem.mstExtItem8.mstName" />
        <id column="EXCLUSIVE_SLIP_NO" property="receive.identify.rcvSettledListIdentify.exclusiveSlipId.slipNo"/>
        <id column="EXCLUSIVE_LAST_UPD_DATE" property="receive.identify.rcvSettledListIdentify.exclusiveSlipId.lastUpdDate"/>
    </resultMap>

    <select id="getOrderCorrect"  resultMap="OrderCorrect_Map">
        SELECT T_RECEIVE_MNG.DELIV_KEY_NO,
               T_RECEIVE_MNG.LAST_UPD_DATE AS "LAST_UPD_DATE_RECEIVE",
               T_ORDER.ORDER_NO,
               T_ORDER.ORDER_FIRST_DATE AS "ORDER_DATE",
               T_ORDER.ORDER_SEQ,
               T_ORDER.ORDER_STATUS,
               T_ORDER.BUYER_COMPANY_CD,
               T_ORDER.DELIV_PLACE_CD,
               T_ORDER.DELIV_PLACE_NAME,
               T_ORDER.ITEM_CD,
               T_ORDER.ITEM_NAME,
               T_ORDER.ORDER_DELIV_DATE,
               T_ORDER.CURRENCY_CD,
               T_ORDER.TAX_IND,
               T_ORDER.UNIT_PRICE,
               T_ORDER.UNIT_PRICE_IND,
               T_ORDER.ORDER_VOL,
               T_ORDER.UNIT_CD,
               T_ORDER.UNIT_NAME,
               T_ORDER.ORDER_AMOUNT,
               T_ORDER.ORDER_CANCEL_VOL,
               T_ORDER.ORDER_CANCEL_AMOUNT,
               T_ORDER.SUP_COMPANY_CD,
               T_ORDER.SUP_CD,
               T_ORDER.SUP_ABBR_NAME,
               T_ORDER.SUBCON_IND,
               T_ORDER.EDI_IND,
               T_ORDER.LAST_UPD_DATE,
               T_ORDER.AUTO_TERMINATE_FLG,
               T_ORDER.TAX_RATE,
               T_ORDER.ORDER_CNV_RATE,
               T_ORDER.TITLE_NAME,
               T_ORDER.KATASHIKI,
               T_ORDER.MANUFACT_CD,
               T_ORDER.MANUFACT_NAME,
               T_ORDER.FOR_SUPPRIER_COMMENT,
               T_ARRIVAL.RB_IND,
               T_ARRIVAL.CORRECT_CD,
               T_ARRIVAL.ARRIVAL_SEQ,
               T_SHIPMENT.SHIPMENT_VOL,
               T_ARRIVAL.ARRIV_SECTION_CD,
               T_ARRIVAL.ARRIV_SECTION_NAME,
               T_ARRIVAL.ARRIV_USER_ID,
               T_ARRIVAL.ARRIV_USER_NAME,
               T_ARRIVAL.APP_ROUTE_NO,
               T_ARRIVAL.ARRIV_COMPANY_CD,
               T_ARRIVAL.ARRIVAL_STATUS,
               T_ARRIVAL.ARRIV_EXP_DATE,
               T_ARRIVAL.DELIV_VOL,
               T_ARRIVAL.DELIV_VOL,
               T_ARRIVAL.TOTAL_AMOUNT,
               T_ARRIVAL.HAVE_IN_STOCK_FLG,
               T_ARRIVAL.STOCK_COMPANY_CD,
               T_ARRIVAL.STOCK_SECTION_PLACE_CD,
               T_ARRIVAL.STOCK_PLACE_CD,
               T_ARRIVAL.STOCK_PLACE_NAME,
               T_ARRIVAL.ARRIV_REMARK,
               T_ARRIVAL.INSPECT_IND,
               T_ARRIVAL.ARRIVAL_SEQ,
               T_ARRIVAL.PART_DELIV_IND,
               T_ARRIVAL.PART_DELIV_NO,
               T_SLIP_MNG.SLIP_NO AS EXCLUSIVE_SLIP_NO,
               T_SLIP_MNG.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE,
               ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQL("T_ARRIVAL")}
               
          FROM T_ORDER
          LEFT JOIN T_SHIPMENT_MNG ON T_ORDER.ORDER_NO = T_SHIPMENT_MNG.ORDER_NO
                                  AND T_SHIPMENT_MNG.DELETE_FLG = '0'
                                  <if test = "@org.apache.commons.lang.StringUtils@isNotBlank(delivKeyNo)" >
                                  AND T_SHIPMENT_MNG.DELIV_KEY_NO = #{delivKeyNo}
                                  </if>
          LEFT JOIN T_SHIPMENT ON T_SHIPMENT.SHIPMENT_SEQ =
                                  T_SHIPMENT_MNG.NEW_SHIPMENT_SEQ
                              AND T_SHIPMENT.CORRECT_CD != '3'
          LEFT JOIN T_RECEIVE_MNG ON T_ORDER.ORDER_NO = T_RECEIVE_MNG.ORDER_NO
                                 AND T_RECEIVE_MNG.DELETE_FLG = '0'
                                 <if test = "@org.apache.commons.lang.StringUtils@isNotBlank(delivKeyNo)" >
                                 AND T_RECEIVE_MNG.DELIV_KEY_NO = #{delivKeyNo}
                                 </if>
          LEFT JOIN T_ARRIVAL ON T_RECEIVE_MNG.NEW_ARRIVAL_SEQ =
                                 T_ARRIVAL.ARRIVAL_SEQ
                             AND T_ARRIVAL.DELETE_FLG = '0'
          LEFT JOIN T_SLIP_MNG
                              ON T_SLIP_MNG.SLIP_NO = T_ORDER.ORDER_NO
                             AND T_SLIP_MNG.DELETE_FLG = '0'
         WHERE T_ORDER.ORDER_SEQ = #{orderSeq}
           AND T_ORDER.INFO_CD != '0504'
           AND T_ORDER.NEW_APP_FLG = '1'
    </select>
    
    <select id="recDeVol" resultType="String">
        SELECT SUM(T_RECEIVE_MNG.DELIV_VOL)
          FROM T_RECEIVE_MNG
         WHERE T_RECEIVE_MNG.ORDER_NO = #{orderNo}
    </select>
  
    <select id="getOrderAndDelivVolByOrderNo" resultType="fw.domain.slip.order.order.OrderVolume">
        SELECT T_ORDER.ORDER_VOL as "orderVol.vol"
             , DELIV_VOL_TOTAL.DELIV_VOL as "receivedVol.vol"
          FROM T_ORDER
          LEFT JOIN (SELECT ORDER_NO, SUM(DELIV_VOL) DELIV_VOL
                       FROM T_RECEIVE_MNG
                      WHERE DELETE_FLG = '0'
                      GROUP BY ORDER_NO) DELIV_VOL_TOTAL
            ON T_ORDER.ORDER_NO = DELIV_VOL_TOTAL.ORDER_NO
         WHERE T_ORDER.ORDER_NO = #{orderNo.orderNo}
                   AND T_ORDER.NEW_APP_FLG = '1'
                   AND T_ORDER.DELETE_FLG = '0'
    </select>

    <select id="getOrderCancelVolByOrderNo" resultType="fw.domain.slip.order.order.OrderCancel">
        SELECT T_ORDER.ORDER_CANCEL_VOL as "orderCancelVol.vol"
          FROM T_ORDER
         WHERE T_ORDER.ORDER_NO = #{orderNo.orderNo}
                   AND T_ORDER.NEW_APP_FLG = '1'
                   AND T_ORDER.DELETE_FLG = '0'
    </select>

    <select id="receiveMngCnt" resultType="int">
       SELECT COUNT(*) AS CNT
         FROM T_RECEIVE_MNG
        WHERE T_RECEIVE_MNG.DELIV_KEY_NO = #{delivKeyNo}
    </select>
    
    <insert id="receiveMngInputInsert">
         INSERT INTO T_RECEIVE_MNG
              (DELIV_KEY_NO,
               ORDER_NO,
               DELIV_STATUS,
               NEW_ARRIVAL_SEQ,
               NEW_INSPECT_SEQ,
               NEW_ACCEPTANCE_SEQ,
               APP_ARRIVAL_SEQ,
               APP_INSPECT_SEQ,
               APP_ACCEPTANCE_SEQ,
               DELIV_VOL,
               DELETE_FLG,
               AUTO_DELETE_FLG,
               AUTO_DELETE_DATE,
               LAST_UPD_DATE,
               LAST_UPD_COMPANY_CD,
               LAST_UPD_SECTION_CD,
               LAST_UPD_USER_ID,
               REG_DATE,
               REG_COMPANY_CD,
               REG_SECTION_CD,
               REG_USER_ID)
            values
              (#{delivKeyNo},
               #{orderNo},
               '2101',
               #{newArrivalSeq},
               '',
               '',
               '',
               '',
               '',
               #{delivVol},
               '0',
               '0',
               '',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}')
    </insert>
    
    <update id="receiveMngInputUpdate">
        UPDATE T_RECEIVE_MNG
           SET DELIV_STATUS        = '2101',
               NEW_ARRIVAL_SEQ     = #{newArrivalSeq},
               APP_INSPECT_SEQ     = '',
               APP_ACCEPTANCE_SEQ  = '',
               DELIV_VOL           = #{delivVol},
               DELETE_FLG          = '0',
               AUTO_DELETE_FLG     = '0',
               AUTO_DELETE_DATE    = '',
               LAST_UPD_DATE       = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}', 
               LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}', 
               LAST_UPD_USER_ID    = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE DELIV_KEY_NO = #{delivKeyNo}
    </update>
    
    <update id="receiveMngCorrectUnappUpdate">
        UPDATE T_RECEIVE_MNG
           SET DELIV_STATUS        = '2101',
               DELIV_VOL           = #{delivVol},
               LAST_UPD_DATE       = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}', 
               LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}', 
               LAST_UPD_USER_ID    = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE DELIV_KEY_NO = #{delivKeyNo}
    </update>
    
    <update id="receiveMngCorrectBackUpdate">
        UPDATE T_RECEIVE_MNG
           SET DELIV_STATUS        = '2101',
               NEW_ARRIVAL_SEQ     = #{newArrivalSeq},
               DELIV_VOL           = #{delivVol},
               LAST_UPD_DATE       = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}', 
               LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}', 
               LAST_UPD_USER_ID    = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE DELIV_KEY_NO = #{delivKeyNo}
    </update>
    
    <update id="receiveMngCorrectPrlUpdate">
        UPDATE T_RECEIVE_MNG
           SET DELIV_STATUS        = '2201',
               NEW_ARRIVAL_SEQ     = #{newArrivalSeq},
               DELIV_VOL           = #{delivVol},
               LAST_UPD_DATE       = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}', 
               LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}', 
               LAST_UPD_USER_ID    = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE DELIV_KEY_NO = #{delivKeyNo}
    </update>
    
    <update id="receiveMngCorrectCancelUpdate">
        UPDATE T_RECEIVE_MNG
           SET DELIV_STATUS        = '2201',
               NEW_ARRIVAL_SEQ     = #{newArrivalSeq},
               DELIV_VOL           = '0',
               LAST_UPD_DATE       = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}', 
               LAST_UPD_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}', 
               LAST_UPD_USER_ID    = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE DELIV_KEY_NO = #{delivKeyNo}
    </update>

    <select id="arrivalcnt" resultType="int">
        SELECT COUNT(*)
        FROM T_RECEIVE_MNG
        WHERE T_RECEIVE_MNG.ORDER_NO = #{OrderNo}
        AND T_RECEIVE_MNG.DELIV_STATUS != '1105'
        AND T_RECEIVE_MNG.DELETE_FLG = '0'
        AND NOT EXISTS
            (
            SELECT
                *
            FROM
                T_ARRIVAL
            WHERE T_RECEIVE_MNG.DELIV_KEY_NO = T_ARRIVAL.DELIV_KEY_NO
            AND T_ARRIVAL.CORRECT_CD = '3'
            AND ARRIVAL_VERSION = 
                (
                SELECT
                    MAX(ARRIVAL_VERSION)
                FROM
                    T_ARRIVAL
                WHERE T_RECEIVE_MNG.DELIV_KEY_NO = T_ARRIVAL.DELIV_KEY_NO
                )
            )
    </select>

    <select id="arrivalFaxInd" resultType="String">
        SELECT ARRIVAL_FAX_IND
          FROM M_SUPPLIER
         WHERE (COMPANY_CD = #{ComPanyCd}
            OR M_SUPPLIER.COMPANY_CD = '${@fw.common.constant.ApplicationConstant@COMPANY_CD_ALL}')
           AND SUP_CD = #{SupCd}
    </select>

    <select id="delivKeyNoMax" resultType="String">
          SELECT MAX(DELIV_KEY_NO) as DELIV_KEY_NO
            FROM T_ARRIVAL
           WHERE ORDER_NO = #{OrderNo}
             AND DELETE_FLG = '0'
    </select>
    
    <select id="reAppSeq" resultType="String">
        SELECT T_RECEIVE_MNG.APP_ARRIVAL_SEQ
          FROM T_RECEIVE_MNG
         WHERE T_RECEIVE_MNG.DELIV_KEY_NO = #{delivKeyNo}
           AND T_RECEIVE_MNG.DELETE_FLG = '0'
    </select>
    
    <insert id="arrivalInputInsert">
         INSERT INTO T_ARRIVAL
              (ARRIVAL_SEQ,
               DELIV_KEY_NO,
               ORDER_NO,
               ARRIVAL_VERSION,
               CORRECT_CD,
               PRE_SEQ,
               RB_IND,
               RB_SEQ,
               ARRIVAL_STATUS,
               ARRIV_EXP_DATE,
               DELIV_VOL,
               UNIT_CD,
               UNIT_NAME,
               TOTAL_AMOUNT,
               UN_DELIV_VOL,
               TOTAL_DELIV_VOL,
               PART_DELIV_IND,
               PART_DELIV_NO,
               ARRIV_COMPANY_CD,
               ARRIV_COMPANY_NAME,
               ARRIV_SECTION_PLACE_CD,
               ARRIV_SECTION_PLACE_NAME,
               ARRIV_SECTION_CD,
               ARRIV_SECTION_NAME,
               ARRIV_USER_ID,
               ARRIV_USER_NAME,
               INSPECT_IND,
               ARRIV_REMARK,
               APP_ROUTE_NO,
               APP_ROUTE_NAME,
               HAVE_IN_STOCK_FLG,
               STOCK_COMPANY_CD,
               STOCK_SECTION_PLACE_CD,
               STOCK_PLACE_CD,
               STOCK_PLACE_NAME,
               SEND_IND,
               RECEIPT_NUMBER,
               FAX_SEND_IND,
               FAX_RECEIPT_NUMBER,
               PRINT_IND,
               BI_OUT_IND,
               DELETE_FLG,
               AUTO_DELETE_FLG,
               AUTO_DELETE_DATE,
               ${@ps.common.util.ItemSettingUtil@getItemSettingInsertSQL()},
               LAST_UPD_DATE,
               LAST_UPD_COMPANY_CD,
               LAST_UPD_SECTION_CD,
               LAST_UPD_USER_ID,
               REG_DATE,
               REG_COMPANY_CD,
               REG_SECTION_CD,
               REG_USER_ID)
            VALUES
              (#{newArrivalSeq},
               #{receive.delivKeyNo.delivKeyNo},
               #{receive.order.orderNo.orderNo},
               #{inspetVesion},
               '1',
               #{reAppSeq},
               '0',
               '',
               '01',
               #{receive.receiveResult.receiveDate.receiveDate.dateOfymd},
               #{receive.receiveResult.receiveVol.receiveVol.vol},
               #{receive.order.accounting.orderItem.item.unit.unitCd},
               #{receive.order.accounting.orderItem.item.unit.unitName},
               #{receive.receiveResult.rcvPriceAmount.rcvPriceAmount.amount},
               #{unDelivVol},
               #{totalDelivVol},
               #{partDelivInd},
               #{partDelivNo},
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getCompanyNameByEscapeSql()}',
               '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getSectionPlaceNameByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionNameByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserNameByEscapeSql()}',
               #{receive.receiveResult.inspectInd.inspectInd},
               #{receive.receiveResult.receiveRemark.remark.comment},
               #{application.approute.appRouteNo},
               #{application.approute.appRouteName},
               #{receive.receiveResult.haveInStockFlg.haveInStockFlg},
               #{receive.receiveResult.stockPlace.company.companyCd},
               #{receive.receiveResult.stockPlace.sectionPlace.sectionPlaceCd},
               #{receive.receiveResult.stockPlace.stockPlaceCd},
               #{receive.receiveResult.stockPlace.stockPlaceName},
               #{ediInd},
               '',
               #{faxediInd},
               '',
               '2',
               '2',
               '0',
               '0',
               '',
               ${@ps.common.util.ItemSettingUtil@getItemSettingInsertValueSQL("receive.receiveResult.editExtItem.")},
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}')
    </insert>
    
    <insert id="arrivalPreInsert">
                INSERT INTO   T_ARRIVAL
               (ARRIVAL_SEQ,
               DELIV_KEY_NO,
               ORDER_NO,
               ARRIVAL_VERSION,
               CORRECT_CD,
               PRE_SEQ,
               RB_IND,
               RB_SEQ,
               ARRIVAL_STATUS,
               ARRIV_EXP_DATE,
               DELIV_VOL,
               UNIT_CD,
               UNIT_NAME,
               TOTAL_AMOUNT,
               UN_DELIV_VOL,
               TOTAL_DELIV_VOL,
               PART_DELIV_IND,
               PART_DELIV_NO,
               ARRIV_COMPANY_CD,
               ARRIV_COMPANY_NAME,
               ARRIV_SECTION_PLACE_CD,
               ARRIV_SECTION_PLACE_NAME,
               ARRIV_SECTION_CD,
               ARRIV_SECTION_NAME,
               ARRIV_USER_ID,
               ARRIV_USER_NAME,
               INSPECT_IND,
               ARRIV_REMARK,
               APP_ROUTE_NO,
               APP_ROUTE_NAME,
               HAVE_IN_STOCK_FLG,
               STOCK_COMPANY_CD,
               STOCK_SECTION_PLACE_CD,
               STOCK_PLACE_CD,
               STOCK_PLACE_NAME,
               SEND_IND,
               RECEIPT_NUMBER,
               FAX_SEND_IND,
               FAX_RECEIPT_NUMBER,
               PRINT_IND,
               BI_OUT_IND,
               DELETE_FLG,
               AUTO_DELETE_FLG,
               AUTO_DELETE_DATE,
               ${@ps.common.util.ItemSettingUtil@getItemSettingInsertSQL()},
               LAST_UPD_DATE,
               LAST_UPD_COMPANY_CD,
               LAST_UPD_SECTION_CD,
               LAST_UPD_USER_ID,
               REG_DATE,
               REG_COMPANY_CD,
               REG_SECTION_CD,
               REG_USER_ID)
               SELECT  #{newArrivalSeq2},
                   T_ARRIVAL.DELIV_KEY_NO,
                   T_ARRIVAL.ORDER_NO,
                   T_ARRIVAL.ARRIVAL_VERSION,
                   '3',
                   '',
                   '1',
                   #{newArrivalSeq},
                   '01',
                   T_ARRIVAL.ARRIV_EXP_DATE,
                   #{receVol},
                   T_ARRIVAL.UNIT_CD,
                   T_ARRIVAL.UNIT_NAME,
                   #{rcvPriceAmount},
                   #{redUnDelivVol},
                   #{redTotalDelivVol},
                   T_ARRIVAL.PART_DELIV_IND,
                   T_ARRIVAL.PART_DELIV_NO,
                   T_ARRIVAL.ARRIV_COMPANY_CD,
                   T_ARRIVAL.ARRIV_COMPANY_NAME,
                   T_ARRIVAL.Arriv_Section_Place_Cd,
                   T_ARRIVAL.ARRIV_SECTION_PLACE_NAME,
                   T_ARRIVAL.Arriv_Section_Cd,
                   T_ARRIVAL.Arriv_Section_Name,
                   T_ARRIVAL.Arriv_User_Id,
                   T_ARRIVAL.Arriv_User_Name,
                   T_ARRIVAL.Inspect_Ind,
                   T_ARRIVAL.ARRIV_REMARK,
                   #{application.approute.appRouteNo},
                   #{application.approute.appRouteName},
                   T_ARRIVAL.HAVE_IN_STOCK_FLG,
                   T_ARRIVAL.STOCK_COMPANY_CD,
                   T_ARRIVAL.STOCK_SECTION_PLACE_CD,
                   T_ARRIVAL.STOCK_PLACE_CD,
                   T_ARRIVAL.STOCK_PLACE_NAME,
                   #{ediInd},
                   '',
                   #{faxediInd},
                   '',
                   '2',
                   '2',
                   '0',
                   '0',
                   '',
                   ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLAlias("T_ARRIVAL")},
                   '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                   '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'           
                FROM    T_ARRIVAL               
                WHERE  ARRIVAL_SEQ = #{arrivalSeq}           
    </insert>
    
    <select id="inspetVesion" resultType="String">
        SELECT MAX(ARRIVAL_VERSION) DELIV_KEY_NO
          FROM T_ARRIVAL
         WHERE DELIV_KEY_NO = #{delivKeyNo}
         AND DELETE_FLG = '0'
         GROUP BY DELIV_KEY_NO        
    </select>
    
    <insert id="arrivalPreBlackInsert">
         INSERT INTO T_ARRIVAL
              (ARRIVAL_SEQ,
               DELIV_KEY_NO,
               ORDER_NO,
               ARRIVAL_VERSION,
               CORRECT_CD,
               PRE_SEQ,
               RB_IND,
               RB_SEQ,
               ARRIVAL_STATUS,
               ARRIV_EXP_DATE,
               DELIV_VOL,
               UNIT_CD,
               UNIT_NAME,
               TOTAL_AMOUNT,
               UN_DELIV_VOL,
               TOTAL_DELIV_VOL,
               PART_DELIV_IND,
               PART_DELIV_NO,
               ARRIV_COMPANY_CD,
               ARRIV_COMPANY_NAME,
               ARRIV_SECTION_PLACE_CD,
               ARRIV_SECTION_PLACE_NAME,
               ARRIV_SECTION_CD,
               ARRIV_SECTION_NAME,
               ARRIV_USER_ID,
               ARRIV_USER_NAME,
               INSPECT_IND,
               ARRIV_REMARK,
               APP_ROUTE_NO,
               APP_ROUTE_NAME,
               HAVE_IN_STOCK_FLG,
               STOCK_COMPANY_CD,
               STOCK_SECTION_PLACE_CD,
               STOCK_PLACE_CD,
               STOCK_PLACE_NAME,
               SEND_IND,
               RECEIPT_NUMBER,
               FAX_SEND_IND,
               FAX_RECEIPT_NUMBER,
               PRINT_IND,
               BI_OUT_IND,
               DELETE_FLG,
               AUTO_DELETE_FLG,
               AUTO_DELETE_DATE,
               ${@ps.common.util.ItemSettingUtil@getItemSettingInsertSQL()},
               LAST_UPD_DATE,
               LAST_UPD_COMPANY_CD,
               LAST_UPD_SECTION_CD,
               LAST_UPD_USER_ID,
               REG_DATE,
               REG_COMPANY_CD,
               REG_SECTION_CD,
               REG_USER_ID)
            VALUES
              (#{newArrivalSeq},
               #{receive.delivKeyNo.delivKeyNo},
               #{receive.order.orderNo.orderNo},
               #{inspetVesion},
               '2',
               #{receive.identify.rcvSettledListIdentify.arrivalSeqNo},
               '0',
               '',
               '01',
               #{receive.receiveResult.receiveDate.receiveDate.dateOfymd},
               #{receive.receiveResult.receiveVol.receiveVol.vol},
               #{receive.order.accounting.orderItem.item.unit.unitCd},
               #{receive.order.accounting.orderItem.item.unit.unitName},
               #{receive.receiveResult.rcvPriceAmount.rcvPriceAmount.amount},
               #{unDelivVol},
               #{totalDelivVol},
               #{partDelivInd},
               #{partDelivNo},
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getCompanyNameByEscapeSql()}',
               '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getSectionPlaceNameByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionNameByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserNameByEscapeSql()}',
               #{receive.receiveResult.inspectInd.inspectInd},
               #{receive.receiveResult.receiveRemark.remark.comment},
               #{application.approute.appRouteNo},
               #{application.approute.appRouteName},
               #{receive.receiveResult.haveInStockFlg.haveInStockFlg},
               #{receive.receiveResult.stockPlace.company.companyCd},
               #{receive.receiveResult.stockPlace.sectionPlace.sectionPlaceCd},
               #{receive.receiveResult.stockPlace.stockPlaceCd},
               #{receive.receiveResult.stockPlace.stockPlaceName},
               #{ediInd},
               '',
               #{faxediInd},
               '',
               '2',
               '2',
               '0',
               '0',
               '',
               ${@ps.common.util.ItemSettingUtil@getItemSettingInsertValueSQL("receive.receiveResult.editExtItem.")},
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}')
    </insert>
    
    <insert id="arrivalCancelInsert">
                INSERT INTO T_ARRIVAL
                    (ARRIVAL_SEQ,
                    DELIV_KEY_NO,
                    ORDER_NO,
                    ARRIVAL_VERSION,
                    CORRECT_CD,
                    PRE_SEQ,
                    RB_IND,
                    RB_SEQ,
                    ARRIVAL_STATUS,
                    ARRIV_EXP_DATE,
                    DELIV_VOL,
                    UNIT_CD,
                    UNIT_NAME,
                    TOTAL_AMOUNT,
                    UN_DELIV_VOL,
                    TOTAL_DELIV_VOL,
                    PART_DELIV_IND,
                    PART_DELIV_NO,
                    ARRIV_COMPANY_CD,
                    ARRIV_COMPANY_NAME,
                    ARRIV_SECTION_PLACE_CD,
                    ARRIV_SECTION_PLACE_NAME,
                    ARRIV_SECTION_CD,
                    ARRIV_SECTION_NAME,
                    ARRIV_USER_ID,
                    ARRIV_USER_NAME,
                    INSPECT_IND,
                    ARRIV_REMARK,
                    APP_ROUTE_NO,
                    APP_ROUTE_NAME,
                    HAVE_IN_STOCK_FLG,
                    STOCK_COMPANY_CD,
                    STOCK_SECTION_PLACE_CD,
                    STOCK_PLACE_CD,
                    STOCK_PLACE_NAME,
                    SEND_IND,
                    RECEIPT_NUMBER,
                    FAX_SEND_IND,
                    FAX_RECEIPT_NUMBER,
                    PRINT_IND,
                    BI_OUT_IND,
                    DELETE_FLG,
                    AUTO_DELETE_FLG,
                    AUTO_DELETE_DATE,
                    ${@ps.common.util.ItemSettingUtil@getItemSettingInsertSQL()},
                    LAST_UPD_DATE,
                    LAST_UPD_COMPANY_CD,
                    LAST_UPD_SECTION_CD,
                    LAST_UPD_USER_ID,
                    REG_DATE,
                    REG_COMPANY_CD,
                    REG_SECTION_CD,
                    REG_USER_ID)
                SELECT  #{newArrivalSeq},
                   #{receive.delivKeyNo.delivKeyNo},
                   #{receive.order.orderNo.orderNo},
                   T_ARRIVAL.ARRIVAL_VERSION,
                   '3',
                   #{receive.identify.rcvSettledListIdentify.arrivalSeqNo},
                   '1',
                   '',
                   '01',
                   T_ARRIVAL.ARRIV_EXP_DATE,
                   #{receVol},
                   T_ARRIVAL.UNIT_CD,
                   T_ARRIVAL.UNIT_NAME,
                   #{rcvPriceAmount},
                   #{redUnDelivVol},
                   #{redTotalDelivVol},
                   T_ARRIVAL.PART_DELIV_IND,
                   T_ARRIVAL.PART_DELIV_NO,
                   T_ARRIVAL.ARRIV_COMPANY_CD,
                   T_ARRIVAL.ARRIV_COMPANY_NAME,
                   T_ARRIVAL.Arriv_Section_Place_Cd,
                   T_ARRIVAL.ARRIV_SECTION_PLACE_NAME,
                   T_ARRIVAL.Arriv_Section_Cd,
                   T_ARRIVAL.Arriv_Section_Name,
                   T_ARRIVAL.Arriv_User_Id,
                   T_ARRIVAL.Arriv_User_Name,
                   T_ARRIVAL.Inspect_Ind,
                   T_ARRIVAL.ARRIV_REMARK,
                   #{application.approute.appRouteNo},
                   #{application.approute.appRouteName},
                   HAVE_IN_STOCK_FLG,
                   STOCK_COMPANY_CD,
                   STOCK_SECTION_PLACE_CD,
                   STOCK_PLACE_CD,
                   STOCK_PLACE_NAME,
                   #{ediInd},
                   '',
                   #{faxediInd},
                   '',
                   '2',
                   '2',
                   '0',
                   '0',
                   '',
                   ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLAlias("T_ARRIVAL")},
                   '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                   '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                   '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                   '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'           
                FROM    T_ARRIVAL               
                WHERE  ARRIVAL_SEQ = #{arrivalSeq}
    </insert>
    
    <update id="arrivalCorUnappBlackUpdate">
        UPDATE T_ARRIVAL
           SET ARRIV_EXP_DATE          = #{receive.receiveResult.receiveDate.receiveDate.dateOfymd},
               DELIV_VOL               = #{receive.receiveResult.receiveVol.receiveVol.vol},
               TOTAL_AMOUNT            = #{receive.receiveResult.rcvPriceAmount.rcvPriceAmount.amount},
               UN_DELIV_VOL            = #{unDelivVol},
               TOTAL_DELIV_VOL         = #{totalDelivVol},
               ARRIV_COMPANY_CD        = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               ARRIV_COMPANY_NAME      = '${@fw.security.SecurityUtil@getCompanyNameByEscapeSql()}',
               ARRIV_SECTION_PLACE_CD  = '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}',
               ARRIV_SECTION_PLACE_NAME = '${@fw.security.SecurityUtil@getSectionPlaceNameByEscapeSql()}',
               ARRIV_SECTION_CD        = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               ARRIV_SECTION_NAME      = '${@fw.security.SecurityUtil@getDefaultSectionNameByEscapeSql()}',
               ARRIV_USER_ID           = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               ARRIV_USER_NAME         = '${@fw.security.SecurityUtil@getUserNameByEscapeSql()}',
               INSPECT_IND             = #{receive.receiveResult.inspectInd.inspectInd},
               ARRIV_REMARK            = #{receive.receiveResult.receiveRemark.remark.comment},
               APP_ROUTE_NO            = #{application.approute.appRouteNo},
               APP_ROUTE_NAME          = #{application.approute.appRouteName},
               HAVE_IN_STOCK_FLG       = #{receive.receiveResult.haveInStockFlg.haveInStockFlg},
               STOCK_COMPANY_CD        = #{receive.receiveResult.stockPlace.company.companyCd},
               STOCK_SECTION_PLACE_CD  = #{receive.receiveResult.stockPlace.sectionPlace.sectionPlaceCd},
               STOCK_PLACE_CD          = #{receive.receiveResult.stockPlace.stockPlaceCd},
               STOCK_PLACE_NAME        = #{receive.receiveResult.stockPlace.stockPlaceName},
               LAST_UPD_DATE           = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD     = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               LAST_UPD_SECTION_CD     = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               LAST_UPD_USER_ID        = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               ${@ps.common.util.ItemSettingUtil@getItemSettingUpdateValueSQL("receive.receiveResult.editExtItem.")}
         WHERE ARRIVAL_SEQ = #{arrivalSeq}
    </update>
    
    <update id="arrivalCorUnappCanCelUpdate">
        UPDATE T_ARRIVAL
           SET APP_ROUTE_NO            = #{application.approute.appRouteNo},
               APP_ROUTE_NAME          = #{application.approute.appRouteName},
               UN_DELIV_VOL            = #{redUnDelivVol},
               TOTAL_DELIV_VOL         = #{redTotalDelivVol},
               LAST_UPD_DATE           = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD     = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               LAST_UPD_SECTION_CD     = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               LAST_UPD_USER_ID        = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE ARRIVAL_SEQ = #{arrivalSeq}
    </update>
    
    <update id="arrivalCorBackBlackUpdate">
        UPDATE T_ARRIVAL
           SET DELETE_FLG              = '1',
               LAST_UPD_DATE           = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD     = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               LAST_UPD_SECTION_CD     = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               LAST_UPD_USER_ID        = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE ARRIVAL_SEQ = #{arrivalSeq}
    </update>
   
    <insert id="arrivalCorBackBlackInsert">
         INSERT INTO T_ARRIVAL
            (ARRIVAL_SEQ,
            DELIV_KEY_NO,
            ORDER_NO,
            ARRIVAL_VERSION,
            CORRECT_CD,
            PRE_SEQ,
            RB_IND,
            RB_SEQ,
            ARRIVAL_STATUS,
            ARRIV_EXP_DATE,
            DELIV_VOL,
            UNIT_CD,
            UNIT_NAME,
            TOTAL_AMOUNT,
            UN_DELIV_VOL,
            TOTAL_DELIV_VOL,
            PART_DELIV_IND,
            PART_DELIV_NO,
            ARRIV_COMPANY_CD,
            ARRIV_COMPANY_NAME,
            ARRIV_SECTION_PLACE_CD,
            ARRIV_SECTION_PLACE_NAME,
            ARRIV_SECTION_CD,
            ARRIV_SECTION_NAME,
            ARRIV_USER_ID,
            ARRIV_USER_NAME,
            INSPECT_IND,
            ARRIV_REMARK,
            APP_ROUTE_NO,
            APP_ROUTE_NAME,
            HAVE_IN_STOCK_FLG,
            STOCK_COMPANY_CD,
            STOCK_SECTION_PLACE_CD,
            STOCK_PLACE_CD,
            STOCK_PLACE_NAME,
            SEND_IND,
            RECEIPT_NUMBER,
            FAX_SEND_IND,
            FAX_RECEIPT_NUMBER,
            PRINT_IND,
            BI_OUT_IND,
            DELETE_FLG,
            AUTO_DELETE_FLG,
            AUTO_DELETE_DATE,
            ${@ps.common.util.ItemSettingUtil@getItemSettingInsertSQL()},
            LAST_UPD_DATE,
            LAST_UPD_COMPANY_CD,
            LAST_UPD_SECTION_CD,
            LAST_UPD_USER_ID,
            REG_DATE,
            REG_COMPANY_CD,
            REG_SECTION_CD,
            REG_USER_ID)
         VALUES (
                #{newArrivalSeq},
                #{receive.delivKeyNo.delivKeyNo},
                #{receive.order.orderNo.orderNo},
                (SELECT ARRIVAL_VERSION FROM T_ARRIVAL WHERE ARRIVAL_SEQ = #{arrivalSeq}),
                (SELECT CORRECT_CD FROM T_ARRIVAL WHERE ARRIVAL_SEQ = #{arrivalSeq}),
                (SELECT PRE_SEQ FROM T_ARRIVAL WHERE ARRIVAL_SEQ = #{arrivalSeq}),
                '0',
                '',
                '01',
                #{receive.receiveResult.receiveDate.receiveDate.dateOfymd},
                #{receive.receiveResult.receiveVol.receiveVol.vol},
                #{receive.order.accounting.orderItem.item.unit.unitCd},
                #{receive.order.accounting.orderItem.item.unit.unitName},
                #{receive.receiveResult.rcvPriceAmount.rcvPriceAmount.amount},
                #{unDelivVol},
                #{totalDelivVol},
                #{partDelivInd},
                #{partDelivNo},
                '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getCompanyNameByEscapeSql()}',
                '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getSectionPlaceNameByEscapeSql()}',
                '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getDefaultSectionNameByEscapeSql()}',
                '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getUserNameByEscapeSql()}',
                #{receive.receiveResult.inspectInd.inspectInd},
                #{receive.receiveResult.receiveRemark.remark.comment},
                #{application.approute.appRouteNo},
                #{application.approute.appRouteName},
                #{receive.receiveResult.haveInStockFlg.haveInStockFlg},
                #{receive.receiveResult.stockPlace.company.companyCd},
                #{receive.receiveResult.stockPlace.sectionPlace.sectionPlaceCd},
                #{receive.receiveResult.stockPlace.stockPlaceCd},
                #{receive.receiveResult.stockPlace.stockPlaceName},
                #{ediInd},
                '',
                #{faxediInd},
                '',
                '2',
                '2',
                '0',
                '0',
                '',
                ${@ps.common.util.ItemSettingUtil@getItemSettingInsertValueSQL("receive.receiveResult.editExtItem.")},
                '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         )
    </insert>
    
    <insert id="arrivalCorBackCancelInsert">
         INSERT INTO T_ARRIVAL
           (ARRIVAL_SEQ,
            DELIV_KEY_NO,
            ORDER_NO,
            ARRIVAL_VERSION,
            CORRECT_CD,
            PRE_SEQ,
            RB_IND,
            RB_SEQ,
            ARRIVAL_STATUS,
            ARRIV_EXP_DATE,
            DELIV_VOL,
            UNIT_CD,
            UNIT_NAME,
            TOTAL_AMOUNT,
            UN_DELIV_VOL,
            TOTAL_DELIV_VOL,
            PART_DELIV_IND,
            PART_DELIV_NO,
            ARRIV_COMPANY_CD,
            ARRIV_COMPANY_NAME,
            ARRIV_SECTION_PLACE_CD,
            ARRIV_SECTION_PLACE_NAME,
            ARRIV_SECTION_CD,
            ARRIV_SECTION_NAME,
            ARRIV_USER_ID,
            ARRIV_USER_NAME,
            INSPECT_IND,
            ARRIV_REMARK,
            APP_ROUTE_NO,
            APP_ROUTE_NAME,
            HAVE_IN_STOCK_FLG,
            STOCK_COMPANY_CD,
            STOCK_SECTION_PLACE_CD,
            STOCK_PLACE_CD,
            STOCK_PLACE_NAME,
            SEND_IND,
            RECEIPT_NUMBER,
            FAX_SEND_IND,
            FAX_RECEIPT_NUMBER,
            PRINT_IND,
            BI_OUT_IND,
            DELETE_FLG,
            AUTO_DELETE_FLG,
            AUTO_DELETE_DATE,
            ${@ps.common.util.ItemSettingUtil@getItemSettingInsertSQL()},
            LAST_UPD_DATE,
            LAST_UPD_COMPANY_CD,
            LAST_UPD_SECTION_CD,
            LAST_UPD_USER_ID,
            REG_DATE,
            REG_COMPANY_CD,
            REG_SECTION_CD,
            REG_USER_ID)
              SELECT #{newArrivalSeq},
                     #{receive.delivKeyNo.delivKeyNo},
                     #{receive.order.orderNo.orderNo},
                     T_ARRIVAL.ARRIVAL_VERSION,
                     T_ARRIVAL.CORRECT_CD,
                     T_ARRIVAL.PRE_SEQ,
                     '1',
                     '',
                     '01',
                     T_ARRIVAL.ARRIV_EXP_DATE,
                     T_ARRIVAL.DELIV_VOL,
                     T_ARRIVAL.UNIT_CD,
                     T_ARRIVAL.UNIT_NAME,
                     T_ARRIVAL.TOTAL_AMOUNT,
                     #{redUnDelivVol},
                     #{redTotalDelivVol},
                     T_ARRIVAL.PART_DELIV_IND,
                     T_ARRIVAL.PART_DELIV_NO,
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getCompanyNameByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getSectionPlaceCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getSectionPlaceNameByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionNameByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserNameByEscapeSql()}',
                     T_ARRIVAL.INSPECT_IND,
                     T_ARRIVAL.ARRIV_REMARK,
                     #{application.approute.appRouteNo},
                     #{application.approute.appRouteName},
                     #{receive.receiveResult.haveInStockFlg.haveInStockFlg},
                     #{receive.receiveResult.stockPlace.company.companyCd},
                     #{receive.receiveResult.stockPlace.sectionPlace.sectionPlaceCd},
                     #{receive.receiveResult.stockPlace.stockPlaceCd},
                     #{receive.receiveResult.stockPlace.stockPlaceName},
                     #{ediInd},
                     '',
                     #{faxediInd},
                     '',
                     '2',
                     '2',
                     '0',
                     '0',
                     '',
                     ${@ps.common.util.ItemSettingUtil@getItemSettingInsertValueSQL("receive.receiveResult.editExtItem.")},
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
                FROM T_ARRIVAL
               WHERE ARRIVAL_SEQ = #{arrivalSeq}
    </insert>
    
    <update id="arrivalCorBackRedUpdate">
        UPDATE T_ARRIVAL
           SET RB_SEQ                  = #{newArrivalSeq},
               ARRIVAL_STATUS          = '01',
               LAST_UPD_DATE           = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               LAST_UPD_COMPANY_CD     = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               LAST_UPD_SECTION_CD     = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               LAST_UPD_USER_ID        = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
         WHERE RB_SEQ = #{arrivalSeq}
    </update>

    <insert id="insertArrSupLngInput">
        INSERT INTO T_ARRIVAL_SUP_LNG
              (ARRIVAL_SEQ,
               ARRIV_COMPANY_NAME,
               ARRIV_SECTION_PLACE_NAME,
               ARRIV_SECTION_NAME,
               ARRIV_USER_NAME,
               UNIT_NAME,
               STOCK_PLACE_NAME,
               AUTO_DELETE_FLG,
               AUTO_DELETE_DATE,
               LAST_UPD_DATE,
               LAST_UPD_COMPANY_CD,
               LAST_UPD_SECTION_CD,
               LAST_UPD_USER_ID,
               REG_DATE,
               REG_COMPANY_CD,
               REG_SECTION_CD,
               REG_USER_ID
               )
            VALUES
              (#{newArrivalSeq},
               #{companyName},
               #{sectionPlaceName},
               #{sectionName},
               #{userName},
               #{unitName},
               #{stockPlaceName},
               '0',
               '',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}')

    </insert>
    
    <insert id="insertArrSupLngPreB">
        INSERT INTO T_ARRIVAL_SUP_LNG
              (ARRIVAL_SEQ,
               ARRIV_COMPANY_NAME,
               ARRIV_SECTION_PLACE_NAME,
               ARRIV_SECTION_NAME,
               ARRIV_USER_NAME,
               UNIT_NAME,
               STOCK_PLACE_NAME,
               AUTO_DELETE_FLG,
               AUTO_DELETE_DATE,
               LAST_UPD_DATE,
               LAST_UPD_COMPANY_CD,
               LAST_UPD_SECTION_CD,
               LAST_UPD_USER_ID,
               REG_DATE,
               REG_COMPANY_CD,
               REG_SECTION_CD,
               REG_USER_ID
               )
            VALUES
              (#{newArrivalSeq},
               #{companyName},
               #{sectionPlaceName},
               #{sectionName},
               #{userName},
               #{unitName},
               #{stockPlaceName},
               '0',
               '',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
               '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
               '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
               '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}')

    </insert>
    
    <insert id="insertArrSupLngPreR">
      INSERT INTO T_ARRIVAL_SUP_LNG (
        ARRIVAL_SEQ
      , ARRIV_COMPANY_NAME
      , ARRIV_SECTION_PLACE_NAME
      , ARRIV_SECTION_NAME
      , ARRIV_USER_NAME
      , UNIT_NAME
      , STOCK_PLACE_NAME
      , AUTO_DELETE_FLG
      , AUTO_DELETE_DATE
      , LAST_UPD_DATE
      , LAST_UPD_COMPANY_CD
      , LAST_UPD_SECTION_CD
      , LAST_UPD_USER_ID
      , REG_DATE
      , REG_COMPANY_CD
      , REG_SECTION_CD
      , REG_USER_ID
      )
              SELECT #{newArrivalSeq2},
                     T_ARRIVAL_SUP_LNG.ARRIV_COMPANY_NAME,
                     T_ARRIVAL_SUP_LNG.ARRIV_SECTION_PLACE_NAME,
                     T_ARRIVAL_SUP_LNG.ARRIV_SECTION_NAME,
                     T_ARRIVAL_SUP_LNG.ARRIV_USER_NAME,
                     T_ARRIVAL_SUP_LNG.UNIT_NAME,
                     T_ARRIVAL_SUP_LNG.STOCK_PLACE_NAME,
                     '0',
                     '',
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
                FROM T_ARRIVAL_SUP_LNG
               WHERE T_ARRIVAL_SUP_LNG.ARRIVAL_SEQ = #{arrivalSeq}

    </insert>
    
    <insert id="insertArrSupLngCancelR">
      INSERT INTO T_ARRIVAL_SUP_LNG (
        ARRIVAL_SEQ
      , ARRIV_COMPANY_NAME
      , ARRIV_SECTION_PLACE_NAME
      , ARRIV_SECTION_NAME
      , ARRIV_USER_NAME
      , UNIT_NAME
      , STOCK_PLACE_NAME
      , AUTO_DELETE_FLG
      , AUTO_DELETE_DATE
      , LAST_UPD_DATE
      , LAST_UPD_COMPANY_CD
      , LAST_UPD_SECTION_CD
      , LAST_UPD_USER_ID
      , REG_DATE
      , REG_COMPANY_CD
      , REG_SECTION_CD
      , REG_USER_ID
      )
              SELECT #{newArrivalSeq},
                     T_ARRIVAL_SUP_LNG.ARRIV_COMPANY_NAME,
                     T_ARRIVAL_SUP_LNG.ARRIV_SECTION_PLACE_NAME,
                     T_ARRIVAL_SUP_LNG.ARRIV_SECTION_NAME,
                     T_ARRIVAL_SUP_LNG.ARRIV_USER_NAME,
                     T_ARRIVAL_SUP_LNG.UNIT_NAME,
                     T_ARRIVAL_SUP_LNG.STOCK_PLACE_NAME,
                     '0',
                     '',
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
                FROM T_ARRIVAL_SUP_LNG
               WHERE T_ARRIVAL_SUP_LNG.ARRIVAL_SEQ = #{arrivalSeq}
    </insert>
    
    <update id="updateArrSupLngCorrB">
              UPDATE T_ARRIVAL_SUP_LNG
                 SET ARRIV_COMPANY_NAME       = #{companyName},
                     ARRIV_SECTION_PLACE_NAME = #{sectionPlaceName},
                     ARRIV_SECTION_NAME       = #{sectionName},
                     ARRIV_USER_NAME          = #{userName},
                     UNIT_NAME                = #{unitName},
                     STOCK_PLACE_NAME         = #{stockPlaceName},
                     LAST_UPD_DATE            = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     LAST_UPD_COMPANY_CD      = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     LAST_UPD_SECTION_CD      = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     LAST_UPD_USER_ID         = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
               WHERE ARRIVAL_SEQ = #{arrivalSeq}
    </update>
    
    <update id="updateArrSupLngCorrCalB">
              UPDATE T_ARRIVAL_SUP_LNG
                 SET ARRIV_COMPANY_NAME       = #{companyName},
                     ARRIV_SECTION_PLACE_NAME = #{sectionPlaceName},
                     ARRIV_SECTION_NAME       = #{sectionName},
                     ARRIV_USER_NAME          = #{userName},
                     UNIT_NAME                = #{unitName},
                     STOCK_PLACE_NAME         = #{stockPlaceName},
                     LAST_UPD_DATE            = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     LAST_UPD_COMPANY_CD      = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     LAST_UPD_SECTION_CD      = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     LAST_UPD_USER_ID         = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
               WHERE ARRIVAL_SEQ = #{arrivalSeq}
    </update>
    
    <update id="updateArrSupLngCorrBackB">
              UPDATE T_ARRIVAL_SUP_LNG
                 SET LAST_UPD_DATE            = '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     LAST_UPD_COMPANY_CD      = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     LAST_UPD_SECTION_CD      = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     LAST_UPD_USER_ID         = '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
               WHERE ARRIVAL_SEQ = #{arrivalSeq}
    </update>
    
    <insert id="insertArrSupLngNewPreB">
      INSERT INTO T_ARRIVAL_SUP_LNG (
        ARRIVAL_SEQ
      , ARRIV_COMPANY_NAME
      , ARRIV_SECTION_PLACE_NAME
      , ARRIV_SECTION_NAME
      , ARRIV_USER_NAME
      , UNIT_NAME
      , STOCK_PLACE_NAME
      , AUTO_DELETE_FLG
      , AUTO_DELETE_DATE
      , LAST_UPD_DATE
      , LAST_UPD_COMPANY_CD
      , LAST_UPD_SECTION_CD
      , LAST_UPD_USER_ID
      , REG_DATE
      , REG_COMPANY_CD
      , REG_SECTION_CD
      , REG_USER_ID
      )
              SELECT #{newArrivalSeq},
                     #{companyName},
                     #{sectionPlaceName},
                     #{sectionName},
                     #{userName},
                     #{unitName},
                     #{stockPlaceName},
                     '0',
                     '',
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}',
                     '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
                     '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
                     '${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
                FROM T_ARRIVAL_SUP_LNG
               WHERE T_ARRIVAL_SUP_LNG.ARRIVAL_SEQ = #{arrivalSeq}
    </insert>
    
    <resultMap type="fw.domain.slip.receive.receive.ReceiveResult" id="volandAmount_Map">
        <id column="DELIV_VOL" property="receiveVol.receiveVol.vol"/>
        <id column="TOTAL_AMOUNT" property="rcvPriceAmount.rcvPriceAmount.amount"/>
    </resultMap>
    <select id="volandAmount"  resultMap="volandAmount_Map">
         SELECT 
               T_ARRIVAL.DELIV_VOL,
               T_ARRIVAL.TOTAL_AMOUNT
          FROM T_ARRIVAL     
         WHERE T_ARRIVAL.ARRIVAL_SEQ = #{arrivalSeq}
    </select>
     <select id="delivKeyNoMinByRec" resultType="String">
          SELECT MIN(T_RECEIVE_MNG.DELIV_KEY_NO)
            FROM T_RECEIVE_MNG
           WHERE T_RECEIVE_MNG.DELIV_STATUS = '1105'
             AND T_RECEIVE_MNG.DELETE_FLG = '0'
             AND T_RECEIVE_MNG.ORDER_NO = #{OrderNo}
    </select>
    <select id="delivKeyNoMinByShp" resultType="String">
          SELECT MIN(T_SHIPMENT_MNG.DELIV_KEY_NO)
            FROM T_SHIPMENT_MNG
           WHERE T_SHIPMENT_MNG.DELETE_FLG = '0'
             AND T_SHIPMENT_MNG.ORDER_NO = #{OrderNo}
    </select>
    <select id="delivKeyNoByRec" resultType="String">
          SELECT MAX(T_RECEIVE_MNG.DELIV_KEY_NO)
            FROM T_RECEIVE_MNG
           WHERE T_RECEIVE_MNG.DELETE_FLG = '0'
             AND T_RECEIVE_MNG.ORDER_NO = #{OrderNo}
    </select>
    
    <select id="redSeq" resultType="String">
          SELECT T_ARRIVAL.ARRIVAL_SEQ
            FROM T_ARRIVAL
           WHERE T_ARRIVAL.RB_SEQ = #{seqno}
             AND T_ARRIVAL.DELETE_FLG = '0'
    </select>
    <!-- 受入入力  end-->


    <!-- ==================PSRCV041 受入済一覧 START ======================== -->

    <!-- 受入済一覧識別情報MAP -->
    <resultMap type="fw.domain.slip.receive.receive.receivedlist.RcvSettledListIdentify" id="RcvSettledIdentify_Map">
        <id column="DELIV_KEY_NO" property="rcvSettledListIdentify.delivKeyNo.delivKeyNo"/>
    </resultMap>

    <!-- 受入済一覧明細MAP -->
    <resultMap type="fw.domain.slip.receive.receive.receivedlist.RcvSettledListItem" id="RcvSettledItem_Map">
        <id column="LAST_UPDATE" property="rcvSettledListIdentify.rcvSettledListIdentify.lastUpdDate"/> 
        <id column="ORDER_SEQ" property="rcvSettledListIdentify.rcvSettledListIdentify.orderSeq"/>
        <id column="delivKeyNo" property="rcvSettledListIdentify.rcvSettledListIdentify.delivKeyNo.delivKeyNo"/>
        <id column="EXCLUSIVE_SLIP_NO" property="exclusiveSlipId.slipNo"/>
        <id column="EXCLUSIVE_LAST_UPD_DATE" property="exclusiveSlipId.lastUpdDate"/>
    </resultMap>

    <!-- 受入済一覧取得SELECT句 -->
    <sql id="settledListSelect">
        SELECT 
            T_RECEIVE_MNG.DELIV_KEY_NO as delivKeyNo,
            T_RECEIVE_MNG.DELIV_STATUS as status,
            T_RECEIVE_MNG.LAST_UPD_DATE as "LAST_UPDATE", 
            T_ARRIVAL.DELIV_VOL as "delivVol.vol",
            A.DELIV_VOL as "rcvSettledAmount.vol",
            CASE WHEN (nvl(T_ORDER.ORDER_VOL,0) - nvl(A.DELIV_VOL,0)) &lt; 0 THEN 0 ELSE (nvl(T_ORDER.ORDER_VOL,0) - nvl(A.DELIV_VOL,0)) END AS "receiveRemainingVol.vol",
            T_RECEIVE_MNG.NEW_INSPECT_SEQ as newInspectSeq,
            T_RECEIVE_MNG.NEW_ACCEPTANCE_SEQ as newAcceptanceSeq,
            T_ARRIVAL.CORRECT_CD as correctInd,
            T_ORDER.REQ_TYPE_IND as reqInd,
            T_ORDER.ITEM_CD as itemCd,
            T_ORDER.ITEM_NAME as item,
            T_ORDER.DELIV_PLACE_CD as delivPlaceCd,
            T_ORDER.DELIV_PLACE_NAME as delivPlaceName,
            T_ORDER.ORDER_VOL as "orderVol.vol",
            T_ORDER.ORDER_CANCEL_VOL as "orderCancelVol.vol",
            T_ORDER.UNIT_NAME as unit,
            T_ORDER.SUP_CD as supplierFromCd,
            T_ORDER.SUP_ABBR_NAME as supplierFromName,
            T_ORDER.SUBCON_IND as subcontract,
            T_ORDER.EDI_IND as edi,
            T_ORDER.ORDER_FIRST_DATE as "orderDate.dateOfymd",
            T_ORDER.REQ_SECTION_CD as reqSectionCd,
            T_ORDER.REQ_SECTION_NAME as reqSectionName,
            T_ORDER.REQ_USER_ID as reqUserId,
            T_ORDER.REQ_USER_NAME as reqUserName,
            T_ARRIVAL.ARRIVAL_VERSION as historyNo,
            T_ARRIVAL.ARRIVAL_STATUS as arrivalStatus,
            T_ARRIVAL.ARRIV_EXP_DATE as "receiveDate.dateOfymd",
            T_ARRIVAL.HAVE_IN_STOCK_FLG as "haveInStockFlg",
            T_ARRIVAL.STOCK_PLACE_CD as "stockPlaceCd",
            T_ARRIVAL.STOCK_PLACE_NAME as "stockPlaceName",
            T_ARRIVAL.ARRIV_SECTION_CD as receiveSectionCd,
            T_ARRIVAL.ARRIV_SECTION_NAME as receiveSectionName,
            T_ARRIVAL.ARRIV_USER_ID as receiveUserId,
            T_ARRIVAL.ARRIV_USER_NAME as receiveUserName,
            T_ORDER.ORDER_SEQ as "ORDER_SEQ",
            T_ORDER.ORDER_NO as orderNo,
            T_SLIP_MNG.SLIP_NO AS EXCLUSIVE_SLIP_NO,
            T_SLIP_MNG.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE,
            ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLDomainAliasNonBinary( "T_ORDER","searchResExtItemOrd")},
            ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLDomainAliasNonBinary( "T_ARRIVAL","searchResExtItemArr")}
    </sql>
    
    <!-- 受入済一覧取得FROM句 -->
    <sql id="settledListFrom">
        FROM 
            T_RECEIVE_MNG
        INNER JOIN 
            T_ORDER
        ON 
            T_RECEIVE_MNG.ORDER_NO = T_ORDER.ORDER_NO
        AND T_ORDER.NEW_APP_FLG = '1'
        AND T_ORDER.DELETE_FLG = '0'
        INNER JOIN 
            T_SLIP_MNG
        ON 
            T_ORDER.ORDER_NO = T_SLIP_MNG.SLIP_NO
        AND T_SLIP_MNG.DELETE_FLG = '0'
        INNER JOIN 
            T_ARRIVAL
        ON 
            T_RECEIVE_MNG.NEW_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
        AND T_ARRIVAL.ARRIVAL_STATUS = '04'
        AND T_ARRIVAL.RB_IND = '0'
        AND T_ARRIVAL.DELETE_FLG = '0'
        INNER JOIN 
            (
                SELECT 
                    ORDER_NO, 
                    SUM(DELIV_VOL) DELIV_VOL
                FROM 
                    T_RECEIVE_MNG
                WHERE 
                    DELETE_FLG = '0'
                GROUP BY 
                    ORDER_NO
            ) A
        ON 
            T_ORDER.ORDER_NO = A.ORDER_NO
    </sql>
    
    <!-- 受入済一覧取得WHERE句 -->
    <sql id="settledListWhere">
        ${@ps.common.util.ItemSettingUtil@getItemSettingWhereSQL()}
        <if test="!@fw.domain.slip.receive.receive.receivedlist.RcvSettledSearchCondition@isOptionChecked(reqTypeInd,8)">
            AND T_ORDER.REQ_TYPE_IND = #{reqTypeInd}
        </if>
        <if test="@fw.domain.slip.receive.receive.receivedlist.RcvSettledSearchCondition@isOptionChecked(reqTypeInd,8)">
            AND T_ORDER.REQ_TYPE_IND IN ('2', '3' ,'9')
        </if>
        <if test="@org.apache.commons.lang.StringUtils@isBlank(inspected)">
            AND T_RECEIVE_MNG.DELIV_STATUS = '2104'
        </if>
            AND T_RECEIVE_MNG.DELETE_FLG = '0'
            AND ((
                <if test = "@org.apache.commons.lang.StringUtils@isNotBlank(@fw.common.util.AppUtil@getSectionViewRegion())">
                    T_ORDER.REQ_SECTION_CD IN (${@fw.common.util.AppUtil@getSectionViewRegion()})
                AND T_ORDER.REQ_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}')
                </if>
                <if test = "@org.apache.commons.lang.StringUtils@isBlank(@fw.common.util.AppUtil@getSectionViewRegion())">
                    T_ORDER.REQ_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}')
                </if>
                OR
                (
                <if test = "@org.apache.commons.lang.StringUtils@isNotBlank(@fw.common.util.AppUtil@getSectionViewRegion())" >
                    T_ARRIVAL.ARRIV_SECTION_CD IN (${@fw.common.util.AppUtil@getSectionViewRegion()})
                AND T_ARRIVAL.ARRIV_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}')
                </if>
                <if test = "@org.apache.commons.lang.StringUtils@isBlank(@fw.common.util.AppUtil@getSectionViewRegion())" >
                    T_ARRIVAL.ARRIV_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}')
                </if>
            )
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(stockPlaceCd)">
            AND T_ARRIVAL.STOCK_COMPANY_CD = #{stockCompanyCd, jdbcType=VARCHAR}
            AND T_ARRIVAL.STOCK_SECTION_PLACE_CD = #{stockSectionPlaceCd, jdbcType=VARCHAR}
        </if>
    </sql>

    <!-- 受入一覧のキーを取得 -->
    <select id="listKeyIdentitySettled"
        parameterType="fw.domain.slip.receive.receive.receivedlist.RcvSettledSearchCondition"
        resultMap="RcvSettledIdentify_Map">
        SELECT 
            T_RECEIVE_MNG.DELIV_KEY_NO as "DELIV_KEY_NO"
        <include refid="settledListFrom"/>
        <where>
            <include refid="settledListWhere"/>    
        </where>  
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>

    <!-- キーで受入一覧を取得 -->
    <select id="listPageItemSettled" 
        parameterType="fw.domain.slip.receive.receive.receivedlist.RcvSettledSearchCondition" 
        resultMap="RcvSettledItem_Map" >
        <include refid="settledListSelect"/>
        <include refid="settledListFrom"/>
        <where>
            <include refid="settledListWhere"/>
            AND (T_RECEIVE_MNG.DELIV_KEY_NO) IN
            <foreach collection="searchCondition.page.keyDomainEntityList" item="keyList"  open="(" separator="," close=")">  
                (#{keyList.rcvSettledListIdentify.delivKeyNo.delivKeyNo})
            </foreach>
        </where>
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>
    
    <!-- 受入済一覧のダウンロード件数を取得 -->
    <select id="downloadCountSettled"  parameterType="fw.domain.slip.receive.receive.receivedlist.RcvSettledSearchCondition"  resultType="java.lang.Long" >
        SELECT 
            COUNT(1)
        <include refid="settledListFrom"/>
        <where>
            <include refid="settledListWhere"/>
        </where>
    </select>

    <!-- 受入済一覧のダウンロード取得 -->
    <select id="downloadSettled"  parameterType="fw.domain.slip.receive.receive.receivedlist.RcvSettledSearchCondition"  resultMap="RcvSettledItem_Map" >
        <include refid="downloadHeader"/>
        <include refid="settledListSelect"/>
        <include refid="settledListFrom"/>
        <where>
            <include refid="settledListWhere"/>
        </where>
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
        <include refid="downloadFooter"/>
    </select>
    <!-- ==================PSRCV041 受付済一覧 END ======================== -->


    <!--  PSRCV070 受入未承認一覧 Start -->
    
    <resultMap type="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppIdentify" id="ReceiveUnAppIdentify_Map">
        <id column="DELIV_KEY_NO" property="receiveUnAppIdentify.delivKeyNo.delivKeyNo"/>
    </resultMap>
    
    <sql id="listKeyIdentityUnAppWhereCondition">
               AND T_RECEIVE_MNG.DELETE_FLG = '0'
               AND T_ORDER.NEW_APP_FLG = '1'
               AND T_ORDER.DELETE_FLG = '0'
               AND T_ORDER.REQ_TYPE_IND != '9'
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(status)">
               AND T_ARRIVAL.ARRIVAL_STATUS = #{status}
            </if>
            <if test="@org.apache.commons.lang.StringUtils@isBlank(status)">
               AND T_ARRIVAL.ARRIVAL_STATUS IN ('01', '02' ,'03')
            </if>
               AND T_ARRIVAL.DELETE_FLG = '0'
               AND T_ARRIVAL.ARRIV_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
               AND T_ARRIVAL.ARRIV_SECTION_CD IN (${@fw.common.util.AppUtil@getSectionViewRegion()})
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(contactName)">
               AND T_ARRIVAL.ARRIV_USER_ID = #{contactName}
            </if>
    </sql>
    <select id="listKeyIdentityUnApp"
        parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppSearchCondition"
        resultMap="ReceiveUnAppIdentify_Map">
        SELECT T_RECEIVE_MNG.DELIV_KEY_NO as "DELIV_KEY_NO"
          FROM T_RECEIVE_MNG
          INNER JOIN T_ORDER
            ON T_RECEIVE_MNG.ORDER_NO = T_ORDER.ORDER_NO
          INNER JOIN T_ARRIVAL
            ON T_RECEIVE_MNG.NEW_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
          <where>
            <include refid="listKeyIdentityUnAppWhereCondition"/>
          </where>
            ORDER BY ${searchCondition.columnOrder.columnOrder()}   
    </select>
    
    <select id="listKeyIdentityUnAppCount"
        parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppSearchCondition"
        resultType="java.lang.Integer">
        SELECT COUNT(*)
          FROM T_RECEIVE_MNG
          INNER JOIN T_ORDER
            ON T_RECEIVE_MNG.ORDER_NO = T_ORDER.ORDER_NO
          INNER JOIN T_ARRIVAL
            ON T_RECEIVE_MNG.NEW_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
          <where>
            <include refid="listKeyIdentityUnAppWhereCondition"/>
          </where>
    </select>
    
    <select id="quickLinkCountUnApp"
        parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppSearchCondition"
        resultType="java.lang.Integer">
        SELECT COUNT(*)
          FROM T_RECEIVE_MNG
          INNER JOIN T_ORDER
            ON T_RECEIVE_MNG.ORDER_NO = T_ORDER.ORDER_NO
          INNER JOIN T_ARRIVAL
            ON T_RECEIVE_MNG.NEW_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
          <where>
            <include refid="listKeyIdentityUnAppWhereCondition"/>
          </where>
    </select>
    
    <resultMap type="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppListItem" id="ReceiveUnAppListItem_Map">
      <id column="LAST_UPDATE" property="receiveUnAppIdentify.receiveUnAppIdentify.lastUpdDate"/> 
      <id column="delivKeyNo" property="receiveUnAppIdentify.receiveUnAppIdentify.delivKeyNo.delivKeyNo" />
      <id column="orderSeq" property="receiveUnAppIdentify.receiveUnAppIdentify.orderSeq"/>
      <id column="orderNo" property="receiveUnAppIdentify.orderNo"/>
      <id column="EXCLUSIVE_SLIP_NO" property="receiveUnAppIdentify.receiveUnAppIdentify.exclusiveSlipId.slipNo"/>
      <id column="EXCLUSIVE_LAST_UPD_DATE" property="receiveUnAppIdentify.receiveUnAppIdentify.exclusiveSlipId.lastUpdDate"/>
    </resultMap>
    
    <select id="listPageItemUnApp"
    parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppSearchCondition"
    resultMap="ReceiveUnAppListItem_Map">
        SELECT T_RECEIVE_MNG.DELIV_KEY_NO as delivKeyNo, 
               T_RECEIVE_MNG.LAST_UPD_DATE as "LAST_UPDATE", 
               T_RECEIVE_MNG_A.DELIV_VOL as "rcvSettledAmount.vol",
               CASE WHEN (nvl(T_ORDER.ORDER_VOL,0) - nvl(T_RECEIVE_MNG_A.DELIV_VOL,0)) &lt; 0 THEN 0 ELSE (nvl(T_ORDER.ORDER_VOL,0) - nvl(T_RECEIVE_MNG_A.DELIV_VOL,0)) END AS "receiveRemainingVol.vol",
               T_ARRIVAL.CORRECT_CD as correctInd,
               T_ARRIVAL.ARRIVAL_VERSION  as arrivalVersion,
               T_ARRIVAL.ARRIVAL_STATUS as status,
               T_ORDER.ORDER_NO as orderNo,
               T_ORDER.ORDER_SEQ as orderSeq,
               T_ORDER.REQ_TYPE_IND as reqTypeInd,
               T_ORDER.ITEM_CD as itemCd,
               T_ORDER.ITEM_NAME as item,
               T_ORDER.DELIV_PLACE_CD as delivPlaceCd,
               T_ORDER.DELIV_PLACE_NAME as delivPlaceName,
               T_ORDER.ORDER_VOL as "orderVol.vol",
               T_ORDER.ORDER_CANCEL_VOL as "orderCancelVol.vol",
               T_ORDER.UNIT_NAME as unit,
               T_ORDER.ORDER_DELIV_DATE as "delivDate.dateOfymd",
               T_ARRIVAL.ARRIVAL_SEQ as arrivalSeq,
               T_ARRIVAL.ARRIV_EXP_DATE as "receiveDate.dateOfymd",
               T_ARRIVAL.HAVE_IN_STOCK_FLG as "haveInStockFlg",
               T_ARRIVAL.STOCK_PLACE_CD as "stockPlaceCd",
               T_ARRIVAL.STOCK_PLACE_NAME as "stockPlaceName",
               T_ARRIVAL.ARRIV_SECTION_CD as receiveSectionCd,
               T_ARRIVAL.ARRIV_SECTION_NAME as receiveSectionName,
               T_ARRIVAL.ARRIV_USER_ID as receiveUserCd,
               T_ARRIVAL.ARRIV_USER_NAME as receiveUserName,
               T_ARRIVAL.PRE_SEQ as preSeq,
               T_ARRIVAL.DELIV_VOL as "delivVol.vol",
               T_ARRIVAL_TMP.DELIV_VOL as "prevDelivVol.vol",
               T_ORDER.SUP_CD as supplierFromCd,
               T_ORDER.SUP_ABBR_NAME as supplierFromName,
               T_ORDER.SUBCON_IND as subcontract,
               T_ORDER.EDI_IND as edi,
               T_ORDER.ORDER_FIRST_DATE as "orderDate.dateOfymd",
               T_ORDER.REQ_SECTION_CD as reqSectionCd,
               T_ORDER.REQ_SECTION_NAME as reqSectionName,
               T_ORDER.REQ_USER_ID as reqUserId,
               T_ORDER.REQ_USER_NAME as reqUserName,
               T_SLIP_MNG.SLIP_NO AS EXCLUSIVE_SLIP_NO,
               T_SLIP_MNG.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE,
               ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLDomainAliasNonBinary( "T_ORDER","searchResExtItemOrder")},
               ${@ps.common.util.ItemSettingUtil@getItemSettingSelectSQLDomainAliasNonBinary( "T_ARRIVAL","searchResExtItemArrival")}
          FROM T_RECEIVE_MNG
          INNER JOIN T_ARRIVAL
                  ON T_RECEIVE_MNG.NEW_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
           LEFT JOIN T_ARRIVAL T_ARRIVAL_TMP
                  ON T_ARRIVAL_TMP.ARRIVAL_SEQ = T_ARRIVAL.PRE_SEQ
          INNER JOIN T_ORDER
                  ON T_RECEIVE_MNG.ORDER_NO = T_ORDER.ORDER_NO
                 AND T_ORDER.NEW_APP_FLG = '1'
                 AND T_ORDER.DELETE_FLG = '0'
          INNER JOIN (SELECT ORDER_NO, SUM(DELIV_VOL) DELIV_VOL
                        FROM T_RECEIVE_MNG
                       WHERE DELETE_FLG = '0'
                       GROUP BY ORDER_NO) T_RECEIVE_MNG_A
                  ON T_ORDER.ORDER_NO = T_RECEIVE_MNG_A.ORDER_NO
          LEFT JOIN T_SLIP_MNG
                  ON T_SLIP_MNG.SLIP_NO = T_ORDER.ORDER_NO
                 AND T_SLIP_MNG.DELETE_FLG = '0'
          <where>
              T_RECEIVE_MNG.DELIV_KEY_NO IN
              <foreach collection="searchCondition.page.keyDomainEntityList" item="keyList"  open="(" separator="," close=")">  
                  #{keyList.receiveUnAppIdentify.delivKeyNo.delivKeyNo}
              </foreach>
              <include refid="listKeyIdentityUnAppWhereCondition"/>
          </where>
          ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>
    
    <!-- ①受入管理を更新：訂正区分は新規の場合 -->
    <update id="updateReceiven" parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppListItem">
        UPDATE T_RECEIVE_MNG
        SET
            DELIV_STATUS = '1105',
            NEW_ARRIVAL_SEQ = #{preSeq},
            DELIV_VOL = '0',
            LAST_UPD_DATE ='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
            LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
            LAST_UPD_SECTION_CD ='${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
            LAST_UPD_USER_ID ='${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
             DELIV_KEY_NO = #{receiveUnAppIdentify.receiveUnAppIdentify.delivKeyNo.delivKeyNo}
    </update>
    
    <!-- ②受入管理を更新：訂正区分が変更・取消の場合-->
    <update id="updateReceiveu" parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppListItem">
        UPDATE T_RECEIVE_MNG
        SET
            DELIV_STATUS = '2104',
            NEW_ARRIVAL_SEQ = #{preSeq},
            DELIV_VOL = #{prevDelivVol.vol},
            LAST_UPD_DATE ='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
            LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
            LAST_UPD_SECTION_CD ='${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
            LAST_UPD_USER_ID ='${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
             DELIV_KEY_NO = #{receiveUnAppIdentify.receiveUnAppIdentify.delivKeyNo.delivKeyNo}
    </update>
    
    <!-- ③入荷を更新：特になしの場合 -->
    <update id="updateAppivaln" parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppListItem">
        UPDATE T_ARRIVAL
        SET
            DELETE_FLG = '1',
            LAST_UPD_DATE='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
            LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
            LAST_UPD_SECTION_CD ='${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
            LAST_UPD_USER_ID ='${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
             ARRIVAL_SEQ = #{arrivalSeq}
    </update>
    <!-- ④入荷を更新：訂正区分が変更の場合のみ -->
    <update id="updateAppivalu" parameterType="fw.domain.slip.receive.receive.receiveapp.ReceiveUnAppListItem">
        UPDATE T_ARRIVAL
        SET
            DELETE_FLG = '1',
            LAST_UPD_DATE='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
            LAST_UPD_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}',
            LAST_UPD_SECTION_CD ='${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}',
            LAST_UPD_USER_ID ='${@fw.security.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
             RB_SEQ = #{arrivalSeq}
    </update>
    <!-- PSRCV070 受入未承認一覧 End -->


    <!-- ====================== 共通 START =================== -->
    <!-- ダウンロードSQLヘッダ -->
    <sql id="downloadHeader">
       SELECT * FROM (
    </sql>
    <!-- ダウンロードSQLフッタ -->
    <sql id="downloadFooter">
        ) WHERE  ROWNUM &lt;=${@fw.common.util.PropertiesUtil@getLong("DOWNLOAD_MAXCNT")}
    </sql>
    <!-- ====================== 共通 END =================== -->
    

</mapper>