<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ps.dataaccess.viw.slip.ViwSlipAllMapper">
    <sql id="extItem">
                    V_SLIP_BUY.ORD_EXT_TXT_1,
                    V_SLIP_BUY.ORD_EXT_TXT_2,
                    V_SLIP_BUY.ORD_EXT_TXT_3,
                    V_SLIP_BUY.ORD_EXT_TXT_4,
                    V_SLIP_BUY.ORD_EXT_TXT_5,
                    V_SLIP_BUY.ORD_EXT_TXT_6,
                    V_SLIP_BUY.ORD_EXT_TXT_7,
                    V_SLIP_BUY.ORD_EXT_TXT_8,
                    V_SLIP_BUY.ORD_EXT_TXT_9,
                    V_SLIP_BUY.ORD_EXT_TXT_10,
                    V_SLIP_BUY.ORD_EXT_AREA_1,
                    V_SLIP_BUY.ORD_EXT_AREA_2,
                    V_SLIP_BUY.ORD_EXT_AREA_3,
                    V_SLIP_BUY.ORD_EXT_AREA_4,
                    V_SLIP_BUY.ORD_EXT_AREA_5,
                    V_SLIP_BUY.ORD_EXT_DATE_1,
                    V_SLIP_BUY.ORD_EXT_DATE_2,
                    V_SLIP_BUY.ORD_EXT_DATE_3,
                    V_SLIP_BUY.ORD_EXT_DATE_4,
                    V_SLIP_BUY.ORD_EXT_DATE_5,
                    V_SLIP_BUY.ORD_EXT_INT_1,
                    V_SLIP_BUY.ORD_EXT_INT_2,
                    V_SLIP_BUY.ORD_EXT_INT_3,
                    V_SLIP_BUY.ORD_EXT_INT_4,
                    V_SLIP_BUY.ORD_EXT_INT_5,
                    V_SLIP_BUY.ORD_EXT_INT_6,
                    V_SLIP_BUY.ORD_EXT_INT_7,
                    V_SLIP_BUY.ORD_EXT_INT_8,
                    V_SLIP_BUY.ORD_EXT_INT_9,
                    V_SLIP_BUY.ORD_EXT_INT_10,
                    V_SLIP_BUY.ORD_EXT_DEC_1,
                    V_SLIP_BUY.ORD_EXT_DEC_2,
                    V_SLIP_BUY.ORD_EXT_DEC_3,
                    V_SLIP_BUY.ORD_EXT_DEC_4,
                    V_SLIP_BUY.ORD_EXT_DEC_5,
                    V_SLIP_BUY.ORD_EXT_SEL_1,
                    V_SLIP_BUY.ORD_EXT_SEL_2,
                    V_SLIP_BUY.ORD_EXT_SEL_3,
                    V_SLIP_BUY.ORD_EXT_SEL_4,
                    V_SLIP_BUY.ORD_EXT_SEL_5,
                    V_SLIP_BUY.ORD_EXT_SEL_6,
                    V_SLIP_BUY.ORD_EXT_SEL_7,
                    V_SLIP_BUY.ORD_EXT_SEL_8,
                    V_SLIP_BUY.ORD_EXT_SEL_9,
                    V_SLIP_BUY.ORD_EXT_SEL_10,
                    V_SLIP_BUY.ORD_EXT_CHK_1,
                    V_SLIP_BUY.ORD_EXT_CHK_2,
                    V_SLIP_BUY.ORD_EXT_CHK_3,
                    V_SLIP_BUY.ORD_EXT_CHK_4,
                    V_SLIP_BUY.ORD_EXT_CHK_5,
                    V_SLIP_BUY.ORD_EXT_FILE_1,
                    V_SLIP_BUY.ORD_EXT_FILE_2,
                    V_SLIP_BUY.ORD_EXT_FILE_3,
                    V_SLIP_BUY.ORD_EXT_MST_1,
                    V_SLIP_BUY.ORD_EXT_MST_2,
                    V_SLIP_BUY.ORD_EXT_MST_3,
                    V_SLIP_BUY.ORD_EXT_MST_4,
                    V_SLIP_BUY.ORD_EXT_MST_5,
                    V_SLIP_BUY.ORD_EXT_MST_6,
                    V_SLIP_BUY.ORD_EXT_MST_7,
                    V_SLIP_BUY.ORD_EXT_MST_8,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_1,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_2,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_3,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_4,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_5,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_6,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_7,
                    V_SLIP_BUY.ORD_EXT_MST_NAME_8,
                    V_SLIP_BUY.APL_EXT_TXT_1,
                    V_SLIP_BUY.APL_EXT_TXT_2,
                    V_SLIP_BUY.APL_EXT_TXT_3,
                    V_SLIP_BUY.APL_EXT_TXT_4,
                    V_SLIP_BUY.APL_EXT_TXT_5,
                    V_SLIP_BUY.APL_EXT_TXT_6,
                    V_SLIP_BUY.APL_EXT_TXT_7,
                    V_SLIP_BUY.APL_EXT_TXT_8,
                    V_SLIP_BUY.APL_EXT_TXT_9,
                    V_SLIP_BUY.APL_EXT_TXT_10,
                    V_SLIP_BUY.APL_EXT_AREA_1,
                    V_SLIP_BUY.APL_EXT_AREA_2,
                    V_SLIP_BUY.APL_EXT_AREA_3,
                    V_SLIP_BUY.APL_EXT_AREA_4,
                    V_SLIP_BUY.APL_EXT_AREA_5,
                    V_SLIP_BUY.APL_EXT_DATE_1,
                    V_SLIP_BUY.APL_EXT_DATE_2,
                    V_SLIP_BUY.APL_EXT_DATE_3,
                    V_SLIP_BUY.APL_EXT_DATE_4,
                    V_SLIP_BUY.APL_EXT_DATE_5,
                    V_SLIP_BUY.APL_EXT_INT_1,
                    V_SLIP_BUY.APL_EXT_INT_2,
                    V_SLIP_BUY.APL_EXT_INT_3,
                    V_SLIP_BUY.APL_EXT_INT_4,
                    V_SLIP_BUY.APL_EXT_INT_5,
                    V_SLIP_BUY.APL_EXT_INT_6,
                    V_SLIP_BUY.APL_EXT_INT_7,
                    V_SLIP_BUY.APL_EXT_INT_8,
                    V_SLIP_BUY.APL_EXT_INT_9,
                    V_SLIP_BUY.APL_EXT_INT_10,
                    V_SLIP_BUY.APL_EXT_DEC_1,
                    V_SLIP_BUY.APL_EXT_DEC_2,
                    V_SLIP_BUY.APL_EXT_DEC_3,
                    V_SLIP_BUY.APL_EXT_DEC_4,
                    V_SLIP_BUY.APL_EXT_DEC_5,
                    V_SLIP_BUY.APL_EXT_SEL_1,
                    V_SLIP_BUY.APL_EXT_SEL_2,
                    V_SLIP_BUY.APL_EXT_SEL_3,
                    V_SLIP_BUY.APL_EXT_SEL_4,
                    V_SLIP_BUY.APL_EXT_SEL_5,
                    V_SLIP_BUY.APL_EXT_SEL_6,
                    V_SLIP_BUY.APL_EXT_SEL_7,
                    V_SLIP_BUY.APL_EXT_SEL_8,
                    V_SLIP_BUY.APL_EXT_SEL_9,
                    V_SLIP_BUY.APL_EXT_SEL_10,
                    V_SLIP_BUY.APL_EXT_CHK_1,
                    V_SLIP_BUY.APL_EXT_CHK_2,
                    V_SLIP_BUY.APL_EXT_CHK_3,
                    V_SLIP_BUY.APL_EXT_CHK_4,
                    V_SLIP_BUY.APL_EXT_CHK_5,
                    V_SLIP_BUY.APL_EXT_FILE_1,
                    V_SLIP_BUY.APL_EXT_FILE_2,
                    V_SLIP_BUY.APL_EXT_FILE_3,
                    V_SLIP_BUY.APL_EXT_MST_1,
                    V_SLIP_BUY.APL_EXT_MST_2,
                    V_SLIP_BUY.APL_EXT_MST_3,
                    V_SLIP_BUY.APL_EXT_MST_4,
                    V_SLIP_BUY.APL_EXT_MST_5,
                    V_SLIP_BUY.APL_EXT_MST_6,
                    V_SLIP_BUY.APL_EXT_MST_7,
                    V_SLIP_BUY.APL_EXT_MST_8,
                    V_SLIP_BUY.APL_EXT_MST_NAME_1,
                    V_SLIP_BUY.APL_EXT_MST_NAME_2,
                    V_SLIP_BUY.APL_EXT_MST_NAME_3,
                    V_SLIP_BUY.APL_EXT_MST_NAME_4,
                    V_SLIP_BUY.APL_EXT_MST_NAME_5,
                    V_SLIP_BUY.APL_EXT_MST_NAME_6,
                    V_SLIP_BUY.APL_EXT_MST_NAME_7,
                    V_SLIP_BUY.APL_EXT_MST_NAME_8,
                    V_SLIP_BUY.REQ_EXT_TXT_1,
                    V_SLIP_BUY.REQ_EXT_TXT_2,
                    V_SLIP_BUY.REQ_EXT_TXT_3,
                    V_SLIP_BUY.REQ_EXT_TXT_4,
                    V_SLIP_BUY.REQ_EXT_TXT_5,
                    V_SLIP_BUY.REQ_EXT_TXT_6,
                    V_SLIP_BUY.REQ_EXT_TXT_7,
                    V_SLIP_BUY.REQ_EXT_TXT_8,
                    V_SLIP_BUY.REQ_EXT_TXT_9,
                    V_SLIP_BUY.REQ_EXT_TXT_10,
                    V_SLIP_BUY.REQ_EXT_AREA_1,
                    V_SLIP_BUY.REQ_EXT_AREA_2,
                    V_SLIP_BUY.REQ_EXT_AREA_3,
                    V_SLIP_BUY.REQ_EXT_AREA_4,
                    V_SLIP_BUY.REQ_EXT_AREA_5,
                    V_SLIP_BUY.REQ_EXT_DATE_1,
                    V_SLIP_BUY.REQ_EXT_DATE_2,
                    V_SLIP_BUY.REQ_EXT_DATE_3,
                    V_SLIP_BUY.REQ_EXT_DATE_4,
                    V_SLIP_BUY.REQ_EXT_DATE_5,
                    V_SLIP_BUY.REQ_EXT_INT_1,
                    V_SLIP_BUY.REQ_EXT_INT_2,
                    V_SLIP_BUY.REQ_EXT_INT_3,
                    V_SLIP_BUY.REQ_EXT_INT_4,
                    V_SLIP_BUY.REQ_EXT_INT_5,
                    V_SLIP_BUY.REQ_EXT_INT_6,
                    V_SLIP_BUY.REQ_EXT_INT_7,
                    V_SLIP_BUY.REQ_EXT_INT_8,
                    V_SLIP_BUY.REQ_EXT_INT_9,
                    V_SLIP_BUY.REQ_EXT_INT_10,
                    V_SLIP_BUY.REQ_EXT_DEC_1,
                    V_SLIP_BUY.REQ_EXT_DEC_2,
                    V_SLIP_BUY.REQ_EXT_DEC_3,
                    V_SLIP_BUY.REQ_EXT_DEC_4,
                    V_SLIP_BUY.REQ_EXT_DEC_5,
                    V_SLIP_BUY.REQ_EXT_SEL_1,
                    V_SLIP_BUY.REQ_EXT_SEL_2,
                    V_SLIP_BUY.REQ_EXT_SEL_3,
                    V_SLIP_BUY.REQ_EXT_SEL_4,
                    V_SLIP_BUY.REQ_EXT_SEL_5,
                    V_SLIP_BUY.REQ_EXT_SEL_6,
                    V_SLIP_BUY.REQ_EXT_SEL_7,
                    V_SLIP_BUY.REQ_EXT_SEL_8,
                    V_SLIP_BUY.REQ_EXT_SEL_9,
                    V_SLIP_BUY.REQ_EXT_SEL_10,
                    V_SLIP_BUY.REQ_EXT_CHK_1,
                    V_SLIP_BUY.REQ_EXT_CHK_2,
                    V_SLIP_BUY.REQ_EXT_CHK_3,
                    V_SLIP_BUY.REQ_EXT_CHK_4,
                    V_SLIP_BUY.REQ_EXT_CHK_5,
                    V_SLIP_BUY.REQ_EXT_FILE_1,
                    V_SLIP_BUY.REQ_EXT_FILE_2,
                    V_SLIP_BUY.REQ_EXT_FILE_3,
                    V_SLIP_BUY.REQ_EXT_MST_1,
                    V_SLIP_BUY.REQ_EXT_MST_2,
                    V_SLIP_BUY.REQ_EXT_MST_3,
                    V_SLIP_BUY.REQ_EXT_MST_4,
                    V_SLIP_BUY.REQ_EXT_MST_5,
                    V_SLIP_BUY.REQ_EXT_MST_6,
                    V_SLIP_BUY.REQ_EXT_MST_7,
                    V_SLIP_BUY.REQ_EXT_MST_8,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_1,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_2,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_3,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_4,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_5,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_6,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_7,
                    V_SLIP_BUY.REQ_EXT_MST_NAME_8
    </sql>

    <sql id="listKeyIdentityWhereCondition">
        AND V_SLIP_BUY.BUYER_COMPANY_CD = '${@fw.security.SecurityUtil@getCompanyCdByEscapeSql()}'
        <!-- 購買部門コード -->
        <if test="!@org.apache.commons.lang.StringUtils@isNotBlank(slipSearchReqAllGrantFlg)">
            AND V_SLIP_BUY.BUYER_SECTION_CD = '${@fw.security.SecurityUtil@getDefaultSectionCdByEscapeSql()}'
        </if>
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(slipSearchReqAllGrantFlg)">
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(buyerSectionCd)">
                AND V_SLIP_BUY.BUYER_SECTION_CD = #{buyerSectionCd}
            </if> 
        </if>
        AND (V_SLIP_BUY.SLIP_STATUS NOT IN
                ('0501','0502','0503','0504', '0505', '0506', '0101', '0102', '0103', '0104', '0105', '0106',
                '0107', '0211', '0212', '0213', '0301', '0302', '0303', '0304',
                '0305', '0306', '0307', '0411', '0412', '0413', '0421', '0422') OR
                (V_SLIP_BUY.QUOT_ACQ_REQ_EXIST_FLG = '0' AND
                V_SLIP_BUY.SLIP_STATUS IN ('0301', '0302', '0303', '0304', '0305', '0306',
                '0307', '0411', '0412', '0413', '0421', '0422')))
        
        <!-- 購入依頼番号 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(purReqNo)">
            AND V_SLIP_BUY.PUR_REQ_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition","purReqNo")}
        </if>
        <!-- 購入申請番号 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(purAplNo)">
            AND V_SLIP_BUY.PUR_APL_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition","purAplNo")}
        </if>
        <!-- 注文番号  -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderNo)">
            AND V_SLIP_BUY.ORDER_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition","orderNo")}
        </if> 
        <!-- 見積依頼番号 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(quotReqNo)">
            AND T_QUOT_REQUEST.QUOT_REQ_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition","quotReqNo")}
        </if> 
        <!-- 件名 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(titleName)">
            AND V_SLIP_BUY.TITLE_NAME ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition","titleName")}
        </if>      
        <!-- 大分類コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(itemClassL)">
            AND V_SLIP_BUY.ITEM_CLASS_L = #{itemClassL}
        </if>  
        <!-- 中分類コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(itemClassM)">
            AND V_SLIP_BUY.ITEM_CLASS_M = #{itemClassM}
        </if>
        <!-- 小分類コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(itemClassS)">
            AND V_SLIP_BUY.ITEM_CLASS_S = #{itemClassS}  
        </if>  
        <!-- 品名分類大分類コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(itemProductClassL)">
            AND V_SLIP_BUY.ITEM_CLASS_L = #{itemProductClassL}
        </if>  
        <!-- 品名分類中分類コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(itemProductClassM)">
            AND V_SLIP_BUY.ITEM_CLASS_M = #{itemProductClassM}
        </if>  
        <!-- 品名分類小分類コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(itemProductClassS)">
            AND V_SLIP_BUY.ITEM_CLASS_S = #{itemProductClassS}  
        </if>  
        <!-- 品名コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(itemCd)">
            AND V_SLIP_BUY.ITEM_CD = #{itemCd}
        </if> 
        <!-- 品名 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(item)">
            AND V_SLIP_BUY.ITEM_NAME ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition","item")}
        </if>    
        <!-- 取引先コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(supplierCd)">
            AND V_SLIP_BUY.SUP_CD = #{supplierCd}
        </if>
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(priceUndecidedness)">
            AND V_SLIP_BUY.UNIT_PRICE_IND = '0'
        </if>
        <!-- 購買担当者ID -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(buyerUserId)">
            AND V_SLIP_BUY.BUYER_USER_ID = #{buyerUserId}
        </if> 
        <!-- 依頼元部門コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(reqSectionCd)">
            AND V_SLIP_BUY.REQ_SECTION_CD = #{reqSectionCd}
        </if> 
        <!-- 依頼元担当者ID -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(reqUserId)">
            AND V_SLIP_BUY.REQ_USER_ID = #{reqUserId}
        </if> 
        <!-- 納入先コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(delivPlaceCd)">
            AND V_SLIP_BUY.DELIV_PLACE_CD = #{delivPlaceCd}
        </if> 
        <!-- 注文納期 from-->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderDelivDateFrom.dateOfymd)">
            AND V_SLIP_BUY.ORDER_DELIV_DATE >= #{orderDelivDateFrom.dateOfymd}
        </if>
        <!-- 注文納期to -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderDelivDateTo.dateOfymd)">
            AND V_SLIP_BUY.ORDER_DELIV_DATE &lt;= #{orderDelivDateTo.dateOfymd}
        </if>
        <!-- 注文日 from-->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderDateFrom.dateOfymd)">
            AND V_SLIP_BUY.ORDER_DATE >= #{orderDateFrom.dateOfymd}
        </if>
        <!-- 注文日 to-->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderDateTo.dateOfymd)">
            AND V_SLIP_BUY.ORDER_DATE &lt;= #{orderDateTo.dateOfymd}
        </if>
        <!-- 購入依頼日 from-->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(purReqDateFrom.dateOfymd)">
            AND V_SLIP_BUY.PUR_REQ_DATE >= #{purReqDateFrom.dateOfymd}
        </if>
        <!-- 購入依頼日 to-->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(purReqDateTo.dateOfymd)">
            AND V_SLIP_BUY.PUR_REQ_DATE &lt;= #{purReqDateTo.dateOfymd}
        </if>
        <!-- 依頼区分 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(reqInd)">
            <if test="!@org.apache.commons.lang.StringUtils@equals('8',reqInd)">
                AND V_SLIP_BUY.REQ_TYPE_IND  = #{reqInd}
            </if>
        </if>
        <!-- 負担部門コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(loadSectionCd)">
            AND V_SLIP_BUY.LOAD_SECTION_CD = #{loadSectionCd}
        </if> 
        <!-- 予算番号 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(budgetNo)">
            AND V_SLIP_BUY.BUDGET_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.businesscommon.slipsearch.SlipSearchCondition","budgetNo")}
        </if> 
        <!-- 型式 -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(katashiki)">
            AND V_SLIP_BUY.KATASHIKI ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.slip.businesscommon.slipsearch.SlipSearchCondition","katashiki")}
        </if>
        <!-- 科目コード -->
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(subjectCd)">
            AND V_SLIP_BUY.SUBJECT_CD = #{subjectCd}
        </if> 
        <!-- 受入状況のいづれかが選択されていた場合 若しくは、検収状況のいづれかが選択していた場合 -->
        <if test="!receiveStates.empty or !acceptanceStates.empty">
            AND V_SLIP_BUY.ORDER_STATUS != '10'
        </if>
        <if test="!receiveStates.empty">
            AND V_SLIP_BUY.RECEIVE_STATUS_IND IN
            <foreach collection="receiveStates.list" item="receiveStatus" open="(" separator="," close=")">
                #{receiveStatus, jdbcType=VARCHAR}
            </foreach>
        </if>
        <if test="!acceptanceStates.empty">
            AND V_SLIP_BUY.ACCEPTANCE_STATUS_IND IN
            <foreach collection="acceptanceStates.list" item="acceptanceStatus" open="(" separator="," close=")">
                #{acceptanceStatus, jdbcType=VARCHAR}
            </foreach>
        </if>
    </sql>

    <select id="download" parameterType="fw.domain.mst.searchcondition.SearchCondition"
        resultMap="SlipSearchByBuyerItem_Map">
        WITH V_SLIP_BUY_IDENTIFY AS (
        <include refid="downloadIdentify"/>
        ),
        V_T_ATTACH_MNG AS (
            SELECT  ATTACH_FILE_SEQ
            ,       ATTACH_SCOPE
            FROM    T_ATTACH_MNG
        ),
        V_H_ATTACH_MNG AS (
            SELECT  ATTACH_FILE_SEQ
            ,       ATTACH_SCOPE
            FROM    H_ATTACH_MNG
        )        
        SELECT * FROM (
        SELECT 
            V_SLIP_BUY.SLIP_NO AS slipNo,
            V_SLIP_BUY.PUR_REQ_NO AS purReqNo,
            V_SLIP_BUY.REQ_TYPE_IND AS reqInd,
            V_SLIP_BUY.CORRECT_CD AS correctCd,
            V_SLIP_BUY.PUR_REQ_DATE AS "purReqDate.dateOfymd",
            V_SLIP_BUY.ORDER_NO AS orderNo,
            V_SLIP_BUY.ORDER_DATE AS "orderDate.dateOfymd",
            T_QUOT_REQUEST.QUOT_REQ_NO AS "quotReqNo",
            V_SLIP_BUY.PUR_APL_NO AS purAplNo,
            V_SLIP_BUY.TITLE_NAME AS titleName,
            V_SLIP_BUY.SUP_CD AS supCd,
            V_SLIP_BUY.SUP_ABBR_NAME AS supName,
            V_SLIP_BUY.SUBCON_IND AS subconInd,
            V_SLIP_BUY.EDI_IND AS ediInd,
            V_SLIP_BUY.ITEM_CD AS itemCd,
            V_SLIP_BUY.ITEM_NAME AS itemName,
            V_SLIP_BUY.KATASHIKI AS katashiki,
            V_SLIP_BUY.MANUFACT_CD AS manufactCd,
            V_SLIP_BUY.MANUFACT_NAME AS manufactName,
            V_SLIP_BUY.REQ_DELIV_DATE AS "reqDelivDate.dateOfymd",
            V_SLIP_BUY.ORDER_DELIV_DATE AS "orderDelivDate.dateOfymd",
            V_SLIP_BUY.UNIT_NAME AS unitName,
            V_SLIP_BUY.REQ_VOL AS "hopeVol.vol",
            V_SLIP_BUY.ORDER_VOL AS "orderVol.vol",
            CASE WHEN (V_SLIP_BUY.ORDER_VOL - nvl(V_SLIP_BUY.RECEIVED_VOL,0)) &lt; 0 THEN 0 ELSE (V_SLIP_BUY.ORDER_VOL - nvl(V_SLIP_BUY.RECEIVED_VOL,0)) END AS "receiveRemainingVol.vol",
            V_SLIP_BUY.UNIT_PRICE_IND AS unitPriceInd,
            V_SLIP_BUY.HOPE_CURRENCY_CD AS hopeAmountCurrencyCd,
            V_SLIP_BUY.CURRENCY_CD AS currencyCd,
            V_SLIP_BUY.REQ_UNIT_PRICE AS "hopeUnitPrice.amount",
            V_SLIP_BUY.REQ_AMOUNT AS "hopeAmount.amount",
            V_SLIP_BUY.ORDER_UNIT_PRICE AS "orderUnitPrice.amount",
            V_SLIP_BUY.ORDER_AMOUNT AS "orderAmount.amount",
            V_SLIP_BUY.ORDER_CANCEL_VOL,
            V_SLIP_BUY.ORDER_CANCEL_AMOUNT,
            V_SLIP_BUY.TAX_IND AS taxInd,
            V_SLIP_BUY.BUDGET_NO AS budgetNo,
            V_SLIP_BUY.SUBJECT_CD AS subjectCd,
            V_SLIP_BUY.SUBJECT_NAME AS subjectName,
            V_SLIP_BUY.DELIV_PLACE_CD AS delivPlaceCd,
            V_SLIP_BUY.DELIV_PLACE_NAME AS delivPlaceName,
            V_SLIP_BUY.ITEM_CLASS_L_NAME AS itemClassLName,
            V_SLIP_BUY.ITEM_CLASS_M_NAME AS itemClassMName,
            V_SLIP_BUY.ITEM_CLASS_S_NAME AS itemClassSName,
            V_SLIP_BUY.REQ_SECTION_CD AS purReqSectionCd,
            V_SLIP_BUY.REQ_SECTION_NAME AS purReqSectionName,
            V_SLIP_BUY.REQ_USER_ID AS purReqUserCd,
            V_SLIP_BUY.REQ_USER_NAME AS purReqUserName,
            V_SLIP_BUY.BUYER_SECTION_NAME AS buyerSectionName,
            V_SLIP_BUY.BUYER_SECTION_CD AS buyerSectionCd,
            V_SLIP_BUY.BUYER_USER_NAME AS buyerUserName,
            V_SLIP_BUY.BUYER_USER_ID AS buyerUserId,
            V_SLIP_BUY.LOAD_SECTION_CD AS loadSectionCd,
            V_SLIP_BUY.LOAD_SECTION_NAME AS loadSectionName,
            V_SLIP_BUY.SLIP_STATUS AS slipStatus,
            V_SLIP_BUY.RECEIVE_STATUS_IND AS receiveStatusInd,
            V_SLIP_BUY.INSPECT_STATUS_IND AS inspectStatusInd,
            V_SLIP_BUY.ACCEPTANCE_STATUS_IND AS acceptanceStatusInd,
            TEST2.DELIV_VOL AS "delivVol.vol",
            T_QUOT_ACQ_APL.QUOT_ACQ_APL_STATUS AS quotAcqAplStat,
            T_QUOT_REQUEST.QUOT_REQ_SEQ AS quotReqSeqNo,
            V_SLIP_BUY.ORDER_SEQ AS orderSeq,
            TEST1.KENSHU AS kenshu,
            V_SLIP_BUY.PUR_APL_SEQ AS purAplSeqNo,
            V_SLIP_BUY.APP_UNIT_NO AS appUnitNo,
            V_SLIP_BUY.REQ_TYPE_IND AS reqTypeIndName,
            V_SLIP_BUY.SUBCON_IND AS subconIndName,
            V_SLIP_BUY.EDI_IND AS ediIndName,
            V_SLIP_BUY.UNIT_CD AS unitCd,
            V_SLIP_BUY.TAX_IND AS taxIndName,
            V_SLIP_BUY.ITEM_CLASS_L AS itemClassL,
            V_SLIP_BUY.ITEM_CLASS_M AS itemClassM,
            V_SLIP_BUY.ITEM_CLASS_S AS itemClassS,
            V_SLIP_BUY.REQ_COMPANY_CD AS reqCompanyCd,
            V_SLIP_BUY.REQ_COMPANY_NAME AS reqCompanyName,
            V_SLIP_BUY.REQ_SECTION_PLACE_CD AS "reqSectionPlaceCd",
            V_SLIP_BUY.REQ_SECTION_PLACE_NAME AS reqSectionPlaceName,
            V_SLIP_BUY.BUYER_COMPANY_CD AS buyerCompanyCd,
            V_SLIP_BUY.BUYER_COMPANY_NAME AS buyerCompanyName,
            V_SLIP_BUY.BUYER_SECTION_PLACE_CD AS purSectionPlaceCd,
            V_SLIP_BUY.BUYER_SECTION_PLACE_NAME AS purSectionPlaceName,
            V_SLIP_BUY.BUYER_SECTION_NAME AS "purSectionName",
            V_SLIP_BUY.BUYER_SECTION_CD AS "purSectionCd",
            V_SLIP_BUY.BUYER_USER_NAME AS "purUserName",
            V_SLIP_BUY.BUYER_USER_ID AS "purUserId",
            V_SLIP_BUY.COMMENT_1 AS comment1,
            V_SLIP_BUY.COMMENT_2 AS comment2,
            V_SLIP_BUY.ORDER_INPUT_DATE AS "orderRegisterDate.dateOfymd",
            ORDER_ATTACH_1.ATTACH_SCOPE AS "attachScope1",
            ORDER_ATTACH_2.ATTACH_SCOPE AS "attachScope2",
            ORDER_ATTACH_3.ATTACH_SCOPE AS "attachScope3",
            PUR_APL_ATTACH_1.ATTACH_SCOPE AS "attachScope4",
            PUR_APL_ATTACH_2.ATTACH_SCOPE AS "attachScope5"
            ,APPROVED_T_ARRIVAL.APPROVED_DELIV_VOL AS "approvedDelivVol.vol"
            , V_SLIP_BUY.ACCEPT_VOL AS "acceptVol.vol"
            , V_SLIP_BUY.ACCEPT_AMOUNT AS "acceptAmount.amount"
            , V_SLIP_BUY.RECEIVED_VOL AS "receivedVol.vol"
            ,<include refid="extItem"/>
            , V_SLIP_BUY.PUR_APL_NO
            , V_SLIP_BUY.PUR_REQ_NO
        FROM V_SLIP_BUY
        LEFT JOIN
            (
               SELECT      QUOT_REQ_NO
               ,           QUOT_REQ_SEQ
               FROM        T_QUOT_REQUEST
               WHERE       QUOT_TYPE_IND IN ('1', '4')
               AND         NEW_FLG = '1'
               AND         DELETE_FLG = '0'
            ) T_QUOT_REQUEST 
            ON 
                (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
                OR  V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
        LEFT JOIN
            (
                SELECT      QUOT_ACQ_APL_NO
                ,           QUOT_ACQ_APL_STATUS
                FROM        T_QUOT_ACQ_APL
                WHERE       NEW_FLG = '1'       
                AND         DELETE_FLG ='0'
            ) T_QUOT_ACQ_APL
            ON T_QUOT_ACQ_APL.QUOT_ACQ_APL_NO = V_SLIP_BUY.PUR_APL_NO
        LEFT JOIN ( 
            SELECT T_DLV_EST_MNG.ORDER_NO,
                COUNT(T_DLV_EST_MNG.DELIV_MNG_SEQ) KENSHU
            FROM T_DLV_EST_MNG
            WHERE T_DLV_EST_MNG.INQ_RESP_IND = '2'
                AND T_DLV_EST_MNG.DELETE_FLG = '0'
            GROUP BY T_DLV_EST_MNG.ORDER_NO
        ) TEST1
            ON TEST1.ORDER_NO = V_SLIP_BUY.ORDER_NO
        LEFT JOIN (
            SELECT T_RECEIVE_MNG.ORDER_NO, SUM(T_RECEIVE_MNG.DELIV_VOL) DELIV_VOL   
            FROM T_RECEIVE_MNG
            INNER JOIN T_ARRIVAL
                ON T_RECEIVE_MNG.APP_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
            WHERE T_RECEIVE_MNG.DELETE_FLG = '0' 
                AND T_ARRIVAL.DELETE_FLG = '0'
                AND T_ARRIVAL.ARRIVAL_STATUS = '04'  
            GROUP BY T_RECEIVE_MNG.ORDER_NO
        ) TEST2
            ON TEST2.ORDER_NO = V_SLIP_BUY.ORDER_NO
        LEFT JOIN V_T_ATTACH_MNG ORDER_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_1 = ORDER_ATTACH_1.ATTACH_FILE_SEQ
        LEFT JOIN V_T_ATTACH_MNG ORDER_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_2 = ORDER_ATTACH_2.ATTACH_FILE_SEQ
        LEFT JOIN V_T_ATTACH_MNG ORDER_ATTACH_3 ON  V_SLIP_BUY.ATTACH_FILE_3 = ORDER_ATTACH_3.ATTACH_FILE_SEQ
        LEFT JOIN V_T_ATTACH_MNG PUR_APL_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_4 = PUR_APL_ATTACH_1.ATTACH_FILE_SEQ
        LEFT JOIN V_T_ATTACH_MNG PUR_APL_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_5 = PUR_APL_ATTACH_2.ATTACH_FILE_SEQ
        LEFT JOIN (
            SELECT T_ARRIVAL.ORDER_NO, SUM(T_ARRIVAL.DELIV_VOL) APPROVED_DELIV_VOL
            FROM T_ARRIVAL
            INNER JOIN T_RECEIVE_MNG
                ON T_ARRIVAL.ARRIVAL_SEQ = T_RECEIVE_MNG.APP_ARRIVAL_SEQ
            WHERE T_ARRIVAL.DELETE_FLG = '0'
                AND T_ARRIVAL.RB_IND = '0'
                AND T_RECEIVE_MNG.DELETE_FLG = '0'
            GROUP BY T_ARRIVAL.ORDER_NO
        ) APPROVED_T_ARRIVAL
            ON APPROVED_T_ARRIVAL.ORDER_NO = V_SLIP_BUY.ORDER_NO
        <where>
            <include refid="listKeyIdentityWhereCondition"/>
        </where> 
        UNION ALL
        SELECT 
            V_SLIP_BUY.SLIP_NO AS slipNo,
            V_SLIP_BUY.PUR_REQ_NO AS purReqNo,
            V_SLIP_BUY.REQ_TYPE_IND AS reqInd,
            V_SLIP_BUY.CORRECT_CD AS correctCd,
            V_SLIP_BUY.PUR_REQ_DATE AS "purReqDate.dateOfymd",
            V_SLIP_BUY.ORDER_NO AS orderNo,
            V_SLIP_BUY.ORDER_DATE AS "orderDate.dateOfymd",
            T_QUOT_REQUEST.QUOT_REQ_NO AS "quotReqNo",
            V_SLIP_BUY.PUR_APL_NO AS purAplNo,
            V_SLIP_BUY.TITLE_NAME AS titleName,
            V_SLIP_BUY.SUP_CD AS supCd,
            V_SLIP_BUY.SUP_ABBR_NAME AS supName,
            V_SLIP_BUY.SUBCON_IND AS subconInd,
            V_SLIP_BUY.EDI_IND AS ediInd,
            V_SLIP_BUY.ITEM_CD AS itemCd,
            V_SLIP_BUY.ITEM_NAME AS itemName,
            V_SLIP_BUY.KATASHIKI AS katashiki,
            V_SLIP_BUY.MANUFACT_CD AS manufactCd,
            V_SLIP_BUY.MANUFACT_NAME AS manufactName,
            V_SLIP_BUY.REQ_DELIV_DATE AS "reqDelivDate.dateOfymd",
            V_SLIP_BUY.ORDER_DELIV_DATE AS "orderDelivDate.dateOfymd",
            V_SLIP_BUY.UNIT_NAME AS unitName,
            V_SLIP_BUY.REQ_VOL AS "hopeVol.vol",
            V_SLIP_BUY.ORDER_VOL AS "orderVol.vol",
            CASE WHEN (V_SLIP_BUY.ORDER_VOL - nvl(V_SLIP_BUY.RECEIVED_VOL,0)) &lt; 0 THEN 0 ELSE (V_SLIP_BUY.ORDER_VOL - nvl(V_SLIP_BUY.RECEIVED_VOL,0)) END AS "receiveRemainingVol.vol",
            V_SLIP_BUY.UNIT_PRICE_IND AS unitPriceInd,
            V_SLIP_BUY.HOPE_CURRENCY_CD AS hopeAmountCurrencyCd,
            V_SLIP_BUY.CURRENCY_CD AS currencyCd,
            V_SLIP_BUY.REQ_UNIT_PRICE AS "hopeUnitPrice.amount",
            V_SLIP_BUY.REQ_AMOUNT AS "hopeAmount.amount",
            V_SLIP_BUY.ORDER_UNIT_PRICE AS "orderUnitPrice.amount",
            V_SLIP_BUY.ORDER_AMOUNT AS "orderAmount.amount",
            V_SLIP_BUY.ORDER_CANCEL_VOL,
            V_SLIP_BUY.ORDER_CANCEL_AMOUNT,
            V_SLIP_BUY.TAX_IND AS taxInd,
            V_SLIP_BUY.BUDGET_NO AS budgetNo,
            V_SLIP_BUY.SUBJECT_CD AS subjectCd,
            V_SLIP_BUY.SUBJECT_NAME AS subjectName,
            V_SLIP_BUY.DELIV_PLACE_CD AS delivPlaceCd,
            V_SLIP_BUY.DELIV_PLACE_NAME AS delivPlaceName,
            V_SLIP_BUY.ITEM_CLASS_L_NAME AS itemClassLName,
            V_SLIP_BUY.ITEM_CLASS_M_NAME AS itemClassMName,
            V_SLIP_BUY.ITEM_CLASS_S_NAME AS itemClassSName,
            V_SLIP_BUY.REQ_SECTION_CD AS purReqSectionCd,
            V_SLIP_BUY.REQ_SECTION_NAME AS purReqSectionName,
            V_SLIP_BUY.REQ_USER_ID AS purReqUserCd,
            V_SLIP_BUY.REQ_USER_NAME AS purReqUserName,
            V_SLIP_BUY.BUYER_SECTION_NAME AS buyerSectionName,
            V_SLIP_BUY.BUYER_SECTION_CD AS buyerSectionCd,
            V_SLIP_BUY.BUYER_USER_NAME AS buyerUserName,
            V_SLIP_BUY.BUYER_USER_ID AS buyerUserId,
            V_SLIP_BUY.LOAD_SECTION_CD AS loadSectionCd,
            V_SLIP_BUY.LOAD_SECTION_NAME AS loadSectionName,
            V_SLIP_BUY.SLIP_STATUS AS slipStatus,
            V_SLIP_BUY.RECEIVE_STATUS_IND AS receiveStatusInd,
            V_SLIP_BUY.INSPECT_STATUS_IND AS inspectStatusInd,
            V_SLIP_BUY.ACCEPTANCE_STATUS_IND AS acceptanceStatusInd,
            TEST2.DELIV_VOL AS "delivVol.vol",
            T_QUOT_ACQ_APL.QUOT_ACQ_APL_STATUS AS quotAcqAplStat,
            T_QUOT_REQUEST.QUOT_REQ_SEQ AS quotReqSeqNo,
            V_SLIP_BUY.ORDER_SEQ AS orderSeq,
            TEST1.KENSHU AS kenshu,
            V_SLIP_BUY.PUR_APL_SEQ AS purAplSeqNo,
            V_SLIP_BUY.APP_UNIT_NO AS appUnitNo,
            V_SLIP_BUY.REQ_TYPE_IND AS reqTypeIndName,
            V_SLIP_BUY.SUBCON_IND AS subconIndName,
            V_SLIP_BUY.EDI_IND AS ediIndName,
            V_SLIP_BUY.UNIT_CD AS unitCd,
            V_SLIP_BUY.TAX_IND AS taxIndName,
            V_SLIP_BUY.ITEM_CLASS_L AS itemClassL,
            V_SLIP_BUY.ITEM_CLASS_M AS itemClassM,
            V_SLIP_BUY.ITEM_CLASS_S AS itemClassS,
            V_SLIP_BUY.REQ_COMPANY_CD AS reqCompanyCd,
            V_SLIP_BUY.REQ_COMPANY_NAME AS reqCompanyName,
            V_SLIP_BUY.REQ_SECTION_PLACE_CD AS "reqSectionPlaceCd",
            V_SLIP_BUY.REQ_SECTION_PLACE_NAME AS reqSectionPlaceName,
            V_SLIP_BUY.BUYER_COMPANY_CD AS buyerCompanyCd,
            V_SLIP_BUY.BUYER_COMPANY_NAME AS buyerCompanyName,
            V_SLIP_BUY.BUYER_SECTION_PLACE_CD AS purSectionPlaceCd,
            V_SLIP_BUY.BUYER_SECTION_PLACE_NAME AS purSectionPlaceName,
            V_SLIP_BUY.BUYER_SECTION_NAME AS "purSectionName",
            V_SLIP_BUY.BUYER_SECTION_CD AS "purSectionCd",
            V_SLIP_BUY.BUYER_USER_NAME AS "purUserName",
            V_SLIP_BUY.BUYER_USER_ID AS "purUserId",
            V_SLIP_BUY.COMMENT_1 AS comment1,
            V_SLIP_BUY.COMMENT_2 AS comment2,
            V_SLIP_BUY.ORDER_INPUT_DATE AS "orderRegisterDate.dateOfymd",
            ORDER_ATTACH_1.ATTACH_SCOPE AS "attachScope1",
            ORDER_ATTACH_2.ATTACH_SCOPE AS "attachScope2",
            ORDER_ATTACH_3.ATTACH_SCOPE AS "attachScope3",
            PUR_APL_ATTACH_1.ATTACH_SCOPE AS "attachScope4",
            PUR_APL_ATTACH_2.ATTACH_SCOPE AS "attachScope5"
            ,APPROVED_T_ARRIVAL.APPROVED_DELIV_VOL AS "approvedDelivVol.vol"
            , V_SLIP_BUY.ACCEPT_VOL AS "acceptVol.vol"
            , V_SLIP_BUY.ACCEPT_AMOUNT AS "acceptAmount.amount"
            , V_SLIP_BUY.RECEIVED_VOL AS "receivedVol.vol"
            ,<include refid="extItem"/>
            , V_SLIP_BUY.PUR_APL_NO
            , V_SLIP_BUY.PUR_REQ_NO
        FROM H_V_SLIP_BUY V_SLIP_BUY
        LEFT JOIN 
	        (
	           SELECT      QUOT_REQ_NO
	           ,           QUOT_REQ_SEQ
	           FROM        H_QUOT_REQUEST
	           WHERE       QUOT_TYPE_IND IN ('1', '4')
	           AND         NEW_FLG = '1'
	           AND         DELETE_FLG = '0'
	        ) T_QUOT_REQUEST 
            ON 
                (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
                OR  V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
        LEFT JOIN 
            (
                SELECT      QUOT_ACQ_APL_NO
                ,           QUOT_ACQ_APL_STATUS
                FROM        H_QUOT_ACQ_APL
                WHERE       NEW_FLG = '1'       
                AND         DELETE_FLG ='0'
            ) T_QUOT_ACQ_APL
            ON T_QUOT_ACQ_APL.QUOT_ACQ_APL_NO = V_SLIP_BUY.PUR_APL_NO
        LEFT JOIN ( 
            SELECT T_DLV_EST_MNG.ORDER_NO,
                COUNT(T_DLV_EST_MNG.DELIV_MNG_SEQ) KENSHU
            FROM H_DLV_EST_MNG T_DLV_EST_MNG
            WHERE T_DLV_EST_MNG.INQ_RESP_IND = '2'
                AND T_DLV_EST_MNG.DELETE_FLG = '0'
            GROUP BY T_DLV_EST_MNG.ORDER_NO
        ) TEST1
            ON TEST1.ORDER_NO = V_SLIP_BUY.ORDER_NO
        LEFT JOIN (
            SELECT T_RECEIVE_MNG.ORDER_NO, SUM(T_RECEIVE_MNG.DELIV_VOL) DELIV_VOL  
            FROM H_RECEIVE_MNG T_RECEIVE_MNG 
            INNER JOIN H_ARRIVAL T_ARRIVAL
                ON T_RECEIVE_MNG.APP_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
            WHERE T_RECEIVE_MNG.DELETE_FLG = '0' 
                AND T_ARRIVAL.DELETE_FLG = '0'
                AND T_ARRIVAL.ARRIVAL_STATUS = '04'  
            GROUP BY T_RECEIVE_MNG.ORDER_NO
        ) TEST2
            ON TEST2.ORDER_NO = V_SLIP_BUY.ORDER_NO
        LEFT JOIN V_H_ATTACH_MNG ORDER_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_1 = ORDER_ATTACH_1.ATTACH_FILE_SEQ
        LEFT JOIN V_H_ATTACH_MNG ORDER_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_2 = ORDER_ATTACH_2.ATTACH_FILE_SEQ
        LEFT JOIN V_H_ATTACH_MNG ORDER_ATTACH_3 ON  V_SLIP_BUY.ATTACH_FILE_3 = ORDER_ATTACH_3.ATTACH_FILE_SEQ
        LEFT JOIN V_H_ATTACH_MNG PUR_APL_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_4 = PUR_APL_ATTACH_1.ATTACH_FILE_SEQ
        LEFT JOIN V_H_ATTACH_MNG PUR_APL_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_5 = PUR_APL_ATTACH_2.ATTACH_FILE_SEQ
        LEFT JOIN (
            SELECT T_ARRIVAL.ORDER_NO, SUM(T_ARRIVAL.DELIV_VOL) APPROVED_DELIV_VOL
            FROM H_ARRIVAL T_ARRIVAL
            INNER JOIN H_RECEIVE_MNG T_RECEIVE_MNG
                ON T_ARRIVAL.ARRIVAL_SEQ = T_RECEIVE_MNG.APP_ARRIVAL_SEQ
            WHERE T_ARRIVAL.DELETE_FLG = '0'
                AND T_ARRIVAL.RB_IND = '0'
                AND T_RECEIVE_MNG.DELETE_FLG = '0'
            GROUP BY T_ARRIVAL.ORDER_NO
        ) APPROVED_T_ARRIVAL
            ON APPROVED_T_ARRIVAL.ORDER_NO = V_SLIP_BUY.ORDER_NO
        <where>
            <include refid="listKeyIdentityWhereCondition"/>
        </where> 
        ) V_SLIP_BUY
        INNER JOIN V_SLIP_BUY_IDENTIFY 
        ON V_SLIP_BUY.slipNo = V_SLIP_BUY_IDENTIFY.SLIP_NO
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>

    <select id="downloadCount" parameterType="fw.domain.mst.searchcondition.SearchCondition"
        resultType="java.lang.Long">
        SELECT COUNT(SLIP_NO) FROM (
            SELECT V_SLIP_BUY.SLIP_NO
            FROM V_SLIP_BUY
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(quotReqNo)">
            INNER JOIN T_QUOT_REQUEST 
                ON 
                (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
                    OR V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
                AND T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
                AND T_QUOT_REQUEST.NEW_FLG = '1'
                AND T_QUOT_REQUEST.DELETE_FLG = '0'
            </if>
            <where>
                <include refid="listKeyIdentityWhereCondition"/>
            </where>
            UNION ALL
            SELECT V_SLIP_BUY.SLIP_NO
            FROM H_V_SLIP_BUY V_SLIP_BUY
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(quotReqNo)">
            INNER JOIN H_QUOT_REQUEST T_QUOT_REQUEST 
                ON
                (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
                    OR V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
                AND T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
                AND T_QUOT_REQUEST.NEW_FLG = '1'
                AND T_QUOT_REQUEST.DELETE_FLG = '0'
            </if>
            <where>
                <include refid="listKeyIdentityWhereCondition"/>
            </where>
        )
    </select>
    <sql id="downloadIdentify">
            SELECT  SLIP_NO
            FROM
            (
	            SELECT SLIP_NO
	            FROM 
	            (
		            SELECT V_SLIP_BUY.SLIP_NO
					,      V_SLIP_BUY.PUR_APL_NO
					,      V_SLIP_BUY.PUR_REQ_NO
		            FROM V_SLIP_BUY
		            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(quotReqNo)">
		            INNER JOIN T_QUOT_REQUEST 
		                ON 
		                (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
		                    OR V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
		                AND T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
		                AND T_QUOT_REQUEST.NEW_FLG = '1'
		                AND T_QUOT_REQUEST.DELETE_FLG = '0'
		            </if>
		            <where>
		                <include refid="listKeyIdentityWhereCondition"/>
		            </where>
	                UNION ALL
	                SELECT V_SLIP_BUY.SLIP_NO
	                ,      V_SLIP_BUY.PUR_APL_NO
	                ,      V_SLIP_BUY.PUR_REQ_NO
		            FROM H_V_SLIP_BUY V_SLIP_BUY
		            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(quotReqNo)">
		            INNER JOIN H_QUOT_REQUEST T_QUOT_REQUEST 
		                ON
		                (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
		                    OR V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
		                AND T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
		                AND T_QUOT_REQUEST.NEW_FLG = '1'
		                AND T_QUOT_REQUEST.DELETE_FLG = '0'
		            </if>
		            <where>
		                <include refid="listKeyIdentityWhereCondition"/>
		            </where>
	            ) V_SLIP_BUY
	            ORDER BY    ${searchCondition.columnOrder.columnOrder()}
            )
            WHERE  ROWNUM &lt;=${@fw.common.util.PropertiesUtil@getLong("DOWNLOAD_MAXCNT")}
    </sql>

    <select id="listKeyIdentity" parameterType="fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition"
        resultType="fw.domain.slip.businesscommon.slipsearch.SlipSearchIdentify">
        SELECT 
            V_SLIP_BUY.SLIP_NO as slipNo 
        FROM (
            SELECT     
                V_SLIP_BUY.SLIP_NO,
            <if test="searchCondition.columnOrder.chooseList.itemList.size() == 0">
                <foreach collection="searchCondition.columnOrder.setList.itemList" item="itemList"  separator=",">  
                    ${itemList.itemName}
                </foreach>
            </if>
            <if test="searchCondition.columnOrder.chooseList.itemList.size() &gt; 0">
                <foreach collection="searchCondition.columnOrder.chooseList.itemList" item="itemList"  separator=",">  
                    ${itemList.itemName}
                </foreach>
            </if>
            FROM        V_SLIP_BUY_NO V_SLIP_BUY
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(quotReqNo)">
            INNER JOIN   T_QUOT_REQUEST 
                ON          (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
                OR          V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
                AND         T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
                AND         T_QUOT_REQUEST.NEW_FLG = '1'
                AND         T_QUOT_REQUEST.DELETE_FLG = '0'
            </if>
            <where>
                <include refid="listKeyIdentityWhereCondition"/>
            </where> 
            UNION ALL
            SELECT
                V_SLIP_BUY.SLIP_NO,
            <if test="searchCondition.columnOrder.chooseList.itemList.size() == 0">
                <foreach collection="searchCondition.columnOrder.setList.itemList" item="itemList"  separator=",">  
                    ${itemList.itemName}
                </foreach>
            </if>
            <if test="searchCondition.columnOrder.chooseList.itemList.size() &gt; 0">
                <foreach collection="searchCondition.columnOrder.chooseList.itemList" item="itemList"  separator=",">  
                    ${itemList.itemName}
                </foreach>
            </if>
            FROM        H_V_SLIP_BUY_NO V_SLIP_BUY
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(quotReqNo)">
            INNER JOIN   H_QUOT_REQUEST T_QUOT_REQUEST
            ON          (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
            OR          V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
            AND         T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
            AND         T_QUOT_REQUEST.NEW_FLG = '1'
            AND         T_QUOT_REQUEST.DELETE_FLG = '0'
            </if>
            <where>
                <include refid="listKeyIdentityWhereCondition"/>
            </where> 
        ) V_SLIP_BUY
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>

    <resultMap type="fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllItem" id="SlipSearchByBuyerItem_Map">
        <id column="ORDER_CANCEL_VOL" property="orderCancel.orderCancelVol.vol"/>
        <id column="ORDER_CANCEL_AMOUNT" property="orderCancel.orderCancelAmount.amount"/>
        <id column="ORD_EXT_TXT_1" property="orderExtItem.extendTxt.extendTxt1" />
        <id column="ORD_EXT_TXT_2" property="orderExtItem.extendTxt.extendTxt2" />
        <id column="ORD_EXT_TXT_3" property="orderExtItem.extendTxt.extendTxt3" />
        <id column="ORD_EXT_TXT_4" property="orderExtItem.extendTxt.extendTxt4" />
        <id column="ORD_EXT_TXT_5" property="orderExtItem.extendTxt.extendTxt5" />
        <id column="ORD_EXT_TXT_6" property="orderExtItem.extendTxt.extendTxt6" />
        <id column="ORD_EXT_TXT_7" property="orderExtItem.extendTxt.extendTxt7" />
        <id column="ORD_EXT_TXT_8" property="orderExtItem.extendTxt.extendTxt8" />
        <id column="ORD_EXT_TXT_9" property="orderExtItem.extendTxt.extendTxt9" />
        <id column="ORD_EXT_TXT_10" property="orderExtItem.extendTxt.extendTxt10" />
        <id column="ORD_EXT_AREA_1" property="orderExtItem.extendArea.extendArea1" />
        <id column="ORD_EXT_AREA_2" property="orderExtItem.extendArea.extendArea2" />
        <id column="ORD_EXT_AREA_3" property="orderExtItem.extendArea.extendArea3" />
        <id column="ORD_EXT_AREA_4" property="orderExtItem.extendArea.extendArea4" />
        <id column="ORD_EXT_AREA_5" property="orderExtItem.extendArea.extendArea5" />
        <id column="ORD_EXT_DATE_1" property="orderExtItem.extendDate.extendDate1.dateOfymd" />
        <id column="ORD_EXT_DATE_2" property="orderExtItem.extendDate.extendDate2.dateOfymd" />
        <id column="ORD_EXT_DATE_3" property="orderExtItem.extendDate.extendDate3.dateOfymd" />
        <id column="ORD_EXT_DATE_4" property="orderExtItem.extendDate.extendDate4.dateOfymd" />
        <id column="ORD_EXT_DATE_5" property="orderExtItem.extendDate.extendDate5.dateOfymd" />
        <id column="ORD_EXT_INT_1" property="orderExtItem.extendInt.extendInt1.value" />
        <id column="ORD_EXT_INT_2" property="orderExtItem.extendInt.extendInt2.value" />
        <id column="ORD_EXT_INT_3" property="orderExtItem.extendInt.extendInt3.value" />
        <id column="ORD_EXT_INT_4" property="orderExtItem.extendInt.extendInt4.value" />
        <id column="ORD_EXT_INT_5" property="orderExtItem.extendInt.extendInt5.value" />
        <id column="ORD_EXT_INT_6" property="orderExtItem.extendInt.extendInt6.value" />
        <id column="ORD_EXT_INT_7" property="orderExtItem.extendInt.extendInt7.value" />
        <id column="ORD_EXT_INT_8" property="orderExtItem.extendInt.extendInt8.value" />
        <id column="ORD_EXT_INT_9" property="orderExtItem.extendInt.extendInt9.value" />
        <id column="ORD_EXT_INT_10" property="orderExtItem.extendInt.extendInt10.value" />
        <id column="ORD_EXT_DEC_1" property="orderExtItem.extendDec.extendDec1.value" />
        <id column="ORD_EXT_DEC_2" property="orderExtItem.extendDec.extendDec2.value" />
        <id column="ORD_EXT_DEC_3" property="orderExtItem.extendDec.extendDec3.value" />
        <id column="ORD_EXT_DEC_4" property="orderExtItem.extendDec.extendDec4.value" />
        <id column="ORD_EXT_DEC_5" property="orderExtItem.extendDec.extendDec5.value" />
        <id column="ORD_EXT_SEL_1" property="orderExtItem.extendSel.extendSel1" />
        <id column="ORD_EXT_SEL_2" property="orderExtItem.extendSel.extendSel2" />
        <id column="ORD_EXT_SEL_3" property="orderExtItem.extendSel.extendSel3" />
        <id column="ORD_EXT_SEL_4" property="orderExtItem.extendSel.extendSel4" />
        <id column="ORD_EXT_SEL_5" property="orderExtItem.extendSel.extendSel5" />
        <id column="ORD_EXT_SEL_6" property="orderExtItem.extendSel.extendSel6" />
        <id column="ORD_EXT_SEL_7" property="orderExtItem.extendSel.extendSel7" />
        <id column="ORD_EXT_SEL_8" property="orderExtItem.extendSel.extendSel8" />
        <id column="ORD_EXT_SEL_9" property="orderExtItem.extendSel.extendSel9" />
        <id column="ORD_EXT_SEL_10" property="orderExtItem.extendSel.extendSel10" />
        <id column="ORD_EXT_CHK_1" property="orderExtItem.extendChk.extendChk1" />
        <id column="ORD_EXT_CHK_2" property="orderExtItem.extendChk.extendChk2" />
        <id column="ORD_EXT_CHK_3" property="orderExtItem.extendChk.extendChk3" />
        <id column="ORD_EXT_CHK_4" property="orderExtItem.extendChk.extendChk4" />
        <id column="ORD_EXT_CHK_5" property="orderExtItem.extendChk.extendChk5" />
        <id column="ORD_EXT_FILE_1" property="orderExtItem.extendFile.extendFile1.fileName" />
        <id column="ORD_EXT_FILE_2" property="orderExtItem.extendFile.extendFile2.fileName" />
        <id column="ORD_EXT_FILE_3" property="orderExtItem.extendFile.extendFile3.fileName" />
        <id column="ORD_EXT_MST_1" property="orderExtItem.extendMst.extendMst1.mstKey" />
        <id column="ORD_EXT_MST_2" property="orderExtItem.extendMst.extendMst2.mstKey" />
        <id column="ORD_EXT_MST_3" property="orderExtItem.extendMst.extendMst3.mstKey" />
        <id column="ORD_EXT_MST_4" property="orderExtItem.extendMst.extendMst4.mstKey" />
        <id column="ORD_EXT_MST_5" property="orderExtItem.extendMst.extendMst5.mstKey" />
        <id column="ORD_EXT_MST_6" property="orderExtItem.extendMst.extendMst6.mstKey" />
        <id column="ORD_EXT_MST_7" property="orderExtItem.extendMst.extendMst7.mstKey" />
        <id column="ORD_EXT_MST_8" property="orderExtItem.extendMst.extendMst8.mstKey" />
        <id column="ORD_EXT_MST_NAME_1" property="orderExtItem.extendMst.extendMst1.mstName" />
        <id column="ORD_EXT_MST_NAME_2" property="orderExtItem.extendMst.extendMst2.mstName" />
        <id column="ORD_EXT_MST_NAME_3" property="orderExtItem.extendMst.extendMst3.mstName" />
        <id column="ORD_EXT_MST_NAME_4" property="orderExtItem.extendMst.extendMst4.mstName" />
        <id column="ORD_EXT_MST_NAME_5" property="orderExtItem.extendMst.extendMst5.mstName" />
        <id column="ORD_EXT_MST_NAME_6" property="orderExtItem.extendMst.extendMst6.mstName" />
        <id column="ORD_EXT_MST_NAME_7" property="orderExtItem.extendMst.extendMst7.mstName" />
        <id column="ORD_EXT_MST_NAME_8" property="orderExtItem.extendMst.extendMst8.mstName" />
        <id column="APL_EXT_TXT_1" property="purAplExtItem.extendTxt.extendTxt1" />
        <id column="APL_EXT_TXT_2" property="purAplExtItem.extendTxt.extendTxt2" />
        <id column="APL_EXT_TXT_3" property="purAplExtItem.extendTxt.extendTxt3" />
        <id column="APL_EXT_TXT_4" property="purAplExtItem.extendTxt.extendTxt4" />
        <id column="APL_EXT_TXT_5" property="purAplExtItem.extendTxt.extendTxt5" />
        <id column="APL_EXT_TXT_6" property="purAplExtItem.extendTxt.extendTxt6" />
        <id column="APL_EXT_TXT_7" property="purAplExtItem.extendTxt.extendTxt7" />
        <id column="APL_EXT_TXT_8" property="purAplExtItem.extendTxt.extendTxt8" />
        <id column="APL_EXT_TXT_9" property="purAplExtItem.extendTxt.extendTxt9" />
        <id column="APL_EXT_TXT_10" property="purAplExtItem.extendTxt.extendTxt10" />
        <id column="APL_EXT_AREA_1" property="purAplExtItem.extendArea.extendArea1" />
        <id column="APL_EXT_AREA_2" property="purAplExtItem.extendArea.extendArea2" />
        <id column="APL_EXT_AREA_3" property="purAplExtItem.extendArea.extendArea3" />
        <id column="APL_EXT_AREA_4" property="purAplExtItem.extendArea.extendArea4" />
        <id column="APL_EXT_AREA_5" property="purAplExtItem.extendArea.extendArea5" />
        <id column="APL_EXT_DATE_1" property="purAplExtItem.extendDate.extendDate1.dateOfymd" />
        <id column="APL_EXT_DATE_2" property="purAplExtItem.extendDate.extendDate2.dateOfymd" />
        <id column="APL_EXT_DATE_3" property="purAplExtItem.extendDate.extendDate3.dateOfymd" />
        <id column="APL_EXT_DATE_4" property="purAplExtItem.extendDate.extendDate4.dateOfymd" />
        <id column="APL_EXT_DATE_5" property="purAplExtItem.extendDate.extendDate5.dateOfymd" />
        <id column="APL_EXT_INT_1" property="purAplExtItem.extendInt.extendInt1.value" />
        <id column="APL_EXT_INT_2" property="purAplExtItem.extendInt.extendInt2.value" />
        <id column="APL_EXT_INT_3" property="purAplExtItem.extendInt.extendInt3.value" />
        <id column="APL_EXT_INT_4" property="purAplExtItem.extendInt.extendInt4.value" />
        <id column="APL_EXT_INT_5" property="purAplExtItem.extendInt.extendInt5.value" />
        <id column="APL_EXT_INT_6" property="purAplExtItem.extendInt.extendInt6.value" />
        <id column="APL_EXT_INT_7" property="purAplExtItem.extendInt.extendInt7.value" />
        <id column="APL_EXT_INT_8" property="purAplExtItem.extendInt.extendInt8.value" />
        <id column="APL_EXT_INT_9" property="purAplExtItem.extendInt.extendInt9.value" />
        <id column="APL_EXT_INT_10" property="purAplExtItem.extendInt.extendInt10.value" />
        <id column="APL_EXT_DEC_1" property="purAplExtItem.extendDec.extendDec1.value" />
        <id column="APL_EXT_DEC_2" property="purAplExtItem.extendDec.extendDec2.value" />
        <id column="APL_EXT_DEC_3" property="purAplExtItem.extendDec.extendDec3.value" />
        <id column="APL_EXT_DEC_4" property="purAplExtItem.extendDec.extendDec4.value" />
        <id column="APL_EXT_DEC_5" property="purAplExtItem.extendDec.extendDec5.value" />
        <id column="APL_EXT_SEL_1" property="purAplExtItem.extendSel.extendSel1" />
        <id column="APL_EXT_SEL_2" property="purAplExtItem.extendSel.extendSel2" />
        <id column="APL_EXT_SEL_3" property="purAplExtItem.extendSel.extendSel3" />
        <id column="APL_EXT_SEL_4" property="purAplExtItem.extendSel.extendSel4" />
        <id column="APL_EXT_SEL_5" property="purAplExtItem.extendSel.extendSel5" />
        <id column="APL_EXT_SEL_6" property="purAplExtItem.extendSel.extendSel6" />
        <id column="APL_EXT_SEL_7" property="purAplExtItem.extendSel.extendSel7" />
        <id column="APL_EXT_SEL_8" property="purAplExtItem.extendSel.extendSel8" />
        <id column="APL_EXT_SEL_9" property="purAplExtItem.extendSel.extendSel9" />
        <id column="APL_EXT_SEL_10" property="purAplExtItem.extendSel.extendSel10" />
        <id column="APL_EXT_CHK_1" property="purAplExtItem.extendChk.extendChk1" />
        <id column="APL_EXT_CHK_2" property="purAplExtItem.extendChk.extendChk2" />
        <id column="APL_EXT_CHK_3" property="purAplExtItem.extendChk.extendChk3" />
        <id column="APL_EXT_CHK_4" property="purAplExtItem.extendChk.extendChk4" />
        <id column="APL_EXT_CHK_5" property="purAplExtItem.extendChk.extendChk5" />
        <id column="APL_EXT_FILE_1" property="purAplExtItem.extendFile.extendFile1.fileName" />
        <id column="APL_EXT_FILE_2" property="purAplExtItem.extendFile.extendFile2.fileName" />
        <id column="APL_EXT_FILE_3" property="purAplExtItem.extendFile.extendFile3.fileName" />
        <id column="APL_EXT_MST_1" property="purAplExtItem.extendMst.extendMst1.mstKey" />
        <id column="APL_EXT_MST_2" property="purAplExtItem.extendMst.extendMst2.mstKey" />
        <id column="APL_EXT_MST_3" property="purAplExtItem.extendMst.extendMst3.mstKey" />
        <id column="APL_EXT_MST_4" property="purAplExtItem.extendMst.extendMst4.mstKey" />
        <id column="APL_EXT_MST_5" property="purAplExtItem.extendMst.extendMst5.mstKey" />
        <id column="APL_EXT_MST_6" property="purAplExtItem.extendMst.extendMst6.mstKey" />
        <id column="APL_EXT_MST_7" property="purAplExtItem.extendMst.extendMst7.mstKey" />
        <id column="APL_EXT_MST_8" property="purAplExtItem.extendMst.extendMst8.mstKey" />
        <id column="APL_EXT_MST_NAME_1" property="purAplExtItem.extendMst.extendMst1.mstName" />
        <id column="APL_EXT_MST_NAME_2" property="purAplExtItem.extendMst.extendMst2.mstName" />
        <id column="APL_EXT_MST_NAME_3" property="purAplExtItem.extendMst.extendMst3.mstName" />
        <id column="APL_EXT_MST_NAME_4" property="purAplExtItem.extendMst.extendMst4.mstName" />
        <id column="APL_EXT_MST_NAME_5" property="purAplExtItem.extendMst.extendMst5.mstName" />
        <id column="APL_EXT_MST_NAME_6" property="purAplExtItem.extendMst.extendMst6.mstName" />
        <id column="APL_EXT_MST_NAME_7" property="purAplExtItem.extendMst.extendMst7.mstName" />
        <id column="APL_EXT_MST_NAME_8" property="purAplExtItem.extendMst.extendMst8.mstName" />
        <id column="REQ_EXT_TXT_1" property="purRequestExtItem.extendTxt.extendTxt1" />
        <id column="REQ_EXT_TXT_2" property="purRequestExtItem.extendTxt.extendTxt2" />
        <id column="REQ_EXT_TXT_3" property="purRequestExtItem.extendTxt.extendTxt3" />
        <id column="REQ_EXT_TXT_4" property="purRequestExtItem.extendTxt.extendTxt4" />
        <id column="REQ_EXT_TXT_5" property="purRequestExtItem.extendTxt.extendTxt5" />
        <id column="REQ_EXT_TXT_6" property="purRequestExtItem.extendTxt.extendTxt6" />
        <id column="REQ_EXT_TXT_7" property="purRequestExtItem.extendTxt.extendTxt7" />
        <id column="REQ_EXT_TXT_8" property="purRequestExtItem.extendTxt.extendTxt8" />
        <id column="REQ_EXT_TXT_9" property="purRequestExtItem.extendTxt.extendTxt9" />
        <id column="REQ_EXT_TXT_10" property="purRequestExtItem.extendTxt.extendTxt10" />
        <id column="REQ_EXT_AREA_1" property="purRequestExtItem.extendArea.extendArea1" />
        <id column="REQ_EXT_AREA_2" property="purRequestExtItem.extendArea.extendArea2" />
        <id column="REQ_EXT_AREA_3" property="purRequestExtItem.extendArea.extendArea3" />
        <id column="REQ_EXT_AREA_4" property="purRequestExtItem.extendArea.extendArea4" />
        <id column="REQ_EXT_AREA_5" property="purRequestExtItem.extendArea.extendArea5" />
        <id column="REQ_EXT_DATE_1" property="purRequestExtItem.extendDate.extendDate1.dateOfymd" />
        <id column="REQ_EXT_DATE_2" property="purRequestExtItem.extendDate.extendDate2.dateOfymd" />
        <id column="REQ_EXT_DATE_3" property="purRequestExtItem.extendDate.extendDate3.dateOfymd" />
        <id column="REQ_EXT_DATE_4" property="purRequestExtItem.extendDate.extendDate4.dateOfymd" />
        <id column="REQ_EXT_DATE_5" property="purRequestExtItem.extendDate.extendDate5.dateOfymd" />
        <id column="REQ_EXT_INT_1" property="purRequestExtItem.extendInt.extendInt1.value" />
        <id column="REQ_EXT_INT_2" property="purRequestExtItem.extendInt.extendInt2.value" />
        <id column="REQ_EXT_INT_3" property="purRequestExtItem.extendInt.extendInt3.value" />
        <id column="REQ_EXT_INT_4" property="purRequestExtItem.extendInt.extendInt4.value" />
        <id column="REQ_EXT_INT_5" property="purRequestExtItem.extendInt.extendInt5.value" />
        <id column="REQ_EXT_INT_6" property="purRequestExtItem.extendInt.extendInt6.value" />
        <id column="REQ_EXT_INT_7" property="purRequestExtItem.extendInt.extendInt7.value" />
        <id column="REQ_EXT_INT_8" property="purRequestExtItem.extendInt.extendInt8.value" />
        <id column="REQ_EXT_INT_9" property="purRequestExtItem.extendInt.extendInt9.value" />
        <id column="REQ_EXT_INT_10" property="purRequestExtItem.extendInt.extendInt10.value" />
        <id column="REQ_EXT_DEC_1" property="purRequestExtItem.extendDec.extendDec1.value" />
        <id column="REQ_EXT_DEC_2" property="purRequestExtItem.extendDec.extendDec2.value" />
        <id column="REQ_EXT_DEC_3" property="purRequestExtItem.extendDec.extendDec3.value" />
        <id column="REQ_EXT_DEC_4" property="purRequestExtItem.extendDec.extendDec4.value" />
        <id column="REQ_EXT_DEC_5" property="purRequestExtItem.extendDec.extendDec5.value" />
        <id column="REQ_EXT_SEL_1" property="purRequestExtItem.extendSel.extendSel1" />
        <id column="REQ_EXT_SEL_2" property="purRequestExtItem.extendSel.extendSel2" />
        <id column="REQ_EXT_SEL_3" property="purRequestExtItem.extendSel.extendSel3" />
        <id column="REQ_EXT_SEL_4" property="purRequestExtItem.extendSel.extendSel4" />
        <id column="REQ_EXT_SEL_5" property="purRequestExtItem.extendSel.extendSel5" />
        <id column="REQ_EXT_SEL_6" property="purRequestExtItem.extendSel.extendSel6" />
        <id column="REQ_EXT_SEL_7" property="purRequestExtItem.extendSel.extendSel7" />
        <id column="REQ_EXT_SEL_8" property="purRequestExtItem.extendSel.extendSel8" />
        <id column="REQ_EXT_SEL_9" property="purRequestExtItem.extendSel.extendSel9" />
        <id column="REQ_EXT_SEL_10" property="purRequestExtItem.extendSel.extendSel10" />
        <id column="REQ_EXT_CHK_1" property="purRequestExtItem.extendChk.extendChk1" />
        <id column="REQ_EXT_CHK_2" property="purRequestExtItem.extendChk.extendChk2" />
        <id column="REQ_EXT_CHK_3" property="purRequestExtItem.extendChk.extendChk3" />
        <id column="REQ_EXT_CHK_4" property="purRequestExtItem.extendChk.extendChk4" />
        <id column="REQ_EXT_CHK_5" property="purRequestExtItem.extendChk.extendChk5" />
        <id column="REQ_EXT_FILE_1" property="purRequestExtItem.extendFile.extendFile1.fileName" />
        <id column="REQ_EXT_FILE_2" property="purRequestExtItem.extendFile.extendFile2.fileName" />
        <id column="REQ_EXT_FILE_3" property="purRequestExtItem.extendFile.extendFile3.fileName" />
        <id column="REQ_EXT_MST_1" property="purRequestExtItem.extendMst.extendMst1.mstKey" />
        <id column="REQ_EXT_MST_2" property="purRequestExtItem.extendMst.extendMst2.mstKey" />
        <id column="REQ_EXT_MST_3" property="purRequestExtItem.extendMst.extendMst3.mstKey" />
        <id column="REQ_EXT_MST_4" property="purRequestExtItem.extendMst.extendMst4.mstKey" />
        <id column="REQ_EXT_MST_5" property="purRequestExtItem.extendMst.extendMst5.mstKey" />
        <id column="REQ_EXT_MST_6" property="purRequestExtItem.extendMst.extendMst6.mstKey" />
        <id column="REQ_EXT_MST_7" property="purRequestExtItem.extendMst.extendMst7.mstKey" />
        <id column="REQ_EXT_MST_8" property="purRequestExtItem.extendMst.extendMst8.mstKey" />
        <id column="REQ_EXT_MST_NAME_1" property="purRequestExtItem.extendMst.extendMst1.mstName" />
        <id column="REQ_EXT_MST_NAME_2" property="purRequestExtItem.extendMst.extendMst2.mstName" />
        <id column="REQ_EXT_MST_NAME_3" property="purRequestExtItem.extendMst.extendMst3.mstName" />
        <id column="REQ_EXT_MST_NAME_4" property="purRequestExtItem.extendMst.extendMst4.mstName" />
        <id column="REQ_EXT_MST_NAME_5" property="purRequestExtItem.extendMst.extendMst5.mstName" />
        <id column="REQ_EXT_MST_NAME_6" property="purRequestExtItem.extendMst.extendMst6.mstName" />
        <id column="REQ_EXT_MST_NAME_7" property="purRequestExtItem.extendMst.extendMst7.mstName" />
        <id column="REQ_EXT_MST_NAME_8" property="purRequestExtItem.extendMst.extendMst8.mstName" />
    </resultMap>

    <select id="listPageItem" parameterType="fw.domain.slip.slipsearchbybuyer.SlipSearchByBuyerAllSearchCondition"
        resultMap="SlipSearchByBuyerItem_Map">
        SELECT 
            V_SLIP_BUY.SLIP_NO AS "slipSearchIdentify.slipNo",
            V_SLIP_BUY.ORDER_SEQ AS "orderSeq",
            V_SLIP_BUY.PUR_REQ_NO AS purReqNo,
            V_SLIP_BUY.REQ_TYPE_IND AS reqInd,
            V_SLIP_BUY.PUR_REQ_DATE AS "purReqDate.dateOfymd",
            V_SLIP_BUY.CORRECT_CD as correctCd,
            V_SLIP_BUY.ORDER_NO AS orderNo,
            V_SLIP_BUY.ORDER_DATE AS "orderDate.dateOfymd",
            V_SLIP_BUY.QUOT_REQ_NO,
            T_QUOT_REQUEST_QUOT_REQ_NO AS "quotReqNo",
            V_SLIP_BUY.PUR_APL_NO AS purAplNo,
            V_SLIP_BUY.DELIV_PLACE_CD AS delivPlaceCd,
            V_SLIP_BUY.DELIV_PLACE_NAME AS delivPlaceName,
            V_SLIP_BUY.SUBCON_IND AS subconInd,
            V_SLIP_BUY.EDI_IND AS ediInd,
            V_SLIP_BUY.TITLE_NAME AS titleName,
            V_SLIP_BUY.ITEM_CD AS itemCd,
            V_SLIP_BUY.ITEM_NAME AS itemName,
            V_SLIP_BUY.KATASHIKI AS katashiki,
            V_SLIP_BUY.MANUFACT_CD AS manufactCd,
            V_SLIP_BUY.MANUFACT_NAME AS manufactName,
            V_SLIP_BUY.UNIT_NAME AS unitName,
            V_SLIP_BUY.REQ_VOL AS "hopeVol.vol",
            V_SLIP_BUY.ORDER_VOL AS "orderVol.vol",
            CASE
               WHEN (V_SLIP_BUY.ORDER_VOL - nvl(V_SLIP_BUY.RECEIVED_VOL, 0)) &lt; 0 THEN
                   0
               ELSE
                   (V_SLIP_BUY.ORDER_VOL - nvl(V_SLIP_BUY.RECEIVED_VOL, 0))
            END AS "receiveRemainingVol.vol",
            V_SLIP_BUY.SUP_CD AS "supCd",
            V_SLIP_BUY.SUP_ABBR_NAME AS "supName",
            V_SLIP_BUY.REQ_DELIV_DATE AS "reqDelivDate.dateOfymd",
            V_SLIP_BUY.ORDER_DELIV_DATE AS "orderDelivDate.dateOfymd",
            V_SLIP_BUY.UNIT_PRICE_IND AS unitPriceInd,
            V_SLIP_BUY.HOPE_CURRENCY_CD AS hopeAmountCurrencyCd,
            V_SLIP_BUY.CURRENCY_CD AS currencyCd,
            V_SLIP_BUY.REQ_UNIT_PRICE AS "hopeUnitPrice.amount",
            V_SLIP_BUY.REQ_AMOUNT AS "hopeAmount.amount",
            V_SLIP_BUY.ITEM_CLASS_L_NAME AS itemClassLName,
            V_SLIP_BUY.ITEM_CLASS_M_NAME AS itemClassMName,
            V_SLIP_BUY.ITEM_CLASS_S_NAME AS itemClassSName,
            V_SLIP_BUY.ORDER_UNIT_PRICE AS "orderUnitPrice.amount",
            V_SLIP_BUY.ORDER_AMOUNT AS "orderAmount.amount",
            V_SLIP_BUY.ORDER_CANCEL_VOL,
            V_SLIP_BUY.ORDER_CANCEL_AMOUNT,
            V_SLIP_BUY.TAX_IND AS taxInd,
            V_SLIP_BUY.BUDGET_NO AS budgetNo,
            V_SLIP_BUY.SUBJECT_CD AS subjectCd,
            V_SLIP_BUY.SUBJECT_NAME AS subjectName,
            V_SLIP_BUY.LOAD_SECTION_CD AS loadSectionCd,
            V_SLIP_BUY.LOAD_SECTION_NAME AS loadSectionName,
            V_SLIP_BUY.REQ_SECTION_CD AS purReqSectionCd,
            V_SLIP_BUY.REQ_SECTION_NAME AS purReqSectionName,
            V_SLIP_BUY.REQ_USER_ID AS purReqUserCd,
            V_SLIP_BUY.REQ_USER_NAME AS purReqUserName,
            V_SLIP_BUY.BUYER_SECTION_NAME AS "buyerSectionName",
            V_SLIP_BUY.BUYER_SECTION_CD AS "buyerSectionCd",
            V_SLIP_BUY.BUYER_USER_NAME AS "buyerUserName",
            V_SLIP_BUY.BUYER_USER_ID AS "buyerUserId",
            V_SLIP_BUY.SLIP_STATUS AS slipStatus,
            V_SLIP_BUY.RECEIVE_STATUS_IND AS receiveStatusInd,
            V_SLIP_BUY.INSPECT_STATUS_IND AS inspectStatusInd,
            V_SLIP_BUY.ACCEPTANCE_STATUS_IND AS acceptanceStatusInd,
            DELIV_VOL AS "delivVol.vol",
            QUOT_ACQ_APL_STATUS AS quotAcqAplStat,
            QUOT_REQ_SEQ AS quotReqSeqNo,
            V_SLIP_BUY.ORDER_SEQ AS orderSeq,
            KENSHU AS kenshu,
            V_SLIP_BUY.COMMENT_1 AS comment1,
            V_SLIP_BUY.COMMENT_2 AS comment2,
            V_SLIP_BUY.ORDER_NO AS orderNo,
            V_SLIP_BUY.PUR_APL_SEQ AS purAplSeqNo,
            V_SLIP_BUY.APP_UNIT_NO AS appUnitNo,
            V_SLIP_BUY.LAST_UPD_DATE AS "slipSearchIdentify.lastUpdDate",
            V_SLIP_BUY.PUR_REQ_SEQ AS "purReqSeq",
            QUOT_ACQ_APL_SEQ AS "quotAcqAplSeqNo",
            V_SLIP_BUY.LAST_UPD_DATE AS "lastUpdDate",
            ORDER_ATTACH_1_ATTACH_SCOPE AS "attachScope1",
            ORDER_ATTACH_2_ATTACH_SCOPE AS "attachScope2",
            ORDER_ATTACH_3_ATTACH_SCOPE AS "attachScope3",
            PUR_APL_ATTACH_1_ATTACH_SCOPE AS "attachScope4",
            PUR_APL_ATTACH_2_ATTACH_SCOPE AS "attachScope5",
            APPROVED_DELIV_VOL AS "approvedDelivVol.vol",
            V_SLIP_BUY.ACCEPT_VOL AS "acceptVol.vol",
            V_SLIP_BUY.ACCEPT_AMOUNT AS "acceptAmount.amount",
            V_SLIP_BUY.RECEIVED_VOL AS "receivedVol.vol",
            <include refid="extItem"/>
        FROM (
            SELECT 
                V_SLIP_BUY.*,
                T_QUOT_REQUEST.QUOT_REQ_NO AS T_QUOT_REQUEST_QUOT_REQ_NO,
                TEST2.DELIV_VOL AS DELIV_VOL,
                T_QUOT_ACQ_APL.QUOT_ACQ_APL_STATUS AS QUOT_ACQ_APL_STATUS,
                T_QUOT_REQUEST.QUOT_REQ_SEQ AS QUOT_REQ_SEQ,
                TEST1.KENSHU AS KENSHU,
                T_QUOT_ACQ_APL.QUOT_ACQ_APL_SEQ AS QUOT_ACQ_APL_SEQ,
                ORDER_ATTACH_1.ATTACH_SCOPE AS ORDER_ATTACH_1_ATTACH_SCOPE,
                ORDER_ATTACH_2.ATTACH_SCOPE AS ORDER_ATTACH_2_ATTACH_SCOPE,
                ORDER_ATTACH_3.ATTACH_SCOPE AS ORDER_ATTACH_3_ATTACH_SCOPE,
                PUR_APL_ATTACH_1.ATTACH_SCOPE AS PUR_APL_ATTACH_1_ATTACH_SCOPE,
                PUR_APL_ATTACH_2.ATTACH_SCOPE AS PUR_APL_ATTACH_2_ATTACH_SCOPE,
                APPROVED_T_ARRIVAL.APPROVED_DELIV_VOL AS APPROVED_DELIV_VOL
            FROM V_SLIP_BUY
            LEFT JOIN T_QUOT_REQUEST 
                ON
                   (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
                    OR  V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
                AND T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
                AND T_QUOT_REQUEST.NEW_FLG = '1'
                AND T_QUOT_REQUEST.DELETE_FLG = '0'
            LEFT JOIN T_QUOT_ACQ_APL
                ON T_QUOT_ACQ_APL.QUOT_ACQ_APL_NO = V_SLIP_BUY.PUR_APL_NO
                AND T_QUOT_ACQ_APL.NEW_FLG = '1'
                AND T_QUOT_ACQ_APL.DELETE_FLG ='0'
            LEFT JOIN (
                SELECT T_DLV_EST_MNG.ORDER_NO,
                    COUNT(T_DLV_EST_MNG.DELIV_MNG_SEQ) KENSHU
                FROM T_DLV_EST_MNG
                WHERE T_DLV_EST_MNG.INQ_RESP_IND = '2'
                    AND T_DLV_EST_MNG.DELETE_FLG = '0'
                GROUP BY T_DLV_EST_MNG.ORDER_NO
            ) TEST1
                ON TEST1.ORDER_NO = V_SLIP_BUY.ORDER_NO
            LEFT JOIN (
                SELECT T_RECEIVE_MNG.ORDER_NO, SUM(T_RECEIVE_MNG.DELIV_VOL) DELIV_VOL   
                FROM T_RECEIVE_MNG
                INNER JOIN T_ARRIVAL
                    ON T_RECEIVE_MNG.APP_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
                WHERE T_RECEIVE_MNG.DELETE_FLG = '0' 
                    AND T_ARRIVAL.DELETE_FLG = '0'
                    AND T_ARRIVAL.ARRIVAL_STATUS = '04'  
                GROUP BY T_RECEIVE_MNG.ORDER_NO
            ) TEST2
                ON TEST2.ORDER_NO = V_SLIP_BUY.ORDER_NO
            LEFT JOIN T_ATTACH_MNG ORDER_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_1 = ORDER_ATTACH_1.ATTACH_FILE_SEQ
            LEFT JOIN T_ATTACH_MNG ORDER_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_2 = ORDER_ATTACH_2.ATTACH_FILE_SEQ
            LEFT JOIN T_ATTACH_MNG ORDER_ATTACH_3 ON  V_SLIP_BUY.ATTACH_FILE_3 = ORDER_ATTACH_3.ATTACH_FILE_SEQ
            LEFT JOIN T_ATTACH_MNG PUR_APL_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_4 = PUR_APL_ATTACH_1.ATTACH_FILE_SEQ
            LEFT JOIN T_ATTACH_MNG PUR_APL_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_5 = PUR_APL_ATTACH_2.ATTACH_FILE_SEQ
            LEFT JOIN (
                SELECT T_ARRIVAL.ORDER_NO, SUM(T_ARRIVAL.DELIV_VOL) APPROVED_DELIV_VOL
                FROM T_ARRIVAL
                INNER JOIN T_RECEIVE_MNG
                    ON T_ARRIVAL.ARRIVAL_SEQ = T_RECEIVE_MNG.APP_ARRIVAL_SEQ
                WHERE T_ARRIVAL.DELETE_FLG = '0'
                    AND T_ARRIVAL.RB_IND = '0'
                    AND T_RECEIVE_MNG.DELETE_FLG = '0'
                GROUP BY T_ARRIVAL.ORDER_NO
            ) APPROVED_T_ARRIVAL
                ON APPROVED_T_ARRIVAL.ORDER_NO = V_SLIP_BUY.ORDER_NO
            <where>
                V_SLIP_BUY.SLIP_NO IN 
                <foreach collection="searchCondition.page.keyDomainEntityList" item="keyList"  open="(" separator="," close=")">  
                    (#{keyList.slipNo}) 
                </foreach>
                <include refid="listKeyIdentityWhereCondition"/>
            </where>
            UNION ALL
            SELECT 
                V_SLIP_BUY.*,
                T_QUOT_REQUEST.QUOT_REQ_NO,
                TEST2.DELIV_VOL,
                T_QUOT_ACQ_APL.QUOT_ACQ_APL_STATUS,
                T_QUOT_REQUEST.QUOT_REQ_SEQ,
                TEST1.KENSHU,
                T_QUOT_ACQ_APL.QUOT_ACQ_APL_SEQ,
                ORDER_ATTACH_1.ATTACH_SCOPE,
                ORDER_ATTACH_2.ATTACH_SCOPE,
                ORDER_ATTACH_3.ATTACH_SCOPE,
                PUR_APL_ATTACH_1.ATTACH_SCOPE,
                PUR_APL_ATTACH_2.ATTACH_SCOPE,
                APPROVED_T_ARRIVAL.APPROVED_DELIV_VOL
            FROM H_V_SLIP_BUY V_SLIP_BUY
            LEFT JOIN H_QUOT_REQUEST T_QUOT_REQUEST 
                ON 
                   (V_SLIP_BUY.PUR_APL_NO = T_QUOT_REQUEST.QUOT_REQ_NO
                OR  V_SLIP_BUY.SLIP_NO = T_QUOT_REQUEST.QUOT_REQ_NO)
                AND T_QUOT_REQUEST.QUOT_TYPE_IND IN ('1', '4')
                AND T_QUOT_REQUEST.NEW_FLG = '1'
                AND T_QUOT_REQUEST.DELETE_FLG = '0'
            LEFT JOIN H_QUOT_ACQ_APL T_QUOT_ACQ_APL
                ON T_QUOT_ACQ_APL.QUOT_ACQ_APL_NO = V_SLIP_BUY.PUR_APL_NO
                AND T_QUOT_ACQ_APL.NEW_FLG = '1'
                AND T_QUOT_ACQ_APL.DELETE_FLG ='0'
            LEFT JOIN (
                SELECT T_DLV_EST_MNG.ORDER_NO,
                    COUNT(T_DLV_EST_MNG.DELIV_MNG_SEQ) KENSHU
                FROM H_DLV_EST_MNG T_DLV_EST_MNG
                WHERE T_DLV_EST_MNG.INQ_RESP_IND = '2'
                    AND T_DLV_EST_MNG.DELETE_FLG = '0'
                GROUP BY T_DLV_EST_MNG.ORDER_NO
            ) TEST1
                ON TEST1.ORDER_NO = V_SLIP_BUY.ORDER_NO
            LEFT JOIN (
                SELECT T_RECEIVE_MNG.ORDER_NO, SUM(T_RECEIVE_MNG.DELIV_VOL) DELIV_VOL
                FROM H_RECEIVE_MNG T_RECEIVE_MNG
                INNER JOIN H_ARRIVAL T_ARRIVAL
                    ON T_RECEIVE_MNG.APP_ARRIVAL_SEQ = T_ARRIVAL.ARRIVAL_SEQ
                WHERE T_RECEIVE_MNG.DELETE_FLG = '0' 
                    AND T_ARRIVAL.DELETE_FLG = '0'
                    AND T_ARRIVAL.ARRIVAL_STATUS = '04'  
                GROUP BY T_RECEIVE_MNG.ORDER_NO
            ) TEST2
                ON TEST2.ORDER_NO = V_SLIP_BUY.ORDER_NO
            LEFT JOIN H_ATTACH_MNG ORDER_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_1 = ORDER_ATTACH_1.ATTACH_FILE_SEQ
            LEFT JOIN H_ATTACH_MNG ORDER_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_2 = ORDER_ATTACH_2.ATTACH_FILE_SEQ
            LEFT JOIN H_ATTACH_MNG ORDER_ATTACH_3 ON  V_SLIP_BUY.ATTACH_FILE_3 = ORDER_ATTACH_3.ATTACH_FILE_SEQ
            LEFT JOIN H_ATTACH_MNG PUR_APL_ATTACH_1 ON  V_SLIP_BUY.ATTACH_FILE_4 = PUR_APL_ATTACH_1.ATTACH_FILE_SEQ
            LEFT JOIN H_ATTACH_MNG PUR_APL_ATTACH_2 ON  V_SLIP_BUY.ATTACH_FILE_5 = PUR_APL_ATTACH_2.ATTACH_FILE_SEQ
            LEFT JOIN (
                SELECT T_ARRIVAL.ORDER_NO, SUM(T_ARRIVAL.DELIV_VOL) APPROVED_DELIV_VOL
                FROM H_ARRIVAL T_ARRIVAL
                INNER JOIN H_RECEIVE_MNG T_RECEIVE_MNG
                    ON T_ARRIVAL.ARRIVAL_SEQ = T_RECEIVE_MNG.APP_ARRIVAL_SEQ
                WHERE T_ARRIVAL.DELETE_FLG = '0'
                    AND T_ARRIVAL.RB_IND = '0'
                    AND T_RECEIVE_MNG.DELETE_FLG = '0'
                GROUP BY T_ARRIVAL.ORDER_NO
            ) APPROVED_T_ARRIVAL
                ON APPROVED_T_ARRIVAL.ORDER_NO = V_SLIP_BUY.ORDER_NO
            <where>
                V_SLIP_BUY.SLIP_NO IN 
                <foreach collection="searchCondition.page.keyDomainEntityList" item="keyList"  open="(" separator="," close=")">  
                    (#{keyList.slipNo}) 
                </foreach>
                <include refid="listKeyIdentityWhereCondition"/>
            </where>
        ) V_SLIP_BUY
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>

    <sql id="pageHeader">
        SELECT * FROM (
    </sql>
    <sql id="pageRoot">
        ) WHERE  ROWNUM &lt;=${@fw.common.util.PropertiesUtil@getLong("DOWNLOAD_MAXCNT")}
    </sql>
</mapper>